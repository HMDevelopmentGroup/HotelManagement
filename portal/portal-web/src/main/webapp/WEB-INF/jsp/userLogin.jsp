<%--
  Created by IntelliJ IDEA.
  User: myx
  Date: 2018/3/26
  Time: 11:23
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>会员登录XXX五星高端牛逼大酒店</title>
  <meta name="keywords" content='会员登录_锦江国际会员俱乐部_锦江礼享' />
  <meta name="description" content='会员登录_锦江国际会员俱乐部_锦江礼享' />
  <link rel="stylesheet" type="text/css"  href="${pageContext.request.contextPath}/css/userlogin/vip.css">
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/jquery-1.8.0.min.js"></script>
</head>
<body>
<form method="post" action="/newlogin?go=http%3a%2f%2fwww.jinjianginns.com%2f" id="form1">
  <div class="aspNetHidden">
    <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKMTYwNTkxMjExOQ8WAh4TVmFsaWRhdGVSZXF1ZXN0TW9kZQIBFgJmEGRkFgYCAQ9kFgJmD2QWAmYPZBYCAgMPDxYCHgRUZXh0BQdFTkdMSVNIZGQCBQ9kFgJmD2QWAmYPZBYCAgEPFgIfAQWgCwk8ZGl2IGNsYXNzPSJmb290ZXIiPgoJCTxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CgkJCTxkaXYgY2xhc3M9ImZvb3Rlci1tZW51IGNsZWFyZml4Ij4KCQkJCTx1bD4KCQkJCQk8bGk+PGEgaHJlZj0iaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vYWJvdXR1cy8iPuWFs+S6juaIkeS7rDwvYT48L2xpPgoJCQkJCTxsaT7CoHzCoDwvbGk+CgkJCQkJPGxpPjxhIGhyZWY9Imh0dHA6Ly93d3cuamluamlhbmcuY29tL21hcC8iPue9keermeWcsOWbvjwvYT48L2xpPgoJCQkJCTxsaT7CoHzCoDwvbGk+CgkJCQkJPGxpPjxhIGhyZWY9Imh0dHA6Ly93d3cuamluamlhbmcuY29tL2NvbnRhY3RVcy8iPuiBlOezu+aIkeS7rDwvYT48L2xpPgoJCQkJCTxsaT7CoHzCoDwvbGk+CgkJCQkJPGxpPjxhIGhyZWY9Imh0dHA6Ly93d3cuamluamlhbmcuY29tL2NhcmVlci8iPuWKoOWFpeaIkeS7rDwvYT48L2xpPgoJCQkJCTxsaT7CoHzCoDwvbGk+CgkJCQkJPGxpPjxhIGhyZWY9Imh0dHA6Ly93d3cuamluamlhbmcuY29tL3NlcnZpY2UvIj7ms5Xlvovlo7DmmI48L2E+PC9saT4KCQkJCQk8bGk+wqB8wqA8L2xpPgoJCQkJCTxsaT48YSBocmVmPSJodHRwOi8vd3d3LmppbmppYW5nLmNvbS9saW5rLyI+5Y+L5oOF6ZO+5o6lPC9hPjwvbGk+CgkJCQkJPGxpPsKgfMKgPC9saT4KCQkJCQk8bGk+PGEgaHJlZj0iaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vaGVscC8iPuW4ruWKqeS4reW/gzwvYT48L2xpPgoJCQkJCTxsaT7CoHzCoDwvbGk+CgkJCQkJPGxpPjxhIGhyZWY9Imh0dHA6Ly93d3cuamluamlhbmcuY29tL3VzZXJFeHBlcmllbmNlLyI+55So5oi35L2T6aqM5Y+N6aaIPC9hPjwvbGk+CgkJCQk8L3VsPgoJCQk8L2Rpdj4KCQkJPGRpdiBjbGFzcz0ibmF2ZnJpIj4KCQkJCTxwPkNvcHlyaWdodDIwMTEuSmluamlhbmcuY29tLmFsbCByaWdodHMgcmVzZXJ2ZWQ8L3A+CgkJCQk8cD48YSBzdHlsZT0iY29sb3I6IzY2Njt0ZXh0LWRlY29yYXRpb246bm9uZTsiIGhyZWY9Imh0dHA6Ly93d3cubWlpYmVpYW4uZ292LmNuL3N0YXRlL291dFBvcnRhbC9sb2dpblBvcnRhbC5hY3Rpb24iIHRhcmdldD0iX2JsYW5rIj7msqpJQ1DlpIcwNTA0ODExM+WPtzwvYT48aSBjbGFzcz0iaWNvbiBpY29uLXBvbGljZSI+PC9pPuayquWFrOe9keWuieWkhyAzMTAxMDEwMjAwMjA1MOWPtzwvcD4KCQkJCTxwIGNsYXNzPSJwb2xpY2UiPjxpIGNsYXNzPSJpY29uIGljb24tcG9saWNlMDEiPjwvaT48aSBjbGFzcz0iaWNvbiBpY29uLXBvbGljZTAyIj48L2k+PGkgY2xhc3M9Imljb24gaWNvbi1wb2xpY2UwMyI+PC9pPjxpIGNsYXNzPSJpY29uIGljb24tcG9saWNlMDQiPjwvaT48L3A+CgkJCTwvZGl2PgoJCQk8ZGl2IGNsYXNzPSJjb2RlIj4KCQkJCTxpbWcgc3JjPSIvfi9tZWRpYS9jbHViL25ld2xvZ2luL2NvZGUucG5nIiBhbHQ9IiI+CgkJCTwvZGl2PgoJCTwvZGl2PgoJPC9kaXY+CmQCBw9kFgICAQ8WAh8BBb3NAQ0KDQoNCjxzY3JpcHQ+DQogICAgdmFyIGxpbWl0ID0gMDsNCiAgICB2YXIgbG9naW5JbnRlcnZhbCA9IG51bGw7DQogICAgdmFyIHRvdGFsQ291bnRGb3JNZW1iZXJIZWFkZXIgPSAwOw0KICAgIHZhciB0b3RhbENvdXBvbkNvdW50Rm9yTWVtYmVyID0gMDsNCiAgICB2YXIgdG90YWxMZXR0ZXJDb3VudEZvck1lbWJlciA9IDA7DQogICAgdmFyIGhhc0ltYWdlVXJsID0gZmFsc2U7DQogICAgdmFyIGVybUZsYWcgPSAiIjsNCiAgICB2YXIgZXJtSWQgPSAiIjsNCiAgICB2YXIgY2xpZW50TnVtYmVyID0gIiI7DQogICAgdmFyIG1lbWJlcklkID0gIiI7DQogICAgdmFyIGlubnNVcmwgPSAiaHR0cDovL3d3dy5qaW5qaWFuZ2lubnMuY29tIjsNCiAgICB2YXIgZ29sZG1ldFVybCA9ICJodHRwOi8vamluZ3Vhbmdpbm5zLmJlc3R3ZWhvdGVsLmNvbSI7DQogICAgdmFyIG1ldHJvcG9sb1VybCA9ICJodHRwOi8vd3d3Lm1ldHJvcG9sb2hvdGVscy5jb20iOw0KICAgIHZhciBiZXN0YXlVcmwgPSAiaHR0cDovL2Jlc3RheS5iZXN0d2Vob3RlbC5jb20iOw0KICAgIHZhciBob3RlbFVybCA9ICJodHRwOi8vaG90ZWwuamluamlhbmcuY29tIjsNCiAgICB2YXIgampIb3RlbFVybCA9ICJodHRwOi8vaG90ZWxzLmppbmppYW5nLmNvbSI7DQogICAgdmFyIHRyYXZlbFVybCA9ICJodHRwOi8vdHJhdmVsLmppbmppYW5nLmNvbSI7DQogICAgdmFyIHBhc3NlclVybCA9ICJodHRwczovL3d3dy5qaW5qaWFuZy5jb20vcGFzc2VyIjsNCg0KICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHZpZXdQYyA9ICQoIiN2aWV3UGMiKS52YWwoKTsNCg0KICAgICAgICB2YXIgamplVXRpbCA9IChmdW5jdGlvbiAocGFyZW50LCAkKSB7DQogICAgICAgICAgICB2YXIgbXkgPSBwYXJlbnQgPSBwYXJlbnQgfHwge307DQogICAgICAgICAgICBteS5lcm1Mb2dvdXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgZXJtSWQgPSAiY2xlYXIiOw0KICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRFcm1Db29raWUoImh0dHA6Ly93d3cuamluamlhbmdpbm5zLmNvbSIsIGVybUlkKTsNCiAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vamluZ3Vhbmdpbm5zLmJlc3R3ZWhvdGVsLmNvbSIsIGVybUlkKTsNCiAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vd3d3Lm1ldHJvcG9sb2hvdGVscy5jb20iLCBlcm1JZCk7DQogICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2Jlc3RheS5iZXN0d2Vob3RlbC5jb20iLCBlcm1JZCk7DQogICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL3d3dy5qaW5qaWFuZy5jb20iLCBlcm1JZCk7DQogICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2hvdGVsLmppbmppYW5nLmNvbSIsIGVybUlkKTsNCiAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vaG90ZWxzLmppbmppYW5nLmNvbSIsIGVybUlkKTsNCiAgICAgICAgICAgICAgICAvL01lYmVyVXRpbC5zZXRFcm1Db29raWUoIiRrYW5nYm9VcmwkIiwgZXJtSWQpOw0KICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQoNCiAgICAgICAgICAgICAgICBpZiAobGltaXQrKyA+IDIpIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coInJlbW92ZSBjb29raWU6ZXJtRmxhZyIpOw0KICAgICAgICAgICAgICAgICQucmVtb3ZlQ29va2llKCJlcm1GbGFnIik7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgbXkudmlld1BjID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGlmICh2aWV3UGM9PSIxIikgew0KICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0TW9iaWxlQ29va2llKCJodHRwOi8vd3d3LmppbmppYW5naW5ucy5jb20iKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldE1vYmlsZUNvb2tpZSgiaHR0cDovL2ppbmd1YW5naW5ucy5iZXN0d2Vob3RlbC5jb20iKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldE1vYmlsZUNvb2tpZSgiaHR0cDovL3d3dy5tZXRyb3BvbG9ob3RlbHMuY29tIik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRNb2JpbGVDb29raWUoImh0dHA6Ly9iZXN0YXkuYmVzdHdlaG90ZWwuY29tIik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRNb2JpbGVDb29raWUoImh0dHA6Ly93d3cuamluamlhbmcuY29tIik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRNb2JpbGVDb29raWUoImh0dHA6Ly9ob3RlbC5qaW5qaWFuZy5jb20iKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldE1vYmlsZUNvb2tpZSgiaHR0cDovL2hvdGVscy5qaW5qaWFuZy5jb20iKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldE1vYmlsZUNvb2tpZSgiaHR0cDovL3RyYXZlbC5qaW5qaWFuZy5jb20iKTsNCiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChsb2dpbkludGVydmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGxpbWl0KysgPiAyKSBjbGVhckludGVydmFsKGxvZ2luSW50ZXJ2YWwpOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgbXkuZXJtTG9naW4gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKGVybUlkICE9ICIiICYmIGVybUlkICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vd3d3LmppbmppYW5naW5ucy5jb20iLCBlcm1JZCArICJ8IiArIGNsaWVudE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRFcm1Db29raWUoImh0dHA6Ly9qaW5ndWFuZ2lubnMuYmVzdHdlaG90ZWwuY29tIiwgZXJtSWQgKyAifCIgKyBjbGllbnROdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vd3d3Lm1ldHJvcG9sb2hvdGVscy5jb20iLCBlcm1JZCArICJ8IiArIGNsaWVudE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRFcm1Db29raWUoImh0dHA6Ly9iZXN0YXkuYmVzdHdlaG90ZWwuY29tIiwgZXJtSWQgKyAifCIgKyBjbGllbnROdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vd3d3LmppbmppYW5nLmNvbSIsIGVybUlkICsgInwiICsgY2xpZW50TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2hvdGVsLmppbmppYW5nLmNvbSIsIGVybUlkICsgInwiICsgY2xpZW50TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2hvdGVscy5qaW5qaWFuZy5jb20iLCBlcm1JZCArICJ8IiArIGNsaWVudE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgIC8vTWViZXJVdGlsLnNldEVybUNvb2tpZSgiJGthbmdib1VybCQiLCBlcm1JZCArICJ8IiArIGNsaWVudE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChsaW1pdCsrID4gMikgY2xlYXJJbnRlcnZhbChsb2dpbkludGVydmFsKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBteS50cnlMb2dpbiA9IGZ1bmN0aW9uICh1cmwpIHsNCiAgICAgICAgICAgICAgICBpZiAoIXJlYWRDb29raWUoJ19KSkVfUEFTXycpIHx8IGhhc0ltYWdlVXJsKSB7DQogICAgICAgICAgICAgICAgICAgICQuZ2V0SlNPTih1cmwgKyAiP2NhbGxiYWNrPT8iLCBmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudmFsdWUgIT0gIiIgJiYgZGF0YS52YWx1ZSAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVDb29raWUoZGF0YS5uYW1lLCBkYXRhLnZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb25lbW9udGggPSAkLmNvb2tpZSgicmVtZW1iZXJNZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRDb29raWUoImh0dHA6Ly93d3cuamluamlhbmdpbm5zLmNvbSIsIGRhdGEudmFsdWUgKyAifCIgKyBtZW1iZXJJZCArICJ8IiArIG9uZW1vbnRoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0Q29va2llKCJodHRwOi8vamluZ3Vhbmdpbm5zLmJlc3R3ZWhvdGVsLmNvbSIsIGRhdGEudmFsdWUgKyAifCIgKyBtZW1iZXJJZCArICJ8IiArIG9uZW1vbnRoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0Q29va2llKCJodHRwOi8vd3d3Lm1ldHJvcG9sb2hvdGVscy5jb20iLCBkYXRhLnZhbHVlICsgInwiICsgbWVtYmVySWQgKyAifCIgKyBvbmVtb250aCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldENvb2tpZSgiaHR0cDovL2Jlc3RheS5iZXN0d2Vob3RlbC5jb20iLCBkYXRhLnZhbHVlICsgInwiICsgbWVtYmVySWQgKyAifCIgKyBvbmVtb250aCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldENvb2tpZSgiaHR0cDovL2hvdGVsLmppbmppYW5nLmNvbSIsICJ8IiArIG1lbWJlcklkICsgInwiICsgb25lbW9udGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRDb29raWUoImh0dHA6Ly9ob3RlbHMuamluamlhbmcuY29tIiwgInwiICsgbWVtYmVySWQgKyAifCIgKyBvbmVtb250aCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldENvb2tpZSgiaHR0cDovL3RyYXZlbC5qaW5qaWFuZy5jb20iLCBkYXRhLnZhbHVlICsgInwiICsgbWVtYmVySWQgKyAifCIgKyBvbmVtb250aCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChsb2dpbkludGVydmFsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChsaW1pdCsrID4gMikgY2xlYXJJbnRlcnZhbChsb2dpbkludGVydmFsKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNvb2tpZShuYW1lLCB2YWx1ZSwgZGF5cykgew0KICAgICAgICAgICAgICAgIGlmIChkYXlzKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgKGRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7DQogICAgICAgICAgICAgICAgICAgIHZhciBleHBpcmVzID0gIjsgZXhwaXJlcz0iICsgZGF0ZS50b0dNVFN0cmluZygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHZhciBleHBpcmVzID0gIiI7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9IiArIHZhbHVlICsgZXhwaXJlcyArICI7IHBhdGg9LyI7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIHJlYWRDb29raWUobmFtZSkgew0KICAgICAgICAgICAgICAgIHZhciBuYW1lRVEgPSBuYW1lICsgIj0iOw0KICAgICAgICAgICAgICAgIHZhciBjYSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2EubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBjYVtpXTsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09ICcgJykgYyA9IGMuc3Vic3RyaW5nKDEsIGMubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGMuaW5kZXhPZihuYW1lRVEpID09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHBhcmVudDsNCiAgICAgICAgfShqamVVdGlsIHx8IHt9LCBqUXVlcnkpKTsNCiAgICAgICAgdmFyIG1jb2RlID0gJCgiI21jb2RlIikudmFsKCk7DQogICAgICAgIHZhciBhdXRoU3RhdGVEZXBlbmRPblBhc3NlciA9IHRydWU7DQoNCiAgICAgICAgdmFyIE1lYmVyVXRpbCA9IHsNCg0KICAgICAgICAgICAgZW1wdHlVc3JNc2c6ICLor7fovpPlhaXmgqjnmoTnlKjmiLflkI0iLA0KICAgICAgICAgICAgZW1wdHlQd2RNc2c6ICLor7fovpPlhaXmgqjnmoTlr4bnoIEiLA0KICAgICAgICAgICAgbG9naW5GYWlsTXNnOiAi55So5oi35ZCN5oiW5a+G56CB5pyJ6K+vIiwNCg0KICAgICAgICAgICAgaXNMb2dlZEluOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICQuY29va2llKCJtZW1iZXJJZCIpICE9IG51bGwgJiYgJC5jb29raWUoImlkZW50aXR5IikgPT0gbnVsbDsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIGlzTWVtYmVyUGFuZWxFeGlzaXRzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICQoIi5oZWFkIC5sb2dpbmVkX2JveCIpICE9IG51bGw7DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICBzZXRUb3RhbENvdW50OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKCQoIiNNZW1iZXJNZXNzYWdlc1RvdGFsQ291bnQiKS5sZW5ndGggPiAwKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiaUNvdW50IiwgaUNvdW50KTsNCiAgICAgICAgICAgICAgICAgICAgdG90YWxDb3VudEZvck1lbWJlckhlYWRlciA9IHRvdGFsQ291cG9uQ291bnRGb3JNZW1iZXIgKyB0b3RhbExldHRlckNvdW50Rm9yTWVtYmVyOw0KDQogICAgICAgICAgICAgICAgICAgICQoIiNNZW1iZXJNZXNzYWdlc1RvdGFsQ291bnQiKS5odG1sKCIoIiArIHRvdGFsQ291bnRGb3JNZW1iZXJIZWFkZXIgKyAiKSIpOw0KICAgICAgICAgICAgICAgICAgICAkKCIjTWVtYmVyTWVzc2FnZXNUb3RhbENvdW50IikuYXR0cigidGl0bGUiLCB0b3RhbENvdW50Rm9yTWVtYmVySGVhZGVyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICBzaG93TWVtYmVySW5mbzogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgY29kZTogJC5jb29raWUoIm1lbWJlcklkIikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLA0KICAgICAgICAgICAgICAgICAgICB1cmw6ICIvc2VydmljZS9nZXRNZW1iZXJJbmZvIiwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdKU09OJywNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW0sDQogICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlRGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEpTT04ucGFyc2UocmVzcG9uc2VEYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2Vzcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJCgiI21lbWJlckxldmVsIikuaHRtbChyZXN1bHQuQ2FyZExldmVsTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI21lbWJlckNhcmRObyIpLmh0bWwocmVzdWx0LkNhcmRObyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoIiNtZW1iZXJfbmFtZV90ZXh0IikubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbWVtYmVyX25hbWVfdGV4dCIpLmh0bWwocmVzdWx0LkZ1bGxOYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI21lbWJlcl9uYW1lX3RleHQiKS5hdHRyKCJ0aXRsZSIsIHJlc3VsdC5GdWxsTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiR2V0IE1lbWJlckluZm8gRXJyb3I6IiwgZXJyb3JUaHJvd24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0RXJtQ29va2llOiBmdW5jdGlvbiAodXJsLCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsNCiAgICAgICAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgICAgICAgICAgc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCiAgICAgICAgICAgICAgICBzY3JpcHQuc3JjID0gJy9oYW5kbGVycy9zZXRlcm1jb29raWUuYXNweD9pZD0nICsgdmFsdWUgKyAnJmRvbWFpbj0nICsgdXJsOw0KICAgICAgICAgICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXRNb2JpbGVDb29raWU6IGZ1bmN0aW9uICh1cmwpIHsNCiAgICAgICAgICAgICAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07DQogICAgICAgICAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOw0KICAgICAgICAgICAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7DQogICAgICAgICAgICAgICAgc2NyaXB0LnNyYyA9ICcvaGFuZGxlcnMvc2V0bW9iaWxlY29va2llLmFzcHg/ZG9tYWluPScgKyB1cmw7Ow0KICAgICAgICAgICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXRDb29raWU6IGZ1bmN0aW9uICh1cmwsIHZhbHVlKSB7DQogICAgICAgICAgICAgICAgdmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdOw0KICAgICAgICAgICAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsNCiAgICAgICAgICAgICAgICBzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOw0KICAgICAgICAgICAgICAgIHNjcmlwdC5zcmMgPSB1cmwgKyAnL2hhbmRsZXJzL3NldGNvb2tpZS5hc3B4P3Bhcz0nICsgdmFsdWU7DQogICAgICAgICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAsDQogICAgICAgICAgICBzaG93TWVtYmVyU2NvcmU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgcGFyYW0gPSB7DQogICAgICAgICAgICAgICAgICAgIGNvZGU6ICQuY29va2llKCJtZW1iZXJJZCIpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICQuYWpheCh7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywNCiAgICAgICAgICAgICAgICAgICAgdXJsOiAiL3NlcnZpY2UvZ2V0TWVtYmVyU2NvcmUiLA0KICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ0pTT04nLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbSwNCiAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2VEYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZURhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXN1bHQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI21lbWJlclNjb3JlIikuaHRtbChyZXN1bHQuaW50VmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNtZW1iZXJTY29yZSIpLmF0dHIoInRpdGxlIiwgcmVzdWx0LmludFZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkdldCBNZW1iZXJTY29yZSBFcnJvcjoiLCBlcnJvclRocm93bik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIHNob3dDb3Vwb25Db3VudDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgY29kZTogKCQuY29va2llKCJtZW1iZXJJZCIpID09IG51bGwgfHwgJC5jb29raWUoIm1lbWJlcklkIikgPT0gIiIpID8gbWNvZGUgOiAkLmNvb2tpZSgibWVtYmVySWQiKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsDQogICAgICAgICAgICAgICAgICAgIHVybDogIi9zZXJ2aWNlL2dldENvdXBvbkNvdW50IiwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdKU09OJywNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW0sDQogICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlRGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEpTT04ucGFyc2UocmVzcG9uc2VEYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2Vzcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSAiKCIgKyByZXN1bHQudW51c2VkQ291bnQgKyAiKSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI215Q291cG9uQ291bnQiKS5odG1sKHN0cik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbENvdXBvbkNvdW50Rm9yTWVtYmVyID0gcmVzdWx0LnVudXNlZENvdW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRUb3RhbENvdW50KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJHZXQgQ291cG9uQ291bnQgRXJyb3I6IiwgZXJyb3JUaHJvd24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICBzaG93SW50ZXJuYWxMZXR0ZXJzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIHBhcmFtID0gew0KICAgICAgICAgICAgICAgICAgICBtZW1iZXJJZDogJC5jb29raWUoIm1lbWJlcklkIikNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsDQogICAgICAgICAgICAgICAgICAgIHVybDogIi9zZXJ2aWNlcy91bnJlYWRJbnRlcm5hbExldHRlckNvdW50IiwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdKU09OJywNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW0sDQogICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlRGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEpTT04ucGFyc2UocmVzcG9uc2VEYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coInVucmVhZCIsIHJlc3VsdCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LlN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gIigiICsgcmVzdWx0LmludFZhbHVlICsgIikiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNteUxldHRlcnNDb3VudCIpLmh0bWwoc3RyKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTGV0dGVyQ291bnRGb3JNZW1iZXIgPSByZXN1bHQuaW50VmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldFRvdGFsQ291bnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkdldCBDb3Vwb25Db3VudCBFcnJvcjoiLCBlcnJvclRocm93bik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIC8vc2V0VGltZW91dChNZWJlclV0aWwuc2hvd0ludGVybmFsTGV0dGVycygpLCA2MDAwMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgLy9SZW5kIEltYWdlIGFzIHVybCBmcm9tIGNvb2tpZQ0KICAgICAgICBpZiAoJC5jb29raWUoImltYWdlVXJsIikgIT0gbnVsbCkgew0KICAgICAgICAgICAgLy9jb25zb2xlLmxvZygicmVuZGVyIEltYWdlIFVSTCIpOw0KICAgICAgICAgICAgJCgiPGltZyAvPiIsIHsgc3JjOiAkLmNvb2tpZSgiaW1hZ2VVcmwiKSwgd2lkdGg6IDAsIGhlaWdodDogMCB9KS5hcHBlbmRUbygiI2xvZ2luU3RhdGVJbWFnZSIpOw0KICAgICAgICAgICAgJC5yZW1vdmVDb29raWUoImltYWdlVXJsIik7DQogICAgICAgICAgICBoYXNJbWFnZVVybCA9IHRydWU7DQoNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJCgiLmxvZ2luZWQiKS5sZW5ndGggPiAwICYmIGVybUZsYWcgIT0gImNsZWFyIikgew0KICAgICAgICAgICAgaWYgKGVybUZsYWcgPT0gIjEiKSBsb2dpbkludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyBqamVVdGlsLmVybUxvZ2luKCk7IH0sIDEwMDApOw0KICAgICAgICAgICAgZWxzZSBpZiAoZXJtSWQgPT0gIiIpIGxvZ2luSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IGpqZVV0aWwudHJ5TG9naW4oImh0dHBzOi8vd3d3LmppbmppYW5nLmNvbS9wYXNzZXIvc2V0Y29va2llIik7IH0sIDEwMDApOw0KICAgICAgICB9DQogICAgICAgIGlmIChlcm1GbGFnID09ICJjbGVhciIpIGxvZ2luSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IGpqZVV0aWwuZXJtTG9nb3V0KCk7IH0sIDEwMDApOw0KICAgICAgICBpZiAodmlld1BjID09ICIxIikgbG9naW5JbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgamplVXRpbC52aWV3UGMoKTsgfSwgMTAwMCk7DQogICAgICAgIC8vR2V0IE1lbWJlciBJbmZvIGFuZCBzaG93IGluIFBhbmVsDQogICAgICAgIGlmIChNZWJlclV0aWwuaXNMb2dlZEluKCkgJiYgTWViZXJVdGlsLmlzTWVtYmVyUGFuZWxFeGlzaXRzKCkpIHsNCiAgICAgICAgICAgIE1lYmVyVXRpbC5zaG93TWVtYmVySW5mbygpOw0KICAgICAgICAgICAgTWViZXJVdGlsLnNob3dNZW1iZXJTY29yZSgpOw0KICAgICAgICAgICAgLy9NZWJlclV0aWwuc2hvd0NvdXBvbkNvdW50KCk7DQoNCiAgICAgICAgICAgIC8vTWViZXJVdGlsLnNob3dJbnRlcm5hbExldHRlcnMoKTsNCiAgICAgICAgICAgIC8vc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyBNZWJlclV0aWwuc2hvd0NvdXBvbkNvdW50KCk7IH0sIDMwMDAwKTsNCiAgICAgICAgICAgIC8vc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyBNZWJlclV0aWwuc2hvd0ludGVybmFsTGV0dGVycygpOyB9LCAzMDAwMCk7DQogICAgICAgIH0NCiAgICAgDQogICAgICAgICAgICBpZiAoJCgiI2hlYWRlcl9JbWFnZUNoZWNrIikubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIGhlYWRDaGFuZ2VDb2RlSW1nKCk7DQogICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIiB8fCAkKCJib2R5IikuaGFzQ2xhc3MoImVuIikpIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiI2hlYWRlcl92YWxpZGF0ZUNvZGUiKS5hdHRyKCJkYXRhLXdhdGVybWFyayIsICJjb2RlIik7DQogICAgICAgICAgICAgICAgICAgICQoIiNoZWFkZXJfdmFsaWRhdGVDb2RlIikuYXR0cigidmFsdWUiLCAiY29kZSIpOw0KDQogICAgICAgICAgICAgICAgICAgICQoIiNoZWFkZXJfYUltYWdlQ2hlY2siKS5jc3MoImNvbG9yIiwgIiMxZDdhZDkiKTsNCiAgICAgICAgICAgICAgICAgICAgJCgiI2hlYWRlcl9JbWFnZUNoZWNrIikuYXR0cigidGl0bGUiLCAiQ2xpY2sgUmVwbGFjZSB2ZXJpZmljYXRpb24gY29kZSBpbWFnZSIpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfQ0KICAgIA0KDQogICAgICAgIHZhciBvcmRlck9yaWdpbiA9ICQuY29va2llKCJvcmRlck9yaWdpbiIpOw0KDQogICAgICAgIC8vTG9naW4gU3RhdGUgdXBkYXRlDQoNCg0KICAgICAgICAvLyQoIiNFbnRlckNsdWIiKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgLy8gICAgJCgiI0VudGVyQ2x1YiIpLmZpbmQoImEiKS5jbGljaygpOw0KICAgICAgICAvLyAgICAvL2xvY2F0aW9uLmhyZWYgPSAkKCIjY2x1YlVybCIpLnZhbCgpOw0KICAgICAgICAvL30pOw0KICAgICAgICAvLyQoIiNFbnRlckNsdWIxIikuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgIC8vICAgIGFsZXJ0KCQoIiNFbnRlckNsdWIxIikuZmluZCgiYSIpLmF0dHIoImhyZWYiKSk7DQogICAgICAgIC8vICAgICQoIiNFbnRlckNsdWIxIikuZmluZCgiYSIpLmNsaWNrKCk7DQogICAgICAgIC8vICAgIC8vd2luZG93LmxvY2F0aW9uLmhyZWYgPSAkKCIjY2x1YlVybCIpLnZhbCgpOw0KICAgICAgICAvL30pOw0KDQogICAgICAgICQoIi5sb2dpbl9idG4iKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgIGlmICgkKCIubG9naW5fYnRuIikuYXR0cigic3RhdGUiKSA9PSAibG9naW4iKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmNzcygiYmFja2dyb3VuZCIsICIjYTRhNGE0Iik7DQogICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmF0dHIoInN0YXRlIiwgImxvZ2luIikNCiAgICAgICAgICAgICAgICBpZiAoJCgiI2xhbmciKS52YWwoKSA9PSAiZW4iIHx8ICQoImJvZHkiKS5oYXNDbGFzcygiZW4iKSkgew0KICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuaHRtbCgiTG9naW5pbmciKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCLnmbvlvZXkuK0iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsNCiAgICAgICAgICANCiAgICAgICAgICAgIHZhciBwYXJhbSA9IHt9Ow0KICAgICAgICAgICAgcGFyYW0udXNlcm5hbWUgPSAkLnRyaW0oJCgiI2xvZ2luX3VzZXJuYW1lIikudmFsKCkpOw0KICAgICAgICAgICAgcGFyYW0ucGFzc3dvcmQgPSAkLnRyaW0oJCgiI2xvZ2luX3Bhc3N3b3JkIikudmFsKCkpOw0KICAgICAgICAgICAgcGFyYW0ub25lTW9udGggPSAkKCIjbG9naW5fYm94IC5jaGVja19idG4iKS52YWwoKSA9PT0gImNoZWNrZWQiOw0KICAgICAgICAgICAgJC5jb29raWUoInJlbWVtYmVyTWUiLCAkKCIjbG9naW5fYm94IC5jaGVja19idG4iKS52YWwoKSA9PT0gImNoZWNrZWQiID8gIjEiIDogIjAiKTsNCiAgICAgICAgICAgIHZhciB1c3JXYXRlck1hcmsgPSAkKCIjbG9naW5fdXNlcm5hbWUiKS5hdHRyKCJkYXRhLXdhdGVybWFyayIpOw0KICAgICAgICAgICAgaWYgKHBhcmFtLnVzZXJuYW1lLmxlbmd0aCA9PSAwIHx8IHBhcmFtLnVzZXJuYW1lID09IHVzcldhdGVyTWFyaykgew0KICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3ggLmFsYXJtX3RleHQiKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsNCiAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuaHRtbChNZWJlclV0aWwuZW1wdHlVc3JNc2cpOw0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5jc3MoImJhY2tncm91bmQiLCAiI2QxYWU3NiIpOw0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5hdHRyKCJzdGF0ZSIsICIiKQ0KICAgICAgICAgICAgICAgIGlmICgkKCIjbGFuZyIpLnZhbCgpID09ICJlbiIgfHwgJCgiYm9keSIpLmhhc0NsYXNzKCJlbiIpKSB7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCJMb2dpbiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIueZu+W9lSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChwYXJhbS5wYXNzd29yZC5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3ggLmFsYXJtX3RleHQiKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsNCiAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuaHRtbChNZWJlclV0aWwuZW1wdHlQd2RNc2cpOw0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5jc3MoImJhY2tncm91bmQiLCAiI2QxYWU3NiIpOw0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5hdHRyKCJzdGF0ZSIsICIiKQ0KICAgICAgICAgICAgICAgIGlmICgkKCIjbGFuZyIpLnZhbCgpID09ICJlbiIgfHwgJCgiYm9keSIpLmhhc0NsYXNzKCJlbiIpKSB7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCJMb2dpbiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIueZu+W9lSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIWNoZWNrVmFsaWRhdGVDb2RlKCJoZWFkZXJfdmFsaWRhdGVDb2RlIikpIHsNCiAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7DQoNCiAgICAgICAgICAgICAgICBpZiAoJCgiI2xhbmciKS52YWwoKSA9PSAiZW4iIHx8ICQoImJvZHkiKS5oYXNDbGFzcygiZW4iKSkgew0KICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuaHRtbCgiVmVyaWZpY2F0aW9uIGNvZGUgZXJyb3IiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3ggLmFsYXJtX3RleHQiKS5odG1sKCLpqozor4HnoIHplJnor68iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmNzcygiYmFja2dyb3VuZCIsICIjZDFhZTc2Iik7DQogICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmF0dHIoInN0YXRlIiwgIiIpDQogICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIiB8fCAkKCJib2R5IikuaGFzQ2xhc3MoImVuIikpIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIkxvZ2luIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuaHRtbCgi55m75b2VIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBkYXRhID0gInVzcj0iICsgcGFyYW0udXNlcm5hbWUgKyAiJnB3ZD0iICsgU3RyaW5nVXRpbC5iYXNlNjRlbmNvZGUocGFyYW0ucGFzc3dvcmQpICsgIiZvbmVNb250aD0iICsgcGFyYW0ub25lTW9udGggKyAiJmNhbGxiYWNrPT8iICsgIiZjb2RlPSIgKyAkKCIjaGVhZGVyX3ZhbGlkYXRlQ29kZSIpLnZhbCgpKyImaXNoZWFkZXI9MSI7DQogICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywNCiAgICAgICAgICAgICAgICB1cmw6ICJodHRwOi8vd3d3LmppbmppYW5nLmNvbS9IYW5kbGVycy9Tc29Mb2dpbkhhbmRsZXIuYXNoeCIsDQogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29ucCIsDQogICAgICAgICAgICAgICAganNvbnA6ICJjYWxsYmFjayIsDQogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwNCiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsDQogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLA0KICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZXNzKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudXJsICE9IG51bGwgJiYgcmVzdWx0LnVybC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TYXZlIEltYWdlVVJMIHRvIGNvb2tpZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuY29va2llKCJpbWFnZVVybCIsIHJlc3VsdC51cmwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy9Xcml0ZSBDb29raWUgZm9yIGF1dGhlZA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC50b2tlbiAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygibG9naW4gdG9rZW4iLCByZXN1bHQudG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuY29va2llKCIuQVNQWEFVVEgiLCByZXN1bHQudG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pZCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygibG9naW4gbWVtYmVySWQiLCByZXN1bHQuaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuY29va2llKCJtZW1iZXJJZCIsIHJlc3VsdC5pZCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOw0KDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmNvZGUgIT0gbnVsbCAmJiByZXN1bHQuY29kZSA9PSAiMTAxIikgey8v6aqM6K+B56CB6ZSZ6K+vDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIiB8fCAkKCJib2R5IikuaGFzQ2xhc3MoImVuIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwoIlZlcmlmaWNhdGlvbiBjb2RlIGVycm9yLCBwbGVhc2UgdHJ5IGFnYWluIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuaHRtbChyZXN1bHQubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0LmNvZGUgIT0gbnVsbCAmJiByZXN1bHQuY29kZSA9PSAiMzAxIikgey8v5L+u5pS55a+G56CBIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCIjbG9naW5fYm94IikubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fdXNlcm5hbWUiKS52YWwoIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fcGFzc3dvcmQiKS52YWwoIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuaHRtbCgiIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3giKS5jc3MoImRpc3BsYXkiLCJub25lIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEltcHJvdmVQYXNzd29yZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwoTWViZXJVdGlsLmxvZ2luRmFpbE1zZyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAkKCcubnVtX3ZhbGlkYXRlX2JveCcpLmNzcygiZGlzcGxheSIsICJibG9jayIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaGVhZENoYW5nZUNvZGVJbWcoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoIiNoZWFkZXJfdmFsaWRhdGVDb2RlIikudmFsKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5jc3MoImJhY2tncm91bmQiLCAiI2QxYWU3NiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmF0dHIoInN0YXRlIiwgIiIpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgiI2xhbmciKS52YWwoKSA9PSAiZW4iIHx8ICQoImJvZHkiKS5oYXNDbGFzcygiZW4iKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCJMb2dpbiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIueZu+W9lSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJMb2dpbiBFcnJvcjoiLCBlcnJvclRocm93bik7DQogICAgICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3ggLmFsYXJtX3RleHQiKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsNCiAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwoTWViZXJVdGlsLmxvZ2luRmFpbE1zZyk7DQogICAgICAgICAgICAgICAgICAgIGhlYWRDaGFuZ2VDb2RlSW1nKCk7DQogICAgICAgICAgICAgICAgICAgICQoIiNoZWFkZXJfdmFsaWRhdGVDb2RlIikudmFsKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmNzcygiYmFja2dyb3VuZCIsICIjZDFhZTc2Iik7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5hdHRyKCJzdGF0ZSIsICIiKQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJCgiI2xhbmciKS52YWwoKSA9PSAiZW4iIHx8ICQoImJvZHkiKS5oYXNDbGFzcygiZW4iKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIkxvZ2luIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuaHRtbCgi55m75b2VIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICAgICQoIiNsb2dvdXQiKS5jbGljayhmdW5jdGlvbiAoKSB7DQoNCiAgICAgICAgICAgIC8vcmVtb3ZlIGN1cnJlbnQgYXV0aC1jb29raWUNCiAgICAgICAgICAgICQuYWpheCh7DQogICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsDQogICAgICAgICAgICAgICAgdXJsOiAiL0hhbmRsZXJzL1NpbXBsZUxvZ291dEhhbmRsZXIuYXNoeCIsDQogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29ucCIsDQogICAgICAgICAgICAgICAganNvbnA6ICJjYWxsYmFjayIsDQogICAgICAgICAgICAgICAgLy8gZGF0YTogImtleT0uQVNQWEFVVEgiLA0KICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIG1haW5TaXRlIGF1dGgtY29va2llDQogICAgICAgICAgICAgICAgICAgICQuYWpheCh7DQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJywNCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogImh0dHA6Ly93d3cuamluamlhbmcuY29tL0hhbmRsZXJzL1NpbXBsZUxvZ291dEhhbmRsZXIuYXNoeCIsDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb25wIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGpzb25wOiAiY2FsbGJhY2siLA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGF0YTogImtleT1vcmRlck9yaWdpbiIsDQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGhTdGF0ZURlcGVuZE9uUGFzc2VyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gImh0dHA6Ly93d3cuamluamlhbmcuY29tL3Bhc3Nlci9sb2dvdXQ/Z289aHR0cCUzYSUyZiUyZnd3dy5qaW5qaWFuZy5jb20lMmZuZXdsb2dpbiUzZmdvJTNkaHR0cCUyNTNhJTI1MmYlMjUyZnd3dy5qaW5qaWFuZ2lubnMuY29tJTI1MmYiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkxvZ291dCBFcnJvcjoiLCBlcnJvclRocm93bik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiTG9nb3V0IEVycm9yOiIsIGVycm9yVGhyb3duKTsNCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgIH0pOw0KDQoNCiAgICAgICAgLy8kKGRvY3VtZW50KS5rZXlkb3duKGZ1bmN0aW9uIChldmVudCkgew0KDQogICAgICAgIC8vICAgIGlmIChldmVudC5rZXlDb2RlID09IDEzKSB7DQogICAgICAgIC8vICAgICAgICBpZiAoJCgiI2xvZ2luX3Bhc3N3b3JkIikuaXMoIjpmb2N1cyIpIHx8ICQoImxvZ2luX3VzZXJuYW1lIikuaXMoIjpmb2N1cyIpKQ0KICAgICAgICAvLyAgICAgICAgew0KICAgICAgICAvLyAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuY2xpY2soKTsNCiAgICAgICAgLy8gICAgICAgIH0NCg0KICAgICAgICAvLyAgICB9IA0KICAgICAgICAvL30pOw0KDQogICAgfSk7DQogICAgZnVuY3Rpb24gaGVhZENoYW5nZUNvZGVJbWcoKSB7DQogICAgICAgIHZhciBzdHJMb2dpblVybCA9ICgiaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vSGFuZGxlcnMvU3NvTG9naW5IYW5kbGVyLmFzaHgiKS5yZXBsYWNlKCJTc29Mb2dpbkhhbmRsZXIuYXNoeCIsICJDb2RlSW1hZ2UuYXNweCIpOw0KICAgICAgICAkKCIjaGVhZGVyX0ltYWdlQ2hlY2siKS5hdHRyKCJzcmMiLCBzdHJMb2dpblVybCArICI/VHlwZVBhcmE9bG9naW5oZWFkZXImIiArIHJhbmQoMTAwMDAwMDApKTsNCiAgICB9DQogICAgdmFyIGNvb2tpZVV0aWwgPSB7fTsNCg0KICAgIGNvb2tpZVV0aWwuc2V0Q3Jvc3NDb29raWUgPSBmdW5jdGlvbiAodXJsLCBrZXksIHZhbHVlLCBleHBpcmVzKSB7DQogICAgICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsNCiAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOw0KICAgICAgICBzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOw0KICAgICAgICB2YXIgZmxhZyA9ICIiOw0KICAgICAgICBpZiAodXJsID09ICIiKSBmbGFnID0gIiZmbGFnPTEiDQogICAgICAgIHNjcmlwdC5zcmMgPSB1cmwgKyAnL2hhbmRsZXJzL2Nyb3NzY29va2llLmFzcHg/a2V5PScgKyBrZXkgKyAnJnZhbHVlPScgKyB2YWx1ZSArICcmZXhwaXJlcz0nICsgZXhwaXJlcyArIGZsYWc7DQogICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICB9DQogICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZXMgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgZXhwaXJlcykgew0KICAgICAgICBjb29raWVVdGlsLnNldENyb3NzQ29va2llKCJodHRwOi8vd3d3LmppbmppYW5naW5ucy5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiaHR0cDovL2ppbmd1YW5naW5ucy5iZXN0d2Vob3RlbC5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiaHR0cDovL3d3dy5tZXRyb3BvbG9ob3RlbHMuY29tIiwga2V5LCB2YWx1ZSwgZXhwaXJlcyk7DQogICAgICAgIGNvb2tpZVV0aWwuc2V0Q3Jvc3NDb29raWUoImh0dHA6Ly9iZXN0YXkuYmVzdHdlaG90ZWwuY29tIiwga2V5LCB2YWx1ZSwgZXhwaXJlcyk7DQogICAgICAgIGNvb2tpZVV0aWwuc2V0Q3Jvc3NDb29raWUoImh0dHA6Ly93d3cuamluamlhbmcuY29tIiwga2V5LCB2YWx1ZSwgZXhwaXJlcyk7DQogICAgICAgIGNvb2tpZVV0aWwuc2V0Q3Jvc3NDb29raWUoImh0dHA6Ly9ob3RlbC5qaW5qaWFuZy5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiaHR0cDovL2hvdGVscy5qaW5qaWFuZy5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiaHR0cDovL3RyYXZlbC5qaW5qaWFuZy5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICB9DQoNCg0KPC9zY3JpcHQ+DQoNCmRksgoZSVXSm1C8Jxn12t6DA6Lf6/r2DoeiKUzcCtl2zb4=" />
  </div>

  <div class="aspNetHidden">

    <input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEdAAL5vZVep93jWuSphMTT9iqIML+AG9XIWL0MAHo1i244782vDMmNd0paaeIeRgTHIehXW+u4g8bHVvld/wdB+ytM" />
  </div>
  <div>


    <div class="header">
      <div class="container clearfix">
        <div class="logo">
          <img src="${pageContext.request.contextPath}/picture/userlogin/wehotel.ashx" alt="">
        </div>
        <nav>
          <ul class="clearfix">
            <li>客服热线：400-820-9999</li>
            <li><a href="http://club.jinjiang.com/aboutj-club/memberService">客户服务</a></li>
            <li><a id="header_0_lbLanguageSwitch" href="javascript:__doPostBack(&#39;header_0$lbLanguageSwitch&#39;,&#39;&#39;)">ENGLISH</a></li>
          </ul>
        </nav>
      </div>
    </div>
    <script>
      var language = 'zh-cn';
      var times = '0';
      var mainDomainStr = 'www.jinjiang.com';
    </script>


    <div class="center">
      <div class="container clearfix">
        <a href="http://www.jinjiang.com/event/pfjjxs/index.html" target="_blank">
          <img class="banner" src="${pageContext.request.contextPath}/picture/userlogin/浦发申卡 1600 600.ashx" alt="">
        </a>
        <div class="section tab-content">
          <ul class="nav nav-tabs clearfix">
            <li class="active"><a href="#form-information" aria-controls="form-information" role="tab" data-toggle="tab">会员账户登录</a></li>
            <li><a href="#phonein" aria-controls="phonein" role="tab" data-toggle="tab">手机快捷登录</a></li>
          </ul>
          <div id="form-information" class="tab-pane active">
            <div class="information-container">
              <div class="error dn">
                <i class="icon icon-error"></i><span class="error-span"></span>
              </div>
              <div class="form-group">
                <%--@declare id="account"--%><label class="icon icon-name" for="account"></label>
                <input class="form-control" type="text" placeholder="用户名/手机/邮箱/会员卡号" name="username">
              </div>
              <div class="form-group">
                <%--@declare id="password"--%><label class="icon icon-lock" for="password"></label>
                <input class="form-control" type="password" placeholder="密码" name="password">
              </div>
              <div class="inline-form-group clearfix hide">
                <input class="form-control" type="text" placeholder="验证码" name="vcode">
                <img id="ImageCheck" src="" alt="">
                <a class="change" href="javascript:;"  id="aImageCheck">换一张</a>
              </div>

              <div class="form-group pr30 pl30 pt15 clearfix">
                <div class="checkbox">
                  <label>
                    <input class="check" type="checkbox" name="ckAutoLogin">
                    <span>30天内自动登录</span>
                  </label>
                </div>
                <a class="forget" href="http://club.jinjiang.com/ForgotPassword/ForgotPasswordMode">忘记密码</a>
              </div>
            </div>
            <div class="information-button">
              <a href="#" class="btn-sub">登录</a>
              <p><a href="http://www.jinjiang.com/NewRegister/NewWebRegister">免费注册</a>，享受特权</p>
            </div>
            <p class="third">
              <span>使用第三方账号登录</span><a href="https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=100429802&redirect_uri=http://www.jinjiang.com/demo/qq&state=6e83425e588b4be1a3bd79efa8152fb5&scope=get_user_info,add_share,list_album,upload_pic,check_page_fans,add_t,add_pic_t,del_t,get_repost_list,get_info,get_other_info,get_fanslist,get_idolist,add_idol,del_idol,add_one_blog,add_topic,get_tenpay_addr" class="icon icon-qq" title="QQ"></a><a href="http://www.jinjiang.com/passer/wechat/login" class="icon icon-wechat" title="微信"></a><a href="https://api.weibo.com:443/oauth2/authorize?client_id=4069918374&redirect_uri=http%3A%2F%2Fclub.jinjiang.com%2Fthird%2Fsina&response_type=code&display=default" class="icon icon-sina" title="微博"></a>
            </p>
          </div>

          <div id="phonein" class="tab-pane">
            <div class="information-container">
              <div class="error dn">
                <i class="icon icon-error"></i><span class="error-span"></span>
              </div>
              <div class="form-group clearfix">
                <input class="form-control phone-form" type="text" placeholder="请输入您的手机号" name="phone-number" maxlength="11">
              </div>

              <div class="inline-form-group clearfix">
                <input class="form-control" type="text" placeholder="右侧验证码" name="vocdes">
                <img  id="ImageCheckP" src="" alt="">
                <a class="change" href="javascript:;" id="aImageCheckP">换一张</a>
              </div>

              <div class="inline-form-group clearfix">
                <input class="form-control" type="text" placeholder="动态密码" name="phone-vocdes">
                <a href="#" class="send-vcode" >发送动态密码</a>
              </div>

              <div class="form-group pr30 pl30 pt15 clearfix">
                <div class="checkbox">
                  <label>
                    <input class="check" type="checkbox"  name="ckAutoLoginP">
                    <span>30天内自动登录</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="information-button">
              <a href="#" class="btn-sub-phone">登录</a>
              <p><a href="http://www.jinjiang.com/NewRegister/NewWebRegister">免费注册</a>，享受特权</p>
            </div>
            <p class="third">
              <span>使用第三方账号登录</span><a href="https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=100429802&redirect_uri=http://www.jinjiang.com/demo/qq&state=6e83425e588b4be1a3bd79efa8152fb5&scope=get_user_info,add_share,list_album,upload_pic,check_page_fans,add_t,add_pic_t,del_t,get_repost_list,get_info,get_other_info,get_fanslist,get_idolist,add_idol,del_idol,add_one_blog,add_topic,get_tenpay_addr" class="icon icon-qq" title="QQ"></a><a href="http://www.jinjiang.com/passer/wechat/login" class="icon icon-wechat" title="微信"></a><a href="https://api.weibo.com:443/oauth2/authorize?client_id=4069918374&redirect_uri=http%3A%2F%2Fclub.jinjiang.com%2Fthird%2Fsina&response_type=code&display=default" class="icon icon-sina" title="微博"></a>
            </p>

          </div>
        </div>
      </div>
    </div>
    <input type="hidden" id="hidTemplateNo" value="validateCodeTemplate2" />
    <input id="randomNum" type="hidden"/>
    <input id="randomNum2" type="hidden"/>

    <div class="footer clearfix">
      <div class="footer">
        <div class="container">
          <div class="footer-menu clearfix">
            <ul>
              <li><a href="http://www.jinjiang.com/aboutus/">关于我们</a></li>
              <li> | </li>
              <li><a href="http://www.jinjiang.com/map/">网站地图</a></li>
              <li> | </li>
              <li><a href="http://www.jinjiang.com/contactUs/">联系我们</a></li>
              <li> | </li>
              <li><a href="http://www.jinjiang.com/career/">加入我们</a></li>
              <li> | </li>
              <li><a href="http://www.jinjiang.com/service/">法律声明</a></li>
              <li> | </li>
              <li><a href="http://www.jinjiang.com/link/">友情链接</a></li>
              <li> | </li>
              <li><a href="http://www.jinjiang.com/help/">帮助中心</a></li>
              <li> | </li>
              <li><a href="http://www.jinjiang.com/userExperience/">用户体验反馈</a></li>
            </ul>
          </div>
          <div class="navfri">
            <p>Copyright2011.Jinjiang.com.all rights reserved</p>
            <p><a style="color:#666;text-decoration:none;" href="http://www.miibeian.gov.cn/state/outPortal/loginPortal.action" target="_blank">沪ICP备05048113号</a><i class="icon icon-police"></i>沪公网安备 31010102002050号</p>
            <p class="police"><i class="icon icon-police01"></i><i class="icon icon-police02"></i><i class="icon icon-police03"></i><i class="icon icon-police04"></i></p>
          </div>
          <div class="code">
            <img src="${pageContext.request.contextPath}/picture/userlogin/code.png" alt="">
          </div>
        </div>
      </div>

    </div>

    <input type="hidden" id="validaeCodeToken" />

    <script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/jquery.cookie.js"></script>
    <script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/stringutil.js"></script>
    <script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/cros.js"></script>
    <div id="loginStateImage" style="height: 0px;"></div>




    <script>
      var limit = 0;
      var loginInterval = null;
      var totalCountForMemberHeader = 0;
      var totalCouponCountForMember = 0;
      var totalLetterCountForMember = 0;
      var hasImageUrl = false;
      var ermFlag = "";
      var ermId = "";
      var clientNumber = "";
      var memberId = "";
      var innsUrl = "http://www.jinjianginns.com";
      var goldmetUrl = "http://jinguanginns.bestwehotel.com";
      var metropoloUrl = "http://www.metropolohotels.com";
      var bestayUrl = "http://bestay.bestwehotel.com";
      var hotelUrl = "http://hotel.jinjiang.com";
      var jjHotelUrl = "http://hotels.jinjiang.com";
      var travelUrl = "http://travel.jinjiang.com";
      var passerUrl = "https://www.jinjiang.com/passer";

      $(document).ready(function () {
        var viewPc = $("#viewPc").val();

        var jjeUtil = (function (parent, $) {
          var my = parent = parent || {};
          my.ermLogout = function () {
            ermId = "clear";
            MeberUtil.setErmCookie("http://www.jinjianginns.com", ermId);
            MeberUtil.setErmCookie("http://jinguanginns.bestwehotel.com", ermId);
            MeberUtil.setErmCookie("http://www.metropolohotels.com", ermId);
            MeberUtil.setErmCookie("http://bestay.bestwehotel.com", ermId);
            MeberUtil.setErmCookie("http://www.jinjiang.com", ermId);
            MeberUtil.setErmCookie("http://hotel.jinjiang.com", ermId);
            MeberUtil.setErmCookie("http://hotels.jinjiang.com", ermId);
            //MeberUtil.setErmCookie("$kangboUrl$", ermId);
            clearInterval(loginInterval);

            if (limit++ > 2) clearInterval(loginInterval);
            console.log("remove cookie:ermFlag");
            $.removeCookie("ermFlag");
          };
          my.viewPc = function () {
            if (viewPc=="1") {
              MeberUtil.setMobileCookie("http://www.jinjianginns.com");
              MeberUtil.setMobileCookie("http://jinguanginns.bestwehotel.com");
              MeberUtil.setMobileCookie("http://www.metropolohotels.com");
              MeberUtil.setMobileCookie("http://bestay.bestwehotel.com");
              MeberUtil.setMobileCookie("http://www.jinjiang.com");
              MeberUtil.setMobileCookie("http://hotel.jinjiang.com");
              MeberUtil.setMobileCookie("http://hotels.jinjiang.com");
              MeberUtil.setMobileCookie("http://travel.jinjiang.com");
              clearInterval(loginInterval);
            }
            if (limit++ > 2) clearInterval(loginInterval);
          };

          my.ermLogin = function () {
            if (ermId != "" && ermId != undefined) {
              MeberUtil.setErmCookie("http://www.jinjianginns.com", ermId + "|" + clientNumber);
              MeberUtil.setErmCookie("http://jinguanginns.bestwehotel.com", ermId + "|" + clientNumber);
              MeberUtil.setErmCookie("http://www.metropolohotels.com", ermId + "|" + clientNumber);
              MeberUtil.setErmCookie("http://bestay.bestwehotel.com", ermId + "|" + clientNumber);
              MeberUtil.setErmCookie("http://www.jinjiang.com", ermId + "|" + clientNumber);
              MeberUtil.setErmCookie("http://hotel.jinjiang.com", ermId + "|" + clientNumber);
              MeberUtil.setErmCookie("http://hotels.jinjiang.com", ermId + "|" + clientNumber);
              //MeberUtil.setErmCookie("$kangboUrl$", ermId + "|" + clientNumber);
              clearInterval(loginInterval);
            }
            if (limit++ > 2) clearInterval(loginInterval);
          };
          my.tryLogin = function (url) {
            if (!readCookie('_JJE_PAS_') || hasImageUrl) {
              $.getJSON(url + "?callback=?", function (data) {
                if (data.value != "" && data.value != undefined) {
                  createCookie(data.name, data.value);
                  var onemonth = $.cookie("rememberMe");
                  MeberUtil.setCookie("http://www.jinjianginns.com", data.value + "|" + memberId + "|" + onemonth);
                  MeberUtil.setCookie("http://jinguanginns.bestwehotel.com", data.value + "|" + memberId + "|" + onemonth);
                  MeberUtil.setCookie("http://www.metropolohotels.com", data.value + "|" + memberId + "|" + onemonth);
                  MeberUtil.setCookie("http://bestay.bestwehotel.com", data.value + "|" + memberId + "|" + onemonth);
                  MeberUtil.setCookie("http://hotel.jinjiang.com", "|" + memberId + "|" + onemonth);
                  MeberUtil.setCookie("http://hotels.jinjiang.com", "|" + memberId + "|" + onemonth);
                  MeberUtil.setCookie("http://travel.jinjiang.com", data.value + "|" + memberId + "|" + onemonth);
                  clearInterval(loginInterval);
                }
              });
            }
            if (limit++ > 2) clearInterval(loginInterval);
          };

          function createCookie(name, value, days) {
            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
              var expires = "; expires=" + date.toGMTString();
            }
            else var expires = "";
            document.cookie = name + "=" + value + expires + "; path=/";
          }

          function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          }
          return parent;
        }(jjeUtil || {}, jQuery));
        var mcode = $("#mcode").val();
        var authStateDependOnPasser = true;

        var MeberUtil = {

          emptyUsrMsg: "请输入您的用户名",
          emptyPwdMsg: "请输入您的密码",
          loginFailMsg: "用户名或密码有误",

          isLogedIn: function () {
            return $.cookie("memberId") != null && $.cookie("identity") == null;
          },

          isMemberPanelExisits: function () {
            return $(".head .logined_box") != null;
          },

          setTotalCount: function () {
            if ($("#MemberMessagesTotalCount").length > 0) {

              //console.log("iCount", iCount);
              totalCountForMemberHeader = totalCouponCountForMember + totalLetterCountForMember;

              $("#MemberMessagesTotalCount").html("(" + totalCountForMemberHeader + ")");
              $("#MemberMessagesTotalCount").attr("title", totalCountForMemberHeader);
            }
          },

          showMemberInfo: function () {
            var param = {
              code: $.cookie("memberId")
            }
            $.ajax({
              type: 'POST',
              url: "/service/getMemberInfo",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                //console.log(result);
                if (result.Success) {
                  //$("#memberLevel").html(result.CardLevelName);
                  $("#memberCardNo").html(result.CardNo);
                  if ($("#member_name_text").length > 0) {
                    $("#member_name_text").html(result.FullName);
                    $("#member_name_text").attr("title", result.FullName);
                  }
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                //console.log("Get MemberInfo Error:", errorThrown);
              }
            });
          },
          setErmCookie: function (url, value) {
            var head = document.getElementsByTagName('head')[0];
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = '/handlers/setermcookie.aspx?id=' + value + '&domain=' + url;
            head.appendChild(script);
          },
          setMobileCookie: function (url) {
            var head = document.getElementsByTagName('head')[0];
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = '/handlers/setmobilecookie.aspx?domain=' + url;;
            head.appendChild(script);
          },
          setCookie: function (url, value) {
            var head = document.getElementsByTagName('head')[0];
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = url + '/handlers/setcookie.aspx?pas=' + value;
            head.appendChild(script);
          }
          ,
          showMemberScore: function () {
            var param = {
              code: $.cookie("memberId")
            }
            $.ajax({
              type: 'POST',
              url: "/service/getMemberScore",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                //console.log(result);
                if (result.Success) {
                  $("#memberScore").html(result.intValue);
                  $("#memberScore").attr("title", result.intValue);
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                //console.log("Get MemberScore Error:", errorThrown);
              }
            });
          },

          showCouponCount: function () {
            var param = {
              code: ($.cookie("memberId") == null || $.cookie("memberId") == "") ? mcode : $.cookie("memberId")
            }
            $.ajax({
              type: 'POST',
              url: "/service/getCouponCount",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                //console.log(result);
                if (result.Success) {
                  var str = "(" + result.unusedCount + ")";
                  $("#myCouponCount").html(str);

                  totalCouponCountForMember = result.unusedCount;
                  MeberUtil.setTotalCount();
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                //console.log("Get CouponCount Error:", errorThrown);
              }
            });
          },

          showInternalLetters: function () {
            var param = {
              memberId: $.cookie("memberId")
            }

            $.ajax({
              type: 'POST',
              url: "/services/unreadInternalLetterCount",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                //console.log("unread", result);
                if (result.Success) {
                  var str = "(" + result.intValue + ")";
                  $("#myLettersCount").html(str);

                  totalLetterCountForMember = result.intValue;
                  MeberUtil.setTotalCount();
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                //console.log("Get CouponCount Error:", errorThrown);
              }
            });

            //setTimeout(MeberUtil.showInternalLetters(), 60000);
          }
        };

        //Rend Image as url from cookie
        if ($.cookie("imageUrl") != null) {
          //console.log("render Image URL");
          $("<img />", { src: $.cookie("imageUrl"), width: 0, height: 0 }).appendTo("#loginStateImage");
          $.removeCookie("imageUrl");
          hasImageUrl = true;

        }
        if ($(".logined").length > 0 && ermFlag != "clear") {
          if (ermFlag == "1") loginInterval = setInterval(function () { jjeUtil.ermLogin(); }, 1000);
          else if (ermId == "") loginInterval = setInterval(function () { jjeUtil.tryLogin("https://www.jinjiang.com/passer/setcookie"); }, 1000);
        }
        if (ermFlag == "clear") loginInterval = setInterval(function () { jjeUtil.ermLogout(); }, 1000);
        if (viewPc == "1") loginInterval = setInterval(function () { jjeUtil.viewPc(); }, 1000);
        //Get Member Info and show in Panel
        if (MeberUtil.isLogedIn() && MeberUtil.isMemberPanelExisits()) {
          MeberUtil.showMemberInfo();
          MeberUtil.showMemberScore();
          //MeberUtil.showCouponCount();

          //MeberUtil.showInternalLetters();
          //setInterval(function () { MeberUtil.showCouponCount(); }, 30000);
          //setInterval(function () { MeberUtil.showInternalLetters(); }, 30000);
        }

        if ($("#header_ImageCheck").length > 0) {
          headChangeCodeImg();
          if ($("#lang").val() == "en" || $("body").hasClass("en")) {
            $("#header_validateCode").attr("data-watermark", "code");
            $("#header_validateCode").attr("value", "code");

            $("#header_aImageCheck").css("color", "#1d7ad9");
            $("#header_ImageCheck").attr("title", "Click Replace verification code image");
          }

        }


        var orderOrigin = $.cookie("orderOrigin");

        //Login State update


        //$("#EnterClub").click(function (event) {
        //    $("#EnterClub").find("a").click();
        //    //location.href = $("#clubUrl").val();
        //});
        //$("#EnterClub1").click(function (event) {
        //    alert($("#EnterClub1").find("a").attr("href"));
        //    $("#EnterClub1").find("a").click();
        //    //window.location.href = $("#clubUrl").val();
        //});

        $(".login_btn").click(function (event) {
          if ($(".login_btn").attr("state") == "login") {
            return;
          }
          else {
            $(".login_btn").css("background", "#a4a4a4");
            $(".login_btn").attr("state", "login")
            if ($("#lang").val() == "en" || $("body").hasClass("en")) {
              $(".login_btn").html("Logining");
            }
            else {
              $(".login_btn").html("登录中");
            }
          }

          event.preventDefault();
          $("#login_box .alarm_text").css("display", "none");

          var param = {};
          param.username = $.trim($("#login_username").val());
          param.password = $.trim($("#login_password").val());
          param.oneMonth = $("#login_box .check_btn").val() === "checked";
          $.cookie("rememberMe", $("#login_box .check_btn").val() === "checked" ? "1" : "0");
          var usrWaterMark = $("#login_username").attr("data-watermark");
          if (param.username.length == 0 || param.username == usrWaterMark) {
            $("#login_box .alarm_text").css("display", "block");
            $("#login_box .alarm_text").html(MeberUtil.emptyUsrMsg);
            $(".login_btn").css("background", "#d1ae76");
            $(".login_btn").attr("state", "")
            if ($("#lang").val() == "en" || $("body").hasClass("en")) {
              $(".login_btn").html("Login");
            }
            else {
              $(".login_btn").html("登录");
            }
            return;
          }

          if (param.password.length == 0) {
            $("#login_box .alarm_text").css("display", "block");
            $("#login_box .alarm_text").html(MeberUtil.emptyPwdMsg);
            $(".login_btn").css("background", "#d1ae76");
            $(".login_btn").attr("state", "")
            if ($("#lang").val() == "en" || $("body").hasClass("en")) {
              $(".login_btn").html("Login");
            }
            else {
              $(".login_btn").html("登录");
            }
            return;
          }
          if (!checkValidateCode("header_validateCode")) {
            $("#login_box .alarm_text").css("display", "block");

            if ($("#lang").val() == "en" || $("body").hasClass("en")) {
              $("#login_box .alarm_text").html("Verification code error");
            }
            else {
              $("#login_box .alarm_text").html("验证码错误");
            }
            $(".login_btn").css("background", "#d1ae76");
            $(".login_btn").attr("state", "")
            if ($("#lang").val() == "en" || $("body").hasClass("en")) {
              $(".login_btn").html("Login");
            }
            else {
              $(".login_btn").html("登录");
            }
            return;
          }
          var data = "usr=" + param.username + "&pwd=" + StringUtil.base64encode(param.password) + "&oneMonth=" + param.oneMonth + "&callback=?" + "&code=" + $("#header_validateCode").val()+"&isheader=1";
          $.ajax({
            type: 'POST',
            url: "http://www.jinjiang.com/Handlers/SsoLoginHandler.ashx",
            dataType: "jsonp",
            jsonp: "callback",
            data: data,
            cache: false,
            async: false,
            success: function (result) {
              if (result == null) {
                return;
              }
              if (result.Success) {

                if (result.url != null && result.url.length > 0) {
                  //Save ImageURL to cookie
                  $.cookie("imageUrl", result.url);
                }
                //Write Cookie for authed
                if (result.token != null) {
                  //console.log("login token", result.token);
                  $.cookie(".ASPXAUTH", result.token);
                }
                if (result.id != null) {
                  //console.log("login memberId", result.id);
                  $.cookie("memberId", result.id);
                }

                location.reload();

              }
              else {
                $("#login_box .alarm_text").css("display", "block");
                if (result.code != null && result.code == "101") {//验证码错误
                  if ($("#lang").val() == "en" || $("body").hasClass("en")) {
                    $("#login_box .alarm_text").html("Verification code error, please try again");
                  }
                  else {
                    $("#login_box .alarm_text").html(result.message);
                  }

                }
                else if (result.code != null && result.code == "301") {//修改密码
                  if ($("#login_box").length > 0) {
                    $("#login_username").val("");
                    $("#login_password").val("");
                    $("#login_box .alarm_text").html("");
                    $("#login_box").css("display","none");
                  }
                  ImprovePassword();
                }
                else {
                  $("#login_box .alarm_text").html(MeberUtil.loginFailMsg);
                }
                $('.num_validate_box').css("display", "block");
                headChangeCodeImg();
                $("#header_validateCode").val("");
                $(".login_btn").css("background", "#d1ae76");
                $(".login_btn").attr("state", "")
                if ($("#lang").val() == "en" || $("body").hasClass("en")) {
                  $(".login_btn").html("Login");
                }
                else {
                  $(".login_btn").html("登录");
                }
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Login Error:", errorThrown);
              $("#login_box .alarm_text").css("display", "block");
              $("#login_box .alarm_text").html(MeberUtil.loginFailMsg);
              headChangeCodeImg();
              $("#header_validateCode").val("");
              $(".login_btn").css("background", "#d1ae76");
              $(".login_btn").attr("state", "")
              if ($("#lang").val() == "en" || $("body").hasClass("en")) {
                $(".login_btn").html("Login");
              }
              else {
                $(".login_btn").html("登录");
              }
            }
          });
        });
        $("#logout").click(function () {

          //remove current auth-cookie
          $.ajax({
            type: 'GET',
            url: "/Handlers/SimpleLogoutHandler.ashx",
            dataType: "jsonp",
            jsonp: "callback",
            // data: "key=.ASPXAUTH",
            cache: false,
            success: function (result) {

              // remove mainSite auth-cookie
              $.ajax({
                type: 'GET',
                url: "http://www.jinjiang.com/Handlers/SimpleLogoutHandler.ashx",
                dataType: "jsonp",
                jsonp: "callback",
                // data: "key=orderOrigin",
                cache: false,
                success: function (result) {
                  if (authStateDependOnPasser)
                    location.href = "http://www.jinjiang.com/passer/logout?go=http%3a%2f%2fwww.jinjiang.com%2fnewlogin%3fgo%3dhttp%253a%252f%252fwww.jinjianginns.com%252f";
                  else
                    location.reload();

                },
                error: function (jqXHR, textStatus, errorThrown) {
                  //console.log("Logout Error:", errorThrown);
                }
              });
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Logout Error:", errorThrown);

            }
          });

        });


        //$(document).keydown(function (event) {

        //    if (event.keyCode == 13) {
        //        if ($("#login_password").is(":focus") || $("login_username").is(":focus"))
        //        {
        //             $(".login_btn").click();
        //        }

        //    }
        //});

      });
      function headChangeCodeImg() {
        var strLoginUrl = ("http://www.jinjiang.com/Handlers/SsoLoginHandler.ashx").replace("SsoLoginHandler.ashx", "CodeImage.aspx");
        $("#header_ImageCheck").attr("src", strLoginUrl + "?TypePara=loginheader&" + rand(10000000));
      }
      var cookieUtil = {};

      cookieUtil.setCrossCookie = function (url, key, value, expires) {
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.type = 'text/javascript';
        var flag = "";
        if (url == "") flag = "&flag=1"
        script.src = url + '/handlers/crosscookie.aspx?key=' + key + '&value=' + value + '&expires=' + expires + flag;
        head.appendChild(script);
      }
      cookieUtil.setCrossCookies = function (key, value, expires) {
        cookieUtil.setCrossCookie("http://www.jinjianginns.com", key, value, expires);
        cookieUtil.setCrossCookie("http://jinguanginns.bestwehotel.com", key, value, expires);
        cookieUtil.setCrossCookie("http://www.metropolohotels.com", key, value, expires);
        cookieUtil.setCrossCookie("http://bestay.bestwehotel.com", key, value, expires);
        cookieUtil.setCrossCookie("http://www.jinjiang.com", key, value, expires);
        cookieUtil.setCrossCookie("http://hotel.jinjiang.com", key, value, expires);
        cookieUtil.setCrossCookie("http://hotels.jinjiang.com", key, value, expires);
        cookieUtil.setCrossCookie("http://travel.jinjiang.com", key, value, expires);
      }


    </script>






    <script type="text/javascript">
      if (/AppleWebKit.*Mobile/i.test(navigator.userAgent) || (/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))) {
        if (window.location.href.indexOf("?mobile") < 0) {
          try {
            if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
              window.location.href = "http://m.jinjiang.com";
            } else if (/iPad/i.test(navigator.userAgent)) {
            }
          } catch (e) { }
        }
      }
    </script>

    <script type='text/javascript'>
      (function (a, b, c, d) {
        a[c] = function () { a[c]['ar'] = a[c]['ar'] || []; a[c]['ar'].push(arguments); };
        var s = b.createElement('script'); s.async = 1; s.src = '//t.agrantsem.com/js/agt.js';
        var r = b.getElementsByTagName('script')[0]; r.parentNode.insertBefore(s, r);
      })(window, document, '_agtjs', 'script');
      _agtjs('init', 'AG_888038_BBVI', 'jinjiang.com');
      _agtjs('trackPv');
    </script>
    <script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/o_code.js"></script>
    <input type="hidden" id="jjIp" value="101.68.87.26, 210.14.68.236" />
    <input type="hidden" id="SessionId" value="yoz2gaowqobi1ztcj4l4geuu" />

    <input type="hidden" id="viewPc" value="" />

    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?a964a82ad5e88e854e0e11f060e4a316";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>





    <input type="hidden" id="sitecommonForgotURL" value="http://club.jinjiang.com/ForgotPassword/ForgotPasswordMode" />

    <input type="hidden" id="sitecommonImageDomain" value="http://Static1.ejinjiang.com" />

    <input type="hidden" id="sitecommonHotelImageDomain" value="http://static.jinjiang.com/opt/static/" />

    <style>

      *{padding: 0;margin: 0;}

      #btn{
        display: block;
        width: 100px;
        height: 30px;
        border: 0;
        background: #f00;
        text-align: center;
        line-height: 30px;
        vertical-align: middle;
        color: #fff;
        font-size: 16px;
      }
      .cover{
        width: 100%;
        height: 100%;
        background: #000;
        background:rgba(0,0,0,0.7);
        position: fixed;
        left: 0;
        top: 0;
        z-index: 99;
        display: none;
      }
      .cover_cont{
        width: 428px;
        height: 300px;
        padding: 22px;
        padding-bottom: 10px;
        background: #fff;
        position: fixed;
        left: 50%;
        top: 50%;
        margin-left: -214px;
        margin-top: -150px;
        z-index: 100;
      }
      .cover_cont h3{
        font-weight: normal;
        color: #96a0a7;
        font-size: 14px;
        padding-bottom: 8px;
        border-bottom:1px solid #dedcdc;
      }
      .cover_cont span{
        display: block;
        text-align: center;
        margin: 8px 0 15px 0;
      }
      .cover_cont p{
        color: #59626a;
        line-height: 24px;
        font-size: 14px;
        padding: 0 14px;
      }
      .cover_cont .update{
        text-align: center;
        padding-top: 22px;
      }
      .cover_cont .update a{
        display: inline-block;
        font-size:16px;
        padding: 5px 18px;
        text-decoration: none;
      }
      .cover_cont .update .a1{
        color: #fff;
        background: #d64c4c;
      }
      .cover_cont .update .a2{
        border: 1px solid #b5b5b5;
        color: #59626a;
        margin-left: 26px;
      }

      /*新增数字验证码*/
      .g_num_validate_box{ margin-bottom:12px;position:relative;}
      .g_num_validate_box .g_num_validate_input{ width:110px; height:30px; line-height:30px; border:1px solid #e0e0e0; background:#fff;border-radius: 3px; text-indent:8px; *margin-left:-10px; float:left; color:#aaa;}
      .g_num_validate_box .g_num_validate_pic{ border:1px solid #7496c4; display:block;float:left; cursor:pointer; margin-left:10px;}
      .g_num_validate_box .g_num_validate_icon{ display:block; height:32px; float:left;cursor:pointer;}
    </style>





  </div>
</form>
<script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/tab_button.js"></script>
<script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/guid.js"></script>
<script type="text/javascript" src="${pageContext.request.contextPath}/js/userlogin/newlogin.js"></script>
</body>
</html>

