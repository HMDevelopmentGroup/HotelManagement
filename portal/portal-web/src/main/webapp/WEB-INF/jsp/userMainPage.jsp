<%--
  Created by IntelliJ IDEA.
  User: myx
  Date: 2018/3/26
  Time: 11:25
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>




<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta http-equiv="Cache-Control" content="public">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="robots" content="all" />
  <meta http-equiv="imagetoolbar" content="no" />
  <meta http-equiv="pragma" content="no-cach" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="baidu-site-verification" content="cfI5HvNrAq" />
  <link type="image/x-icon" href="http://Static1.ejinjiang.com/themes/club/images/favicon.ico" rel="shortcut icon">
  <title>
    我的账户
  </title>
  <link type="text/css" media="all" rel="stylesheet" href="${pageContext.request.contextPath}/css/usermainpage/global_2.css" />
  <link type="text/css" media="all" rel="stylesheet" href="${pageContext.request.contextPath}/css/usermainpage/card_2.css" />
  <link type="text/css" media="all" rel="stylesheet" href="${pageContext.request.contextPath}/css/usermainpage/layer_2.css" />
  <link type="text/css" media="all" rel="stylesheet" href="${pageContext.request.contextPath}/css/usermainpage/bankcard_2.css" />
  <link type="text/css" media="all" rel="stylesheet" href="${pageContext.request.contextPath}/css/usermainpage/coupondetail_2.css"/>
  <link type="text/css" media="all" rel="stylesheet" href="${pageContext.request.contextPath}/css/usermainpage/en_2.css" />
  <link type="text/css" media="all" rel="stylesheet" href="${pageContext.request.contextPath}/css/usermainpage/plus_2.css" />





</head>
<body class="">
<form method="post" action="/MyAccount" id="form">
  <div class="aspNetHidden">
    <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTEyOTk1MDA1NzMPFgIeE1ZhbGlkYXRlUmVxdWVzdE1vZGUCARYGAgEPFgIeBFRleHRlZAIDEGRkFhBmD2QWFGYPFgIeB1Zpc2libGVoFgICAQ8WAh8BBU9odHRwczovL3d3dy5qaW5qaWFuZy5jb20vbmV3bG9naW4/Z289aHR0cCUzYSUyZiUyZmNsdWIuamluamlhbmcuY29tJTJmTXlBY2NvdW50ZAICD2QWAmYPFgIfAQUeaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vYWJvdXQvZAIDDxYCHwJoZAIED2QWGAIBDxYCHwEFF2h0dHA6Ly93d3cuamluamlhbmcuY29tZAIFDxYCHwEFGWh0dHA6Ly9ob3RlbC5qaW5qaWFuZy5jb21kAgkPFgIfAQUaaHR0cDovL2hvdGVscy5qaW5qaWFuZy5jb21kAg0PFgIfAQUeaHR0cDovL3d3dy5tZXRyb3BvbG9ob3RlbHMuY29tZAIRDxYCHwEFG2h0dHA6Ly93d3cuamluamlhbmdpbm5zLmNvbWQCFQ8WAh8BBSRodHRwOi8vamluZ3Vhbmdpbm5zLmJlc3R3ZWhvdGVsLmNvbS9kAhkPFgIfAQUeaHR0cDovL2Jlc3RheS5iZXN0d2Vob3RlbC5jb20vZAIdDxYCHwEFIWh0dHA6Ly9sb3V2cmVob3RlbHMuamluamlhbmcuY29tL2QCIQ8WAh8BBSBodHRwOi8vY2FtcGFuaWxlLmJlc3R3ZWhvdGVsLmNvbWQCJQ8WAh8BBRpodHRwOi8vdHJhdmVsLmppbmppYW5nLmNvbWQCKQ8WAh8BBR1odHRwOi8vd3d3LmppbmppYW5nLmNvbS9hdXRvL2QCLQ8WAh8BBRxodHRwOi8vd3d3LmppbmppYW5nY2FyZC5jb20vZAIFDxYCHwJoZAIGDxYCHwJoZAIHD2QWCAIEDxYCHwEFGGh0dHA6Ly9tYWxsLmppbmppYW5nLmNvbWQCBg8WAh8BBTNodHRwOi8vY2x1Yi5qaW5qaWFuZy5jb20vTXlBY2NvdW50L015Q291cG9ucy9Db3Vwb25kAggPFgIfAQUkaHR0cDovL2NsdWIuamluamlhbmcuY29tL29yZGVyL2hvdGVsZAIKDxYCHwEFImh0dHA6Ly9jbHViLmppbmppYW5nLmNvbS9NeUFjY291bnRkAggPFgIfAmhkAgkPFgIfAQUFemgtQ05kAgoPFgIfAQUIODc3NjU3OTRkAgEPZBYGAgEPDxYCHwEFB0VOR0xJU0hkZAIDDw8WAh8BBQdFTkdMSVNIZGQCBA8WAh4LXyFJdGVtQ291bnQCBBYIZg9kFgRmDxUFAAEvAAYgaWQ9IiIG6aaW6aG1ZAIBDxYEHwMC/////w8fAmhkAgEPZBYEZg8VBQABIwARIGlkPSJleGNoYW5nZUJ0biIM56ev5YiG5YWR5o2iZAIBDxYEHwMCAh8CZxYEAgEPZBYCZg8VAwAcaHR0cDovL21hbGwuYmVzdHdlaG90ZWwuY29tLwznpLzlk4HlhZHmjaJkAgIPZBYCZg8VAwxjbGFzcz0ibGFzdCIOL2xpeGluZy9seEhvbWUS5peF5ri45Lqn5ZOB5YWR5o2iZAICD2QWBGYPFQUACS9QYXJ0bmVycwAADOWQiOS9nOS8meS8tGQCAQ8WBB8DAv////8PHwJoZAIDD2QWBGYPFQUMY2xhc3M9Imxhc3QiDC9BYm91dEotQ2x1YgAADOWFs+S6juS8muWRmGQCAQ8WBB8DAv////8PHwJoZAICD2QWAmYPZBYCZg9kFghmDw8WAh8BBQnpurvlrofovalkZAIBDw8WAh8BBQJWMWRkAgMPDxYCHwFlZGQCBQ8PFgIfAQUG5rC45LmFZGQCAw9kFgJmD2QWAmYPZBYCAgEPFCsAAg8WBB4LXyFEYXRhQm91bmRnHwMCBGRkFghmD2QWBGYPFQMLZGluZ2Rhbi1iYXIADOiuouWNleeuoeeQhmQCAQ8UKwACDxYEHwRnHwMCBWRkFgpmD2QWAmYPFQUAC0hvdGVsT3JkZXJzACYvTXlBY2NvdW50L09yZGVyTWFuYWdlbWVudC9Ib3RlbE9yZGVycwzphZLlupforqLljZVkAgEPZBYCZg8VBQAMVHJhdmVsT3JkZXJzACcvTXlBY2NvdW50L09yZGVyTWFuYWdlbWVudC9UcmF2ZWxPcmRlcnMM5peF5ri46K6i5Y2VZAICD2QWAmYPFQUADUNhclJlbnRPcmRlcnMAKC9NeUFjY291bnQvT3JkZXJNYW5hZ2VtZW50L0NhclJlbnRPcmRlcnMM56ef6L2m6K6i5Y2VZAIDD2QWAmYPFQUACDRTT3JkZXJzACMvTXlBY2NvdW50L09yZGVyTWFuYWdlbWVudC80U09yZGVycwg0U+iuouWNlWQCBA9kFgJmDxUFAAtPdGhlck9yZGVycwAmL015QWNjb3VudC9PcmRlck1hbmFnZW1lbnQvT3RoZXJPcmRlcnMM5YW25LuW6K6i5Y2VZAIBD2QWBGYPFQMJamlmZW4tYmFyAAznp6/liIbnrqHnkIZkAgEPFCsAAg8WBB8EZx8DAgJkZBYEZg9kFgJmDxUFAAhNeVNjb3JlcwAjL015QWNjb3VudC9Qb2ludE1hbmFnZW1lbnQvTXlTY29yZXMM5oiR55qE56ev5YiGZAIBD2QWAmYPFQUADFNjb3JlQ2hlY2tJbgAnL015QWNjb3VudC9Qb2ludE1hbmFnZW1lbnQvU2NvcmVDaGVja0luDOenr+WIhuihpeeZu2QCAg9kFgRmDxUDDnlvdWh1aWp1YW4tYmFyAAnkvJjmg6DliLhkAgEPFCsAAg8WBB8EZx8DAgFkZBYCZg9kFgJmDxUFAAZDb3Vwb24AGy9NeUFjY291bnQvTXlDb3Vwb25zL0NvdXBvbg/kvJjmg6DliLjmn6Xor6JkAgMPZBYEZg8VAwt6aGFuZ2h1LWJhcgJvbgzotKbmiLfnrqHnkIZkAgEPFCsAAg8WBB8EZx8DAgZkZBYMZg9kFgJmDxUFF3N0eWxlPSJkaXNwbGF5OiBibG9jazsiE1BlcnNvbmFsSW5mb3JtYXRpb24ALC9NeUFjY291bnQvQWNjb3VudE1hbmFnZS9QZXJzb25hbEluZm9ybWF0aW9uDOS4quS6uuS/oeaBr2QCAQ9kFgJmDxUFF3N0eWxlPSJkaXNwbGF5OiBibG9jazsiD0FjY291bnRTZWN1cml0eQAoL015QWNjb3VudC9BY2NvdW50TWFuYWdlL0FjY291bnRTZWN1cml0eQzotKbmiLflronlhahkAgIPZBYCZg8VBRdzdHlsZT0iZGlzcGxheTogYmxvY2s7IgxTdWJzY3JpcHRpb24AJS9NeUFjY291bnQvQWNjb3VudE1hbmFnZS9TdWJzY3JpcHRpb24M5oiR55qE6K6i6ZiFZAIDD2QWAmYPFQUXc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyIITWVzc2FnZXMAIS9NeUFjY291bnQvQWNjb3VudE1hbmFnZS9NZXNzYWdlcwzmtojmga/kuK3lv4NkAgQPZBYCZg8VBRdzdHlsZT0iZGlzcGxheTogYmxvY2s7IgpDYXJkTWFuYWdlACMvTXlBY2NvdW50L0FjY291bnRNYW5hZ2UvQ2FyZE1hbmFnZQ/pk7booYzljaHnrqHnkIZkAgUPZBYCZg8VBRdzdHlsZT0iZGlzcGxheTogYmxvY2s7Ig1Db250YWN0TWFuYWdlACYvTXlBY2NvdW50L0FjY291bnRNYW5hZ2UvQ29udGFjdE1hbmFnZQ/luLjnlKjogZTns7vkurpkAgcPZBYCAgEPFgIfAQWdGwo8ZGl2IGNsYXNzPSJmb290ZXIiPiAKICAgIDxkaXYgY2xhc3M9IncxMjAwIGNsZWFyZml4Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJmb290ZXItbWFpbiBjbGVhcmZpeCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxvZ29iYXIiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRpdGxlX3RleHQiPnwg5oiQ5ZGY5LyB5LiaPC9wPgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsb2dvLWJveCBjbGVhcmZpeCI+CiAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSJ3ZWhvdGVsIj48L2xpPgogICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0iampqZCI+PC9saT4KICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9Im1ldHJvcG9sbyI+PC9saT4KICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9ImpqengiPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSJqZ2tqIj48L2xpPgogICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0iYnNraiI+PC9saT4KICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9ImpqdHJhdmVsIj48L2xpPgogICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0iampjYXIiPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSJrYmpkIj48L2xpPgo8bGkgY2xhc3M9ImJ5bCI+PC9saT4KICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJhcHBfY29kZV9ib3giPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGl0bGVfdGV4dCBtYXJfbF8yMCI+fCDmjozkuIrplKbmsZ/vvIzmm7TlpJrkvJjmg6Dpmo/ml7bkuqs8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InR3b19kaW1lbnNpb25fY29kZV9pY29uc19ib3giPgogICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJqaW5qaWFuZ19hcHBfY29kZV9pY29uIiByZWw9IiIgdGl0bGU9IkFQUOS6jOe7tOeggSI+PC9hPgo8IS0tICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImppbmppYW5nX3dlY2hhdF9jb2RlX2ljb24gbWFyX2xfMjAiIHJlbD0iIiB0aXRsZT0i5b6u5L+h5LqM57u056CBIj48L2E+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKIC0tPiAgICAgICAgICAgICAgICAgICAgPGEgc3R5bGU9ImRpc3BsYXk6bm9uZSIgY2xhc3M9ImppbmppYW5nX3N0YXJfaWNvbiBtYXJfbF8yMCIgcmVsPSIiIHRpdGxlPSIiPjwvYT4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYXBwX25hbWVfYm94Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhcHBfdGFnIj5BUFA8L2Rpdj4KPCEtLSAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1hcl9sXzIwIj7lvq7kv6E8L2Rpdj4KIC0tPiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpub25lIiBjbGFzcz0ibWFyX2xfMjAiPjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNsZWFyZml4IHB0MTAiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZXJpZmljYXRpb25fbGlua19ib3giPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGlua3NfYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9Imh0dHA6Ly93d3cuamluamlhbmcuY29tL21hcC8iIHRpdGxlPSLnvZHnq5nlnLDlm74iPue9keermeWcsOWbvjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vY29udGFjdFVzLyIgcmVsPSJub2ZvbGxvdyIgdGl0bGU9IuiBlOezu+aIkeS7rCI+6IGU57O75oiR5LusPC9hPgogICAgICAgICAgICAgICAgICAgICAgICB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSJodHRwOi8vd3d3LmppbmppYW5nLmNvbS9zZXJ2aWNlLyIgcmVsPSJub2ZvbGxvdyIgdGl0bGU9IuazleW+i+WjsOaYjiI+5rOV5b6L5aOw5piOPC9hPiAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPHA+Q29weXJpZ2h0wqkyMDExSmluamlhbmcuY29tLmFsbCByaWdodHMgcmVzZXJ2ZWQ8L3A+CiAgICAgICAgICAgICAgICA8cD4KICAgICAgICAgICAgICAgICAgICA8YSBzdHlsZT0iY29sb3I6I2NjYzt0ZXh0LWRlY29yYXRpb246bm9uZTsiIGhyZWY9Imh0dHA6Ly93d3cubWlpYmVpYW4uZ292LmNuL3N0YXRlL291dFBvcnRhbC9sb2dpblBvcnRhbC5hY3Rpb24iIHRhcmdldD0iX2JsYW5rIj7msqpJQ1DlpIcwNTA0ODExM+WPtzwvYT4KICAgICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZyaWVuZGx5X2xpbmtzX2JveCBjbGVhcmZpeCI+ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGEgY2xhc3M9ImdvbmdzaGFuZ19pY29uIiByZWw9Im5vZm9sbG93IiBocmVmPSJodHRwOi8vd3d3LnNncy5nb3YuY24vbHovbGljZW5zZUxpbmsuZG8/bWV0aG9kPWxpY2VuY2VWaWV3JmFtcDtlbnR5SWQ9MjAxMzA3MTYxMzEzMTMzMSIgdGl0bGU9IuS4iua1t+W3peWVhiI+PC9hPiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGEgY2xhc3M9Im5ldF9wb2xpY2VtYW4iIHJlbD0ibm9mb2xsb3ciIGhyZWY9Imh0dHA6Ly9zaC5jeWJlcnBvbGljZS5jbi8iIHRpdGxlPSLkuIrmtbfnvZHoraYiPjwvYT4gICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJjb2xsZWN0X2NyZWRpdCIgcmVsPSJub2ZvbGxvdyIgaHJlZj0iaHR0cDovL3d3dy56eDExMC5vcmcvIiB0aXRsZT0i5b6B5L+h572RIj48L2E+ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8YSBjbGFzcz0idmVyaWZ5X3N1Y2Nlc3MiIHJlbD0ibm9mb2xsb3ciIGhyZWY9Imh0dHA6Ly93d3cuamluamlhbmcuY29tLyMiIHRpdGxlPSLlronlhajpqozor4EiPjwvYT4gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Imh0dHA6Ly93d3cuYmVpYW4uZ292LmNuL3BvcnRhbC9yZWdpc3RlclN5c3RlbUluZm8/cmVjb3JkY29kZT0zMTAxMDEwMjAwMjA1MCIgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBoZWlnaHQ6IDIwcHg7IGxpbmUtaGVpZ2h0OiAyMHB4OyBtYXJnaW4tdG9wOiA2cHg7IG1hcmdpbi1sZWZ0OiAxMHB4O2NvbG9yOiNjY2M7Ij48aW1nIHNyYz0iaHR0cDovL3d3dy5iZWlhbi5nb3YuY24vZmlsZS9naHMucG5nIiBzdHlsZT0iZmxvYXQ6bGVmdDsgbWFyZ2luLXJpZ2h0OjRweDsiPuayquWFrOe9keWuieWkhyAzMTAxMDEwMjAwMjA1MOWPtzwvYT4KICAgICAgICAgICAgPC9kaXY+ICAKICAgICAgICA8L2Rpdj4gICAgICAgICAKICAgIDwvZGl2Pgo8L2Rpdj4KZAIIDxYCHwEFVjxzY3JpcHQgc3JjPSIvdGhlbWVzL2NsdWIvanMvanF1ZXJ5LXVpLWRhdGVwaWNrZXIuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+ZAIJD2QWGAICDxYCHwFlZAIDDxYCHwFlZAIEDxYCHwFlZAIFDxYCHwFlZAIGDxYCHwFlZAIHDxYCHwFlZAIIDxYCHwFlZAIJDxYCHwFlZAIKDxYCHwFlZAILDxYCHwFlZAIMDxYCHwFlZAINDxYCHwFlZAIKD2QWBGYPFgIfAQWdRw0KDQoNCjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4NCiAgICB2YXIgbGltaXQgPSAwOw0KDQogICAgdmFyIE5hbWVJbnB1dCA9ICLor7fovpPlhaXnlKjmiLflkI0iOw0KICAgIHZhciBQc2RJbnB1dCA9ICLor7fovpPlhaXlr4bnoIEiOw0KICAgIHZhciBlcnJvck1zZyA9ICLnlKjmiLflkI3miJblr4bnoIHplJnor68iOw0KICAgIHZhciBsb2dpbmZhaWwgPSAi55m76ZmG5aSx6LSlIjsNCiAgICB2YXIgaGFzSW1hZ2VVcmwgPSBmYWxzZTsNCiAgICB2YXIgbG9naW5JbnRlcnZhbCA9IG51bGw7DQogICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIikgew0KICAgICAgICBOYW1lSW5wdXQgPSAiRW50ZXIgeW91ciB1c2VybmFtZSI7DQogICAgICAgIFBzZElucHV0ID0gIkVudGVyIHlvdXIgcGFzc3dvcmQiOw0KICAgICAgICBlcnJvck1zZyA9ICJXcm9uZyB1c2VybmFtZSBvciBwYXNzd29yZCI7DQogICAgICAgIGxvZ2luZmFpbCA9ICJMb2dpbiBmYWlsIjsNCiAgICB9DQoNCiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBuZXdMb2dpblVybCA9ICdodHRwczovL3d3dy5qaW5qaWFuZy5jb20vbmV3bG9naW4nOw0KICAgICAgICB2YXIgYXV0aFN0YXRlRGVwZW5kT25QYXNzZXIgPSB0cnVlOw0KDQogICAgICAgIHZhciBDbHViVXRpbCA9IHsNCg0KICAgICAgICAgICAgaXNMb2dlZEluOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICQuY29va2llKCJtZW1iZXJJZCIpICE9IG51bGw7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0Q29va2llOiBmdW5jdGlvbiAodXJsLCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsNCiAgICAgICAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgICAgICAgICAgc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCiAgICAgICAgICAgICAgICBzY3JpcHQuc3JjID0gdXJsICsgJy9oYW5kbGVycy9zZXRjb29raWUuYXNweD9wYXM9JyArIHZhbHVlOw0KICAgICAgICAgICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgLA0KICAgICAgICAgICAgZG9TaWdub3V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgLy9yZW1vdmUgY3VycmVudCBhdXRoLWNvb2tpZQ0KICAgICAgICAgICAgICAgICQuYWpheCh7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLA0KICAgICAgICAgICAgICAgICAgICB1cmw6ICIvSGFuZGxlcnMvU2ltcGxlTG9nb3V0SGFuZGxlci5hc2h4IiwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29ucCIsDQogICAgICAgICAgICAgICAgICAgIGpzb25wOiAiY2FsbGJhY2siLA0KICAgICAgICAgICAgICAgICAgICAvLyBkYXRhOiAia2V5PS5BU1BYQVVUSCIsDQogICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgew0KDQogICAgICAgICAgICAgICAgICAgICAgICAvL3JlbW92ZSBNYWluU2l0ZSBhdXRoLWNvb2tpZQ0KICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICJodHRwOi8vd3d3LmppbmppYW5nLmNvbS9IYW5kbGVycy9TaW1wbGVMb2dvdXRIYW5kbGVyLmFzaHgiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbnAiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzb25wOiAiY2FsbGJhY2siLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGE6ICJrZXk9JG1haW5TaXRlS2V5JCIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5yZW1vdmVDb29raWUoIi5BU1BYQVVUSCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnJlbW92ZUNvb2tpZSgibWVtYmVySWQiKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aFN0YXRlRGVwZW5kT25QYXNzZXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gImh0dHA6Ly93d3cuamluamlhbmcuY29tL3Bhc3Nlci9sb2dvdXQ/Z289aHR0cDovL2NsdWIuamluamlhbmcuY29tL015QWNjb3VudCI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSAiLyI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJMb2dvdXQgRXJyb3I6IiwgZXJyb3JUaHJvd24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiTG9nb3V0IEVycm9yOiIsIGVycm9yVGhyb3duKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCg0KICAgICAgICAgICAgaXNFbXB0eTogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAodmFsdWUpID09ICd1bmRlZmluZWQnKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICBob21lTG9naW5WYWxpZGF0ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICQoIiNtc2dfY29yZCIpLmh0bWwoIiIpOw0KDQogICAgICAgICAgICAgICAgdmFyIHVzciA9ICQudHJpbSgkKCIjdXNlck5hbWUiKS52YWwoKSk7DQogICAgICAgICAgICAgICAgdmFyIHB3ZCA9ICQudHJpbSgkKCIjcGFzc3dvcmQiKS52YWwoKSk7DQoNCiAgICAgICAgICAgICAgICBpZiAoQ2x1YlV0aWwuaXNFbXB0eSh1c3IpKSB7DQogICAgICAgICAgICAgICAgICAgICQoIiNtc2dfY29yZCIpLmh0bWwoTmFtZUlucHV0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChDbHViVXRpbC5pc0VtcHR5KHB3ZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiI21zZ19jb3JkIikuaHRtbChQc2RJbnB1dCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIGhvbWVEb0xvZ2luOiBmdW5jdGlvbiAoKSB7DQoNCiAgICAgICAgICAgICAgICB2YXIgcGFyYW0gPSB7DQogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAkLnRyaW0oJCgiI3VzZXJOYW1lIikudmFsKCkpLA0KICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogJC50cmltKCQoIiNwYXNzd29yZCIpLnZhbCgpKSwNCiAgICAgICAgICAgICAgICAgICAgb25lTW9udGg6ICQoIiNyZW1lbWJlck1lIikuYXR0cigiY2hlY2tlZCIpID09PSAiY2hlY2tlZCINCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICQuY29va2llKCJyZW1lbWJlck1lIiwgJCgiI3JlbWVtYmVyTWUiKS5hdHRyKCJjaGVja2VkIikgPT09ICJjaGVja2VkIiA/ICIxIiA6ICIwIik7DQoNCiAgICAgICAgICAgICAgICBpZiAoIWNoZWNrVmFsaWRhdGVDb2RlKCJsb2dpbkZvcm1fdmFsaWRhdGVDb2RlIikpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiI21zZ19jb3JkIikuaHRtbCgiVmVyaWZpY2F0aW9uIGNvZGUgZXJyb3IiKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoIiNtc2dfY29yZCIpLmh0bWwoIumqjOivgeeggemUmeivryIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICJ1c3I9IiArIHBhcmFtLnVzZXJuYW1lICsgIiZwd2Q9IiArIFN0cmluZ1V0aWwuYmFzZTY0ZW5jb2RlKHBhcmFtLnBhc3N3b3JkKSArICImb25lTW9udGg9IiArIHBhcmFtLm9uZU1vbnRoICsgIiZjYWxsYmFjaz0/IiArICImY29kZT0iICsgJCgiI2xvZ2luRm9ybV92YWxpZGF0ZUNvZGUiKS52YWwoKSArICImaXNoZWFkZXI9MSI7DQoNCiAgICAgICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsDQogICAgICAgICAgICAgICAgICAgIHVybDogImh0dHA6Ly93d3cuamluamlhbmcuY29tL0hhbmRsZXJzL1Nzb0xvZ2luSGFuZGxlci5hc2h4IiwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29ucCIsDQogICAgICAgICAgICAgICAgICAgIGpzb25wOiAiY2FsbGJhY2siLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLA0KICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC51cmwgIT0gbnVsbCAmJiByZXN1bHQudXJsLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5jb29raWUoImltYWdlVXJsIiwgcmVzdWx0LnVybCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKHJlc3VsdC50b2tlbiAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgJC5jb29raWUoIi5BU1BYQVVUSCIsIHJlc3VsdC50b2tlbiwgeyBleHBpcmVzOiAxIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaWQgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmNvb2tpZSgibWVtYmVySWQiLCByZXN1bHQuaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuY29kZSAhPSBudWxsICYmIHJlc3VsdC5jb2RlID09ICIxMDEiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCIjbGFuZyIpLnZhbCgpID09ICJlbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNtc2dfY29yZCIpLmh0bWwoIlZlcmlmaWNhdGlvbiBjb2RlIGVycm9yLCBwbGVhc2UgdHJ5IGFnYWluIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbXNnX2NvcmQiKS5odG1sKHJlc3VsdC5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQuY29kZSAhPSBudWxsICYmIHJlc3VsdC5jb2RlID09ICIzMDEiKSB7Ly/kv67mlLnlr4bnoIEgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCIjbG9naW5fYm94IikubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX3VzZXJuYW1lIikudmFsKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNsb2dpbl9wYXNzd29yZCIpLnZhbCgiIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuaHRtbCgiIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IikuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoIiN1c2VyTmFtZSIpLnZhbCgpLnRyaW0oKS5sZW5ndGggPiAwIHx8ICQoIiNwYXNzd29yZCIpLnZhbCgpLnRyaW0oKS5sZW5ndGggPiAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjdXNlck5hbWUiKS52YWwoIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI3Bhc3N3b3JkIikudmFsKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbXByb3ZlUGFzc3dvcmQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNtc2dfY29yZCIpLmh0bWwoZXJyb3JNc2cpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dpbkZvcm1DaGFuZ2VDb2RlSW1nKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luRm9ybV92YWxpZGF0ZUNvZGUiKS52YWwoIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhlcnJvclRocm93bik7DQogICAgICAgICAgICAgICAgICAgICAgICAkKCIjbXNnX2NvcmQiKS5odG1sKGxvZ2luZmFpbCk7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2dpbkZvcm1DaGFuZ2VDb2RlSW1nKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5Gb3JtX3ZhbGlkYXRlQ29kZSIpLnZhbCgiIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICANCg0KDQogICAgICAgIC8vbG9nb3V0DQogICAgICAgICQoIiNoZWFkZXJTaWduT3V0TGluayIpLm9uKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCg0KICAgICAgICAgICAgQ2x1YlV0aWwuZG9TaWdub3V0KCk7DQogICAgICAgIH0pOw0KICAgICAgICAkKCIjaGVhZGVyU2lnbk91dExpbmsiKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCg0KICAgICAgICAgICAgQ2x1YlV0aWwuZG9TaWdub3V0KCk7DQogICAgICAgIH0pOw0KDQoNCiAgICAgICAgLy9Mb2dpbiBidG4gY2xpY2sgb24gSE9NRQ0KICAgICAgICB2YXIgZHVjSGVpZ2h0ID0gJChkb2N1bWVudCkuaGVpZ2h0KCk7DQogICAgICAgICQoIi5wYWdlLWNvdmVyIikuY3NzKCJoZWlnaHQiLCBkdWNIZWlnaHQpOw0KICAgICAgICAkKCIubG9naW5fYiIpLmZpbmQoIi5idG4iKS5vbigiY2xpY2siLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gbmV3TG9naW5VcmwgKyAiP2dvPSIgKyBlbmNvZGVVUklDb21wb25lbnQobG9jYXRpb24ub3JpZ2luKTsNCiAgICAgICAgfSk7DQoNCg0KICAgICAgICAkKCIuZ2xvX2J0bl8xIikub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KDQogICAgICAgICAgICBpZiAoIUNsdWJVdGlsLmhvbWVMb2dpblZhbGlkYXRlKCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIENsdWJVdGlsLmhvbWVEb0xvZ2luKCk7DQogICAgICAgIH0pOw0KICAgICAgDQoNCg0KICAgIH0pOw0KICAgIGZ1bmN0aW9uIGxvZ2luRm9ybUNoYW5nZUNvZGVJbWcoKSB7DQogICAgICAgIHZhciBzdHJMb2dpblVybCA9ICgiaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vSGFuZGxlcnMvU3NvTG9naW5IYW5kbGVyLmFzaHgiKS5yZXBsYWNlKCJTc29Mb2dpbkhhbmRsZXIuYXNoeCIsICJDb2RlSW1hZ2UuYXNweCIpOw0KICAgICAgICAkKCIjbG9naW5Gb3JtX0ltYWdlQ2hlY2siKS5hdHRyKCJzcmMiLCBzdHJMb2dpblVybCArICI/VHlwZVBhcmE9bG9naW5oZWFkZXImIiArIHJhbmQoMTAwMDAwMDApKTsNCiAgICB9DQo8L3NjcmlwdD4NCmQCAQ9kFgJmDxYCHwEFxscBDQo8c2NyaXB0Pg0KICAgIHZhciBsaW1pdCA9IDA7DQogICAgdmFyIGxvZ2luSW50ZXJ2YWwgPSBudWxsOw0KICAgIHZhciB0b3RhbENvdW50Rm9yTWVtYmVySGVhZGVyID0gMDsNCiAgICB2YXIgdG90YWxDb3Vwb25Db3VudEZvck1lbWJlciA9IDA7DQogICAgdmFyIHRvdGFsTGV0dGVyQ291bnRGb3JNZW1iZXIgPSAwOw0KICAgIHZhciBoYXNJbWFnZVVybCA9IGZhbHNlOw0KICAgIHZhciBlcm1GbGFnID0gIiI7DQogICAgdmFyIGVybUlkID0gIiI7DQogICAgdmFyIGNsaWVudE51bWJlciA9ICIiOw0KICAgIHZhciBtZW1iZXJJZCA9ICI4Nzc2NTc5NCI7DQogICAgalF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciB2aWV3UGMgPSBqUXVlcnkoIiN2aWV3UGMiKS52YWwoKTsNCg0KICAgICAgICB2YXIgamplVXRpbCA9IChmdW5jdGlvbiAocGFyZW50LCAkKSB7DQogICAgICAgICAgICB2YXIgbXkgPSBwYXJlbnQgPSBwYXJlbnQgfHwge307DQogICAgICAgICAgICBteS5lcm1Mb2dvdXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgZXJtSWQgPSAiY2xlYXIiOw0KICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRFcm1Db29raWUoImh0dHA6Ly93d3cuamluamlhbmdpbm5zLmNvbSIsIGVybUlkKTsNCiAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vamluZ3Vhbmdpbm5zLmJlc3R3ZWhvdGVsLmNvbSIsIGVybUlkKTsNCiAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vd3d3Lm1ldHJvcG9sb2hvdGVscy5jb20iLCBlcm1JZCk7DQogICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2Jlc3RheS5iZXN0d2Vob3RlbC5jb20iLCBlcm1JZCk7DQogICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL3d3dy5qaW5qaWFuZy5jb20iLCBlcm1JZCk7DQogICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2hvdGVscy5qaW5qaWFuZy5jb20iLCBlcm1JZCk7DQogICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiIiwgZXJtSWQpOw0KICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQoNCiAgICAgICAgICAgICAgICBpZiAobGltaXQrKyA+IDIpIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coInJlbW92ZSBjb29raWU6ZXJtRmxhZyIpOw0KICAgICAgICAgICAgICAgICQucmVtb3ZlQ29va2llKCJlcm1GbGFnIik7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgbXkudmlld1BjID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGlmICh2aWV3UGM9PSIxIikgew0KICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0TW9iaWxlQ29va2llKCJodHRwOi8vd3d3LmppbmppYW5naW5ucy5jb20iKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldE1vYmlsZUNvb2tpZSgiaHR0cDovL2ppbmd1YW5naW5ucy5iZXN0d2Vob3RlbC5jb20iKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldE1vYmlsZUNvb2tpZSgiaHR0cDovL3d3dy5tZXRyb3BvbG9ob3RlbHMuY29tIik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRNb2JpbGVDb29raWUoImh0dHA6Ly9iZXN0YXkuYmVzdHdlaG90ZWwuY29tIik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRNb2JpbGVDb29raWUoImh0dHA6Ly93d3cuamluamlhbmcuY29tIik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRNb2JpbGVDb29raWUoImh0dHA6Ly9ob3RlbHMuamluamlhbmcuY29tIik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRNb2JpbGVDb29raWUoIiIpOw0KICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0TW9iaWxlQ29va2llKCJodHRwOi8vdHJhdmVsLmppbmppYW5nLmNvbSIpOw0KICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGxvZ2luSW50ZXJ2YWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGltaXQrKyA+IDIpIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBteS5lcm1Mb2dpbiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBpZiAoZXJtSWQgIT0gIiIgJiYgZXJtSWQgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRFcm1Db29raWUoImh0dHA6Ly93d3cuamluamlhbmdpbm5zLmNvbSIsIGVybUlkICsgInwiICsgY2xpZW50TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2ppbmd1YW5naW5ucy5iZXN0d2Vob3RlbC5jb20iLCBlcm1JZCArICJ8IiArIGNsaWVudE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRFcm1Db29raWUoImh0dHA6Ly93d3cubWV0cm9wb2xvaG90ZWxzLmNvbSIsIGVybUlkICsgInwiICsgY2xpZW50TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiaHR0cDovL2Jlc3RheS5iZXN0d2Vob3RlbC5jb20iLCBlcm1JZCArICJ8IiArIGNsaWVudE51bWJlcik7DQogICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRFcm1Db29raWUoImh0dHA6Ly93d3cuamluamlhbmcuY29tIiwgZXJtSWQgKyAifCIgKyBjbGllbnROdW1iZXIpOw0KICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0RXJtQ29va2llKCJodHRwOi8vaG90ZWxzLmppbmppYW5nLmNvbSIsIGVybUlkICsgInwiICsgY2xpZW50TnVtYmVyKTsNCiAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldEVybUNvb2tpZSgiIiwgZXJtSWQgKyAifCIgKyBjbGllbnROdW1iZXIpOyAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChsb2dpbkludGVydmFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGxpbWl0KysgPiAyKSBjbGVhckludGVydmFsKGxvZ2luSW50ZXJ2YWwpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIG15LnRyeUxvZ2luID0gZnVuY3Rpb24gKHVybCkgew0KICAgICAgICAgICAgICAgIGlmICghcmVhZENvb2tpZSgnX0pKRV9QQVNfJykgfHwgaGFzSW1hZ2VVcmwpIHsNCiAgICAgICAgICAgICAgICAgICAgJC5nZXRKU09OKHVybCArICI/Y2FsbGJhY2s9PyIsIGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS52YWx1ZSAhPSAiIiAmJiBkYXRhLnZhbHVlICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZUNvb2tpZShkYXRhLm5hbWUsIGRhdGEudmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbmVtb250aCA9ICQuY29va2llKCJyZW1lbWJlck1lIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldENvb2tpZSgiaHR0cDovL3d3dy5qaW5qaWFuZ2lubnMuY29tIiwgZGF0YS52YWx1ZSArICJ8IiArIG1lbWJlcklkICsgInwiICsgb25lbW9udGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRDb29raWUoImh0dHA6Ly9qaW5ndWFuZ2lubnMuYmVzdHdlaG90ZWwuY29tIiwgZGF0YS52YWx1ZSArICJ8IiArIG1lbWJlcklkICsgInwiICsgb25lbW9udGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRDb29raWUoImh0dHA6Ly93d3cubWV0cm9wb2xvaG90ZWxzLmNvbSIsIGRhdGEudmFsdWUgKyAifCIgKyBtZW1iZXJJZCArICJ8IiArIG9uZW1vbnRoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0Q29va2llKCJodHRwOi8vYmVzdGF5LmJlc3R3ZWhvdGVsLmNvbSIsIGRhdGEudmFsdWUgKyAifCIgKyBtZW1iZXJJZCArICJ8IiArIG9uZW1vbnRoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0Q29va2llKCJodHRwOi8vaG90ZWxzLmppbmppYW5nLmNvbSIsICJ8IiArIG1lbWJlcklkICsgInwiICsgb25lbW9udGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRDb29raWUoIiIsICJ8IiArIG1lbWJlcklkICsgInwiICsgb25lbW9udGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lYmVyVXRpbC5zZXRDb29raWUoImh0dHA6Ly90cmF2ZWwuamluamlhbmcuY29tIiwgZGF0YS52YWx1ZSArICJ8IiArIG1lbWJlcklkICsgInwiICsgb25lbW9udGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGltaXQrKyA+IDIpIGNsZWFySW50ZXJ2YWwobG9naW5JbnRlcnZhbCk7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVDb29raWUobmFtZSwgdmFsdWUsIGRheXMpIHsNCiAgICAgICAgICAgICAgICBpZiAoZGF5cykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIChkYXlzICogMjQgKiA2MCAqIDYwICogMTAwMCkpOw0KICAgICAgICAgICAgICAgICAgICB2YXIgZXhwaXJlcyA9ICI7IGV4cGlyZXM9IiArIGRhdGUudG9HTVRTdHJpbmcoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB2YXIgZXhwaXJlcyA9ICIiOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAiPSIgKyB2YWx1ZSArIGV4cGlyZXMgKyAiOyBwYXRoPS8iOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiByZWFkQ29va2llKG5hbWUpIHsNCiAgICAgICAgICAgICAgICB2YXIgbmFtZUVRID0gbmFtZSArICI9IjsNCiAgICAgICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBjID0gY2FbaV07DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PSAnICcpIGMgPSBjLnN1YnN0cmluZygxLCBjLmxlbmd0aCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChjLmluZGV4T2YobmFtZUVRKSA9PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCwgYy5sZW5ndGgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBwYXJlbnQ7DQogICAgICAgIH0oamplVXRpbCB8fCB7fSwgalF1ZXJ5KSk7DQogICAgICAgIHZhciBtY29kZSA9IGpRdWVyeSgiI21jb2RlIikudmFsKCk7DQogICAgICAgIHZhciBhdXRoU3RhdGVEZXBlbmRPblBhc3NlciA9IHRydWU7DQoNCiAgICAgICAgdmFyIE1lYmVyVXRpbCA9IHsNCg0KICAgICAgICAgICAgZW1wdHlVc3JNc2c6ICLor7fovpPlhaXmgqjnmoTnlKjmiLflkI0iLA0KICAgICAgICAgICAgZW1wdHlQd2RNc2c6ICLor7fovpPlhaXmgqjnmoTlr4bnoIEiLA0KICAgICAgICAgICAgbG9naW5GYWlsTXNnOiAi55So5oi35ZCN5oiW5a+G56CB5pyJ6K+vIiwNCg0KICAgICAgICAgICAgaXNMb2dlZEluOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICQuY29va2llKCJtZW1iZXJJZCIpICE9IG51bGwgJiYgJC5jb29raWUoImlkZW50aXR5IikgPT0gbnVsbDsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIGlzTWVtYmVyUGFuZWxFeGlzaXRzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICQoIi5oZWFkIC5sb2dpbmVkX2JveCIpICE9IG51bGw7DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICBzZXRUb3RhbENvdW50OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKCQoIiNNZW1iZXJNZXNzYWdlc1RvdGFsQ291bnQiKS5sZW5ndGggPiAwKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiaUNvdW50IiwgaUNvdW50KTsNCiAgICAgICAgICAgICAgICAgICAgdG90YWxDb3VudEZvck1lbWJlckhlYWRlciA9IHRvdGFsQ291cG9uQ291bnRGb3JNZW1iZXIgKyB0b3RhbExldHRlckNvdW50Rm9yTWVtYmVyOw0KDQogICAgICAgICAgICAgICAgICAgICQoIiNNZW1iZXJNZXNzYWdlc1RvdGFsQ291bnQiKS5odG1sKCIoIiArIHRvdGFsQ291bnRGb3JNZW1iZXJIZWFkZXIgKyAiKSIpOw0KICAgICAgICAgICAgICAgICAgICAkKCIjTWVtYmVyTWVzc2FnZXNUb3RhbENvdW50IikuYXR0cigidGl0bGUiLCB0b3RhbENvdW50Rm9yTWVtYmVySGVhZGVyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICBzaG93TWVtYmVySW5mbzogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgY29kZTogJC5jb29raWUoIm1lbWJlcklkIikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLA0KICAgICAgICAgICAgICAgICAgICB1cmw6ICIvc2VydmljZS9nZXRNZW1iZXJJbmZvIiwNCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdKU09OJywNCiAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW0sDQogICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlRGF0YSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEpTT04ucGFyc2UocmVzcG9uc2VEYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2Vzcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJCgiI21lbWJlckxldmVsIikuaHRtbChyZXN1bHQuQ2FyZExldmVsTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI21lbWJlckNhcmRObyIpLmh0bWwocmVzdWx0LkNhcmRObyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoIiNtZW1iZXJfbmFtZV90ZXh0IikubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbWVtYmVyX25hbWVfdGV4dCIpLmh0bWwocmVzdWx0LkZ1bGxOYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI21lbWJlcl9uYW1lX3RleHQiKS5hdHRyKCJ0aXRsZSIsIHJlc3VsdC5GdWxsTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiR2V0IE1lbWJlckluZm8gRXJyb3I6IiwgZXJyb3JUaHJvd24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0RXJtQ29va2llOiBmdW5jdGlvbiAodXJsLCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsNCiAgICAgICAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgICAgICAgICAgc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCiAgICAgICAgICAgICAgICBzY3JpcHQuc3JjID0gdXJsICsgJy9oYW5kbGVycy9zZXRlcm1jb29raWUuYXNweD9pZD0nICsgdmFsdWU7DQogICAgICAgICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldE1vYmlsZUNvb2tpZTogZnVuY3Rpb24gKHVybCkgew0KICAgICAgICAgICAgICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsNCiAgICAgICAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgICAgICAgICAgc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCiAgICAgICAgICAgICAgICBzY3JpcHQuc3JjID0gdXJsICsgJy9oYW5kbGVycy9zZXRtb2JpbGVjb29raWUuYXNweCc7DQogICAgICAgICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldENvb2tpZTogZnVuY3Rpb24gKHVybCwgdmFsdWUpIHsNCiAgICAgICAgICAgICAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07DQogICAgICAgICAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOw0KICAgICAgICAgICAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7DQogICAgICAgICAgICAgICAgc2NyaXB0LnNyYyA9IHVybCArICcvaGFuZGxlcnMvc2V0Y29va2llLmFzcHg/cGFzPScgKyB2YWx1ZTsNCiAgICAgICAgICAgICAgICBoZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7DQogICAgICAgICAgICB9DQogICAgICAgICwNCiAgICAgICAgICAgIHNob3dNZW1iZXJTY29yZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgY29kZTogJC5jb29raWUoIm1lbWJlcklkIikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLA0KICAgICAgICAgICAgICAgICAgICB1cmw6ICIvc2VydmljZS9nZXRNZW1iZXJTY29yZSIsDQogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnSlNPTicsDQogICAgICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtLA0KICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZURhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3BvbnNlRGF0YSk7DQogICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LlN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbWVtYmVyU2NvcmUiKS5odG1sKHJlc3VsdC5pbnRWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI21lbWJlclNjb3JlIikuYXR0cigidGl0bGUiLCByZXN1bHQuaW50VmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiR2V0IE1lbWJlclNjb3JlIEVycm9yOiIsIGVycm9yVGhyb3duKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSwNCg0KICAgICAgICAgICAgc2hvd0NvdXBvbkNvdW50OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIHBhcmFtID0gew0KICAgICAgICAgICAgICAgICAgICBjb2RlOiAoJC5jb29raWUoIm1lbWJlcklkIikgPT0gbnVsbCB8fCAkLmNvb2tpZSgibWVtYmVySWQiKSA9PSAiIikgPyBtY29kZSA6ICQuY29va2llKCJtZW1iZXJJZCIpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICQuYWpheCh7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywNCiAgICAgICAgICAgICAgICAgICAgdXJsOiAiL3NlcnZpY2UvZ2V0Q291cG9uQ291bnQiLA0KICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ0pTT04nLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbSwNCiAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2VEYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZURhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXN1bHQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9ICIoIiArIHJlc3VsdC51bnVzZWRDb3VudCArICIpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbXlDb3Vwb25Db3VudCIpLmh0bWwoc3RyKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQ291cG9uQ291bnRGb3JNZW1iZXIgPSByZXN1bHQudW51c2VkQ291bnQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWViZXJVdGlsLnNldFRvdGFsQ291bnQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkdldCBDb3Vwb25Db3VudCBFcnJvcjoiLCBlcnJvclRocm93bik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIHNob3dJbnRlcm5hbExldHRlcnM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgcGFyYW0gPSB7DQogICAgICAgICAgICAgICAgICAgIG1lbWJlcklkOiAkLmNvb2tpZSgibWVtYmVySWQiKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICQuYWpheCh7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywNCiAgICAgICAgICAgICAgICAgICAgdXJsOiAiL3NlcnZpY2VzL3VucmVhZEludGVybmFsTGV0dGVyQ291bnQiLA0KICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ0pTT04nLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbSwNCiAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2VEYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZURhdGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygidW5yZWFkIiwgcmVzdWx0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2Vzcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSAiKCIgKyByZXN1bHQuaW50VmFsdWUgKyAiKSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI215TGV0dGVyc0NvdW50IikuaHRtbChzdHIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxMZXR0ZXJDb3VudEZvck1lbWJlciA9IHJlc3VsdC5pbnRWYWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZWJlclV0aWwuc2V0VG90YWxDb3VudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiR2V0IENvdXBvbkNvdW50IEVycm9yOiIsIGVycm9yVGhyb3duKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgLy9zZXRUaW1lb3V0KE1lYmVyVXRpbC5zaG93SW50ZXJuYWxMZXR0ZXJzKCksIDYwMDAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvL1JlbmQgSW1hZ2UgYXMgdXJsIGZyb20gY29va2llDQogICAgICAgIGlmICgkLmNvb2tpZSgiaW1hZ2VVcmwiKSAhPSBudWxsKSB7DQogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJyZW5kZXIgSW1hZ2UgVVJMIik7DQogICAgICAgICAgICAkKCI8aW1nIC8+IiwgeyBzcmM6ICQuY29va2llKCJpbWFnZVVybCIpLCB3aWR0aDogMCwgaGVpZ2h0OiAwIH0pLmFwcGVuZFRvKCIjbG9naW5TdGF0ZUltYWdlIik7DQogICAgICAgICAgICAkLnJlbW92ZUNvb2tpZSgiaW1hZ2VVcmwiKTsNCiAgICAgICAgICAgIGhhc0ltYWdlVXJsID0gdHJ1ZTsNCg0KICAgICAgICB9DQogICAgICAgIGlmICgkKCIubG9naW5lZCIpLmxlbmd0aCA+IDAgJiYgZXJtRmxhZyAhPSAiY2xlYXIiKSB7DQogICAgICAgICAgICBpZiAoZXJtRmxhZyA9PSAiMSIpIGxvZ2luSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IGpqZVV0aWwuZXJtTG9naW4oKTsgfSwgMTAwMCk7DQogICAgICAgICAgICBlbHNlIGlmIChlcm1JZCA9PSAiIikgbG9naW5JbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgamplVXRpbC50cnlMb2dpbigiaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vcGFzc2VyL3NldGNvb2tpZSIpOyB9LCAxMDAwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZXJtRmxhZyA9PSAiY2xlYXIiKSBsb2dpbkludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyBqamVVdGlsLmVybUxvZ291dCgpOyB9LCAxMDAwKTsNCiAgICAgICAgaWYgKHZpZXdQYyA9PSAiMSIpIGxvZ2luSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IGpqZVV0aWwudmlld1BjKCk7IH0sIDEwMDApOw0KICAgICAgICAvL0dldCBNZW1iZXIgSW5mbyBhbmQgc2hvdyBpbiBQYW5lbA0KICAgICAgICBpZiAoTWViZXJVdGlsLmlzTG9nZWRJbigpICYmIE1lYmVyVXRpbC5pc01lbWJlclBhbmVsRXhpc2l0cygpKSB7DQogICAgICAgICAgICBNZWJlclV0aWwuc2hvd01lbWJlckluZm8oKTsNCiAgICAgICAgICAgIE1lYmVyVXRpbC5zaG93TWVtYmVyU2NvcmUoKTsNCiAgICAgICAgICAgIC8vTWViZXJVdGlsLnNob3dDb3Vwb25Db3VudCgpOw0KDQogICAgICAgICAgICAvL01lYmVyVXRpbC5zaG93SW50ZXJuYWxMZXR0ZXJzKCk7DQogICAgICAgICAgICAvL3NldEludGVydmFsKGZ1bmN0aW9uICgpIHsgTWViZXJVdGlsLnNob3dDb3Vwb25Db3VudCgpOyB9LCAzMDAwMCk7DQogICAgICAgICAgICAvL3NldEludGVydmFsKGZ1bmN0aW9uICgpIHsgTWViZXJVdGlsLnNob3dJbnRlcm5hbExldHRlcnMoKTsgfSwgMzAwMDApOw0KICAgICAgICB9DQogICAgIA0KICAgICAgICAgICAgaWYgKCQoIiNoZWFkZXJfSW1hZ2VDaGVjayIpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBoZWFkQ2hhbmdlQ29kZUltZygpOw0KICAgICAgICAgICAgICAgIGlmICgkKCIjbGFuZyIpLnZhbCgpID09ICJlbiIgfHwgJCgiYm9keSIpLmhhc0NsYXNzKCJlbiIpKSB7DQogICAgICAgICAgICAgICAgICAgICQoIiNoZWFkZXJfdmFsaWRhdGVDb2RlIikuYXR0cigiZGF0YS13YXRlcm1hcmsiLCAiY29kZSIpOw0KICAgICAgICAgICAgICAgICAgICAkKCIjaGVhZGVyX3ZhbGlkYXRlQ29kZSIpLmF0dHIoInZhbHVlIiwgImNvZGUiKTsNCg0KICAgICAgICAgICAgICAgICAgICAkKCIjaGVhZGVyX2FJbWFnZUNoZWNrIikuY3NzKCJjb2xvciIsICIjMWQ3YWQ5Iik7DQogICAgICAgICAgICAgICAgICAgICQoIiNoZWFkZXJfSW1hZ2VDaGVjayIpLmF0dHIoInRpdGxlIiwgIkNsaWNrIFJlcGxhY2UgdmVyaWZpY2F0aW9uIGNvZGUgaW1hZ2UiKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCiAgICANCg0KICAgICAgICB2YXIgb3JkZXJPcmlnaW4gPSAkLmNvb2tpZSgib3JkZXJPcmlnaW4iKTsNCg0KICAgICAgICAvL0xvZ2luIFN0YXRlIHVwZGF0ZQ0KDQoNCiAgICAgICAgLy8kKCIjRW50ZXJDbHViIikuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgIC8vICAgICQoIiNFbnRlckNsdWIiKS5maW5kKCJhIikuY2xpY2soKTsNCiAgICAgICAgLy8gICAgLy9sb2NhdGlvbi5ocmVmID0gJCgiI2NsdWJVcmwiKS52YWwoKTsNCiAgICAgICAgLy99KTsNCiAgICAgICAgLy8kKCIjRW50ZXJDbHViMSIpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAvLyAgICBhbGVydCgkKCIjRW50ZXJDbHViMSIpLmZpbmQoImEiKS5hdHRyKCJocmVmIikpOw0KICAgICAgICAvLyAgICAkKCIjRW50ZXJDbHViMSIpLmZpbmQoImEiKS5jbGljaygpOw0KICAgICAgICAvLyAgICAvL3dpbmRvdy5sb2NhdGlvbi5ocmVmID0gJCgiI2NsdWJVcmwiKS52YWwoKTsNCiAgICAgICAgLy99KTsNCg0KICAgICAgICAkKCIubG9naW5fYnRuIikuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAoJCgiLmxvZ2luX2J0biIpLmF0dHIoInN0YXRlIikgPT0gImxvZ2luIikgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5jc3MoImJhY2tncm91bmQiLCAiI2E0YTRhNCIpOw0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5hdHRyKCJzdGF0ZSIsICJsb2dpbiIpDQogICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIiB8fCAkKCJib2R5IikuaGFzQ2xhc3MoImVuIikpIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIkxvZ2luaW5nIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuaHRtbCgi55m75b2V5LitIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmNzcygiZGlzcGxheSIsICJub25lIik7DQogICAgICAgICAgDQogICAgICAgICAgICB2YXIgcGFyYW0gPSB7fTsNCiAgICAgICAgICAgIHBhcmFtLnVzZXJuYW1lID0gJC50cmltKCQoIiNsb2dpbl91c2VybmFtZSIpLnZhbCgpKTsNCiAgICAgICAgICAgIHBhcmFtLnBhc3N3b3JkID0gJC50cmltKCQoIiNsb2dpbl9wYXNzd29yZCIpLnZhbCgpKTsNCiAgICAgICAgICAgIHBhcmFtLm9uZU1vbnRoID0gJCgiI2xvZ2luX2JveCAuY2hlY2tfYnRuIikudmFsKCkgPT09ICJjaGVja2VkIjsNCiAgICAgICAgICAgICQuY29va2llKCJyZW1lbWJlck1lIiwgJCgiI2xvZ2luX2JveCAuY2hlY2tfYnRuIikudmFsKCkgPT09ICJjaGVja2VkIiA/ICIxIiA6ICIwIik7DQogICAgICAgICAgICB2YXIgdXNyV2F0ZXJNYXJrID0gJCgiI2xvZ2luX3VzZXJuYW1lIikuYXR0cigiZGF0YS13YXRlcm1hcmsiKTsNCiAgICAgICAgICAgIGlmIChwYXJhbS51c2VybmFtZS5sZW5ndGggPT0gMCB8fCBwYXJhbS51c2VybmFtZSA9PSB1c3JXYXRlck1hcmspIHsNCiAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7DQogICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwoTWViZXJVdGlsLmVtcHR5VXNyTXNnKTsNCiAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuY3NzKCJiYWNrZ3JvdW5kIiwgIiNkMWFlNzYiKTsNCiAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuYXR0cigic3RhdGUiLCAiIikNCiAgICAgICAgICAgICAgICBpZiAoJCgiI2xhbmciKS52YWwoKSA9PSAiZW4iIHx8ICQoImJvZHkiKS5oYXNDbGFzcygiZW4iKSkgew0KICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuaHRtbCgiTG9naW4iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCLnmbvlvZUiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAocGFyYW0ucGFzc3dvcmQubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7DQogICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwoTWViZXJVdGlsLmVtcHR5UHdkTXNnKTsNCiAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuY3NzKCJiYWNrZ3JvdW5kIiwgIiNkMWFlNzYiKTsNCiAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuYXR0cigic3RhdGUiLCAiIikNCiAgICAgICAgICAgICAgICBpZiAoJCgiI2xhbmciKS52YWwoKSA9PSAiZW4iIHx8ICQoImJvZHkiKS5oYXNDbGFzcygiZW4iKSkgew0KICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuaHRtbCgiTG9naW4iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCLnmbvlvZUiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFjaGVja1ZhbGlkYXRlQ29kZSgiaGVhZGVyX3ZhbGlkYXRlQ29kZSIpKSB7DQogICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmNzcygiZGlzcGxheSIsICJibG9jayIpOw0KDQogICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIiB8fCAkKCJib2R5IikuaGFzQ2xhc3MoImVuIikpIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwoIlZlcmlmaWNhdGlvbiBjb2RlIGVycm9yIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuaHRtbCgi6aqM6K+B56CB6ZSZ6K+vIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5jc3MoImJhY2tncm91bmQiLCAiI2QxYWU3NiIpOw0KICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5hdHRyKCJzdGF0ZSIsICIiKQ0KICAgICAgICAgICAgICAgIGlmICgkKCIjbGFuZyIpLnZhbCgpID09ICJlbiIgfHwgJCgiYm9keSIpLmhhc0NsYXNzKCJlbiIpKSB7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCJMb2dpbiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIueZu+W9lSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgZGF0YSA9ICJ1c3I9IiArIHBhcmFtLnVzZXJuYW1lICsgIiZwd2Q9IiArIFN0cmluZ1V0aWwuYmFzZTY0ZW5jb2RlKHBhcmFtLnBhc3N3b3JkKSArICImb25lTW9udGg9IiArIHBhcmFtLm9uZU1vbnRoICsgIiZjYWxsYmFjaz0/IiArICImY29kZT0iICsgJCgiI2hlYWRlcl92YWxpZGF0ZUNvZGUiKS52YWwoKSsiJmlzaGVhZGVyPTEiOw0KICAgICAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsDQogICAgICAgICAgICAgICAgdXJsOiAiaHR0cDovL3d3dy5qaW5qaWFuZy5jb20vSGFuZGxlcnMvU3NvTG9naW5IYW5kbGVyLmFzaHgiLA0KICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbnAiLA0KICAgICAgICAgICAgICAgIGpzb25wOiAiY2FsbGJhY2siLA0KICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsDQogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLA0KICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwNCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2Vzcykgew0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnVybCAhPSBudWxsICYmIHJlc3VsdC51cmwubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU2F2ZSBJbWFnZVVSTCB0byBjb29raWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmNvb2tpZSgiaW1hZ2VVcmwiLCByZXN1bHQudXJsKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIC8vV3JpdGUgQ29va2llIGZvciBhdXRoZWQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudG9rZW4gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coImxvZ2luIHRva2VuIiwgcmVzdWx0LnRva2VuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmNvb2tpZSgiLkFTUFhBVVRIIiwgcmVzdWx0LnRva2VuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaWQgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coImxvZ2luIG1lbWJlcklkIiwgcmVzdWx0LmlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmNvb2tpZSgibWVtYmVySWQiLCByZXN1bHQuaWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTsNCg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmNzcygiZGlzcGxheSIsICJibG9jayIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jb2RlICE9IG51bGwgJiYgcmVzdWx0LmNvZGUgPT0gIjEwMSIpIHsvL+mqjOivgeeggemUmeivrw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCIjbGFuZyIpLnZhbCgpID09ICJlbiIgfHwgJCgiYm9keSIpLmhhc0NsYXNzKCJlbiIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3ggLmFsYXJtX3RleHQiKS5odG1sKCJWZXJpZmljYXRpb24gY29kZSBlcnJvciwgcGxlYXNlIHRyeSBhZ2FpbiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwocmVzdWx0Lm1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdC5jb2RlICE9IG51bGwgJiYgcmVzdWx0LmNvZGUgPT0gIjMwMSIpIHsvL+S/ruaUueWvhueggSANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgiI2xvZ2luX2JveCIpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX3VzZXJuYW1lIikudmFsKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX3Bhc3N3b3JkIikudmFsKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2xvZ2luX2JveCAuYWxhcm1fdGV4dCIpLmh0bWwoIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IikuY3NzKCJkaXNwbGF5Iiwibm9uZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbXByb3ZlUGFzc3dvcmQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3ggLmFsYXJtX3RleHQiKS5odG1sKE1lYmVyVXRpbC5sb2dpbkZhaWxNc2cpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm51bV92YWxpZGF0ZV9ib3gnKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRDaGFuZ2VDb2RlSW1nKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAkKCIjaGVhZGVyX3ZhbGlkYXRlQ29kZSIpLnZhbCgiIik7DQogICAgICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuY3NzKCJiYWNrZ3JvdW5kIiwgIiNkMWFlNzYiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5hdHRyKCJzdGF0ZSIsICIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIiB8fCAkKCJib2R5IikuaGFzQ2xhc3MoImVuIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuaHRtbCgiTG9naW4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCLnmbvlvZUiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsNCiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiTG9naW4gRXJyb3I6IiwgZXJyb3JUaHJvd24pOw0KICAgICAgICAgICAgICAgICAgICAkKCIjbG9naW5fYm94IC5hbGFybV90ZXh0IikuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7DQogICAgICAgICAgICAgICAgICAgICQoIiNsb2dpbl9ib3ggLmFsYXJtX3RleHQiKS5odG1sKE1lYmVyVXRpbC5sb2dpbkZhaWxNc2cpOw0KICAgICAgICAgICAgICAgICAgICBoZWFkQ2hhbmdlQ29kZUltZygpOw0KICAgICAgICAgICAgICAgICAgICAkKCIjaGVhZGVyX3ZhbGlkYXRlQ29kZSIpLnZhbCgiIik7DQogICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5jc3MoImJhY2tncm91bmQiLCAiI2QxYWU3NiIpOw0KICAgICAgICAgICAgICAgICAgICAkKCIubG9naW5fYnRuIikuYXR0cigic3RhdGUiLCAiIikNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoIiNsYW5nIikudmFsKCkgPT0gImVuIiB8fCAkKCJib2R5IikuaGFzQ2xhc3MoImVuIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5odG1sKCJMb2dpbiIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJCgiLmxvZ2luX2J0biIpLmh0bWwoIueZu+W9lSIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgICAkKCIjbG9nb3V0IikuY2xpY2soZnVuY3Rpb24gKCkgew0KDQogICAgICAgICAgICAvL3JlbW92ZSBjdXJyZW50IGF1dGgtY29va2llDQogICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLA0KICAgICAgICAgICAgICAgIHVybDogIi9IYW5kbGVycy9TaW1wbGVMb2dvdXRIYW5kbGVyLmFzaHgiLA0KICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbnAiLA0KICAgICAgICAgICAgICAgIGpzb25wOiAiY2FsbGJhY2siLA0KICAgICAgICAgICAgICAgIC8vIGRhdGE6ICJrZXk9LkFTUFhBVVRIIiwNCiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsDQogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgew0KDQogICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBtYWluU2l0ZSBhdXRoLWNvb2tpZQ0KICAgICAgICAgICAgICAgICAgICAkLmFqYXgoew0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsDQogICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICJodHRwOi8vd3d3LmppbmppYW5nLmNvbS9IYW5kbGVycy9TaW1wbGVMb2dvdXRIYW5kbGVyLmFzaHgiLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29ucCIsDQogICAgICAgICAgICAgICAgICAgICAgICBqc29ucDogImNhbGxiYWNrIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGE6ICJrZXk9b3JkZXJPcmlnaW4iLA0KICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoU3RhdGVEZXBlbmRPblBhc3NlcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9ICJodHRwOi8vd3d3LmppbmppYW5nLmNvbS9wYXNzZXIvbG9nb3V0P2dvPWh0dHAlM2ElMmYlMmZjbHViLmppbmppYW5nLmNvbSUyZiI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiTG9nb3V0IEVycm9yOiIsIGVycm9yVGhyb3duKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgew0KICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJMb2dvdXQgRXJyb3I6IiwgZXJyb3JUaHJvd24pOw0KDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgfSk7DQoNCg0KICAgICAgICAvLyQoZG9jdW1lbnQpLmtleWRvd24oZnVuY3Rpb24gKGV2ZW50KSB7DQoNCiAgICAgICAgLy8gICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gMTMpIHsNCiAgICAgICAgLy8gICAgICAgIGlmICgkKCIjbG9naW5fcGFzc3dvcmQiKS5pcygiOmZvY3VzIikgfHwgJCgibG9naW5fdXNlcm5hbWUiKS5pcygiOmZvY3VzIikpDQogICAgICAgIC8vICAgICAgICB7DQogICAgICAgIC8vICAgICAgICAgICAgICQoIi5sb2dpbl9idG4iKS5jbGljaygpOw0KICAgICAgICAvLyAgICAgICAgfQ0KDQogICAgICAgIC8vICAgIH0gDQogICAgICAgIC8vfSk7DQoNCiAgICB9KTsNCiAgICBmdW5jdGlvbiBoZWFkQ2hhbmdlQ29kZUltZygpIHsNCiAgICAgICAgdmFyIHN0ckxvZ2luVXJsID0gKCJodHRwOi8vd3d3LmppbmppYW5nLmNvbS9IYW5kbGVycy9Tc29Mb2dpbkhhbmRsZXIuYXNoeCIpLnJlcGxhY2UoIlNzb0xvZ2luSGFuZGxlci5hc2h4IiwgIkNvZGVJbWFnZS5hc3B4Iik7DQogICAgICAgICQoIiNoZWFkZXJfSW1hZ2VDaGVjayIpLmF0dHIoInNyYyIsIHN0ckxvZ2luVXJsICsgIj9UeXBlUGFyYT1sb2dpbmhlYWRlciYiICsgcmFuZCgxMDAwMDAwMCkpOw0KICAgIH0NCiAgICB2YXIgY29va2llVXRpbCA9IHt9Ow0KDQogICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSA9IGZ1bmN0aW9uICh1cmwsIGtleSwgdmFsdWUsIGV4cGlyZXMpIHsNCiAgICAgICAgdmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdOw0KICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7DQogICAgICAgIHZhciBmbGFnID0gIiI7DQogICAgICAgIGlmICh1cmwgPT0gIiIpIGZsYWcgPSAiJmZsYWc9MSINCiAgICAgICAgc2NyaXB0LnNyYyA9IHVybCArICcvaGFuZGxlcnMvY3Jvc3Njb29raWUuYXNweD9rZXk9JyArIGtleSArICcmdmFsdWU9JyArIHZhbHVlICsgJyZleHBpcmVzPScgKyBleHBpcmVzICsgZmxhZzsNCiAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOw0KICAgIH0NCiAgICBjb29raWVVdGlsLnNldENyb3NzQ29va2llcyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBleHBpcmVzKSB7DQogICAgICAgIGNvb2tpZVV0aWwuc2V0Q3Jvc3NDb29raWUoImh0dHA6Ly93d3cuamluamlhbmdpbm5zLmNvbSIsIGtleSwgdmFsdWUsIGV4cGlyZXMpOw0KICAgICAgICBjb29raWVVdGlsLnNldENyb3NzQ29va2llKCJodHRwOi8vamluZ3Vhbmdpbm5zLmJlc3R3ZWhvdGVsLmNvbSIsIGtleSwgdmFsdWUsIGV4cGlyZXMpOw0KICAgICAgICBjb29raWVVdGlsLnNldENyb3NzQ29va2llKCJodHRwOi8vd3d3Lm1ldHJvcG9sb2hvdGVscy5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiaHR0cDovL2Jlc3RheS5iZXN0d2Vob3RlbC5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiaHR0cDovL3d3dy5qaW5qaWFuZy5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiaHR0cDovL2hvdGVscy5qaW5qaWFuZy5jb20iLCBrZXksIHZhbHVlLCBleHBpcmVzKTsNCiAgICAgICAgY29va2llVXRpbC5zZXRDcm9zc0Nvb2tpZSgiIiwga2V5LCB2YWx1ZSwgZXhwaXJlcyk7DQogICAgICAgIGNvb2tpZVV0aWwuc2V0Q3Jvc3NDb29raWUoImh0dHA6Ly90cmF2ZWwuamluamlhbmcuY29tIiwga2V5LCB2YWx1ZSwgZXhwaXJlcyk7ICAgICAgIA0KICAgIH0NCg0KDQo8L3NjcmlwdD4NCg0KZAIED2QWBGYPFgIfAmhkAgIPFgIfAmhkGAUFJmxlZnRfMCRMdl9NeUFjY291bnQkY3RybDIkTHZfU3ViQ29udGV0DxQrAA5kZGRkZGRkFCsAAWQCAWRkZGYC/////w9kBSZsZWZ0XzAkTHZfTXlBY2NvdW50JGN0cmwxJEx2X1N1YkNvbnRldA8UKwAOZGRkZGRkZBQrAAJkZAICZGRkZgL/////D2QFJmxlZnRfMCRMdl9NeUFjY291bnQkY3RybDMkTHZfU3ViQ29udGV0DxQrAA5kZGRkZGRkPCsABgACBmRkZGYC/////w9kBSZsZWZ0XzAkTHZfTXlBY2NvdW50JGN0cmwwJEx2X1N1YkNvbnRldA8UKwAOZGRkZGRkZDwrAAUAAgVkZGRmAv////8PZAUTbGVmdF8wJEx2X015QWNjb3VudA8UKwAOZGRkZGRkZDwrAAQAAgRkZGRmAv////8PZLDVuRIYYD0DTxO/D9kawSkrm/en2A4VirRqNCzxxNSI" />
  </div>


  <input type="hidden" class="HideMemberId" value="87765794" />
  <input type="hidden" class="HideMemberName" value="17681593681" />
  <input type="hidden" class="HideMemberCradNo" value="" />
  <input type="hidden" class="HideMemberType" value="Individual" />
  <input type="hidden" class="HideMemberCode" value="87765794" />
  <input type="hidden" class="HideLanguage" value="zh-CN" />



  <div id="loginStateImage" style="height:0px;"></div>

  <div class="header yahei ">
    <div class="top_nav ">
      <div class="w1200 position_relative" id="top_nav_main">
        <div class="top_nav_fr">


          <a class="logined" title="已登录"><div class="user_name_text ellipsis horizantal" id="member_name_text" title="麻宇轩">麻宇轩</div></a>


          <a href="http://www.jinjiang.com/about/">关于锦江国际</a>
          <!--二维码-->
          <div class="head_app_box">
            <div class="head_app_wap">
              <div class="head_app">
                <i class="app_icon"></i><span class="app_text"> </span>
              </div>
            </div>
            <div class="head_app_iconbox">
              <div class="app_pic_box">
                <img width="84" height="84" src="${pageContext.request.contextPath}/picture/usermainpage/head_app_logo_2.ashx"/><a href="http://www.jinjiang.com/app/" target="_blank">锦江旅行APP</a>
              </div>
              <div class="line_separate"></div>
              <div class="wechat_pic_box">
                <img width="84" height="84" src="${pageContext.request.contextPath}/picture/usermainpage/head_wechat_logo_2.ashx"/><a href="javascript:;">锦江礼享微信</a>
              </div>
            </div>
          </div>


        </div>



        <div class="top_nav_fl" id="top_nav">
          <a class="jinjiang_internation" href="http://www.jinjiang.com"><i></i><span>锦江国际</span></a>
          <a class="jinjiang_platf" href="http://hotel.jinjiang.com"><i></i><span>酒店</span><em></em></a>
          <a class="jinjiang_hotel" href="http://hotels.jinjiang.com"><i></i><span>锦江酒店</span></a>
          <a class="jinjiang_ducheng" href="http://www.metropolohotels.com"><i></i><span>锦江都城</span></a>
          <a class="jinjiang_zhixing" href="http://www.jinjianginns.com"><i></i><span>锦江之星</span></a>
          <a class="jinjiang_jinguang" href="http://jinguanginns.bestwehotel.com/"><i></i><span>金广快捷酒店</span></a>
          <a class="jinjiang_baishi" href="http://bestay.bestwehotel.com/"><i></i><span>百时快捷酒店</span></a>
          <a class="jinjiang_lufu" href="http://louvrehotels.jinjiang.com/"><i></i><span>卢浮酒店</span></a>
          <a class="jinjiang_kangbo" href="http://campanile.bestwehotel.com"><i></i><span style="display: none;">康铂酒店</span></a>
          <a class="jinjiang_travel" href="http://travel.jinjiang.com"><i></i><span>锦江旅游</span></a>
          <a class="jinjiang_car" href="http://www.jinjiang.com/auto/"><i></i><span>锦江汽车</span></a>
          <a class="jinjiang_ecard" href="http://www.jinjiangcard.com/"><i></i><span>锦江e卡通</span></a>
        </div>





        <div id="login_box" class="logined_box" >
          <div class="unit_box">
            <label class="horizantal">会员层级:</label>
            <div class="horizantal" id="memberLevel">V1</div>
          </div>
          <div class="unit_box">
            <label class="horizantal blocks1">卡号:</label>
            <div class="number horizantal" id="memberCardNo"></div>
          </div>
          <div class="unit_box">
            <label class="horizantal">积分:</label>
            <div class="number horizantal ellipsis" id="memberScore"></div>
            <a class="exchange_btn horizantal" title="兑换" target="_blank" href="http://mall.jinjiang.com">【兑换】</a>
          </div>
          <div class="member_dealing_unit">
            <a href="http://club.jinjiang.com/MyAccount/MyCoupons/Coupon"  target="_blank">
              我的优惠券
            </a>
          </div>
          <div class="member_dealing_unit">
            <a href="http://club.jinjiang.com/order/hotel"  target="_blank">
              我的订单
            </a>
          </div>

          <div class="member_dealing_unit">
            <a href="http://club.jinjiang.com/MyAccount"  target="_blank">
              我的账户
            </a>
          </div>
          <div class="member_dealing_unit"><a class="logout"  id="logout" href="javascript:;">【退出】</a></div>
          <div class="enter_club_center_btn yahei" id="EnterClub"><a id="a1" target="_blank" title="进入会员中心" href="http://club.jinjiang.com">进入会员中心 > ></a></div>
        </div>


      </div>
    </div>

  </div>

  <input type="hidden" id="clubUrl" value="http://club.jinjiang.com" />
  <input type="hidden" id="contextLanguage" value="zh-CN" />
  <input type="hidden" id="mcode"  value="87765794" />
  <input type="hidden" id="hd_logout"  value="http://www.jinjiang.com/passer/logout?go=$returnUrl" />
  <input type="hidden" id="lang" value="zh-CN" />
  <input type="hidden" id="cardtype" value="COMMON_CARD" />
  <script type="text/javascript">
    <!--
    (function (d) {
      (window.bd_cpro_rtid = window.bd_cpro_rtid || []).push({ id: "nWD1njbv" });
      var s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = location.protocol + "//cpro.baidu.com/cpro/ui/rt.js";
      var s0 = d.getElementsByTagName("script")[0]; s0.parentNode.insertBefore(s, s0);
    })(document);
    //-->
  </script>


  <div class="wrapper">
    <div class="club_header green_b_head">
      <div class="w1000">




        <div class="logo"><a href="/"></a></div>

        <div class="top-bar">


          <div class="bar_b" style="display:none;">

            客服热线：400-820-9999
            &nbsp;&nbsp;&nbsp;
            <a id="mainHeader1_lbLanguageSwitch" href="javascript:__doPostBack(&#39;mainHeader1$lbLanguageSwitch&#39;,&#39;&#39;)">ENGLISH</a>
          </div>

          <div class="bar_a" >

            客服热线：400-820-9999&nbsp;&nbsp;

            <a id="mainHeader1_lbLanguageSwitchLoggedIn" href="javascript:__doPostBack(&#39;mainHeader1$lbLanguageSwitchLoggedIn&#39;,&#39;&#39;)">ENGLISH</a>


          </div>


        </div>

        <div class="menu">
          <ul>

            <li >
              <a href="/"   id="" >首页  </a>

            </li>

            <li >
              <a href="#"   id="exchangeBtn" >积分兑换  </a>

              <div class="exchangeBox" style="display: none;">
                <div class="exchangeBoxArrow"></div>
                <div class="exchangeBoxMain">

                  <a  href="http://mall.bestwehotel.com/">
                    礼品兑换
                  </a>

                  <a class="last" href="/lixing/lxHome">
                    旅游产品兑换
                  </a>

                </div>
              </div>

            </li>

            <li >
              <a href="/Partners"   >合作伙伴  </a>

            </li>

            <li class="last">
              <a href="/AboutJ-Club"   >关于会员  </a>

            </li>

          </ul>
        </div>




        <div class="account-top">
          <div class="account-info">

            <div class="account-info-mian">
              <div class="account-people clearfix">
                <span class="account-name"><span id="top_0_Lbl_Name">麻宇轩</span></span>


                <a class="account-phone un-verified-phone" href="#" target="_blank"></a>

                <a class="account-mail un-verified-mail" href="#"></a>

              </div>
              <div class="account-style clearfix">
                <div class="account-style-fl">
                  <div class="account-style-fr">
                    <p><span id="top_0_Lbl_cardType">V1</span></p>
                  </div>
                </div>
              </div>
              <div class="card-num clearfix">卡号：<span id="top_0_Lbl_No"></span></div>
              <div class="card-date">有效期至：<span id="top_0_Lbl_EedDate">永久</span></div>
            </div>
          </div>
        </div>

        <div class="account-box">
          <div class="account-box-fl">
            <p>积分余额：<span class="yellow">0</span><a href="http://mall.bestwehotel.com/" target="_blank">[兑换]</a></p>
            <p>有效期：</p>
            <p>积分类型：锦江积分</p>>
          </div>
          <div id="top_0_showRight" class="account-box-fr">
            <table width="289" border="0" cellspacing="0" cellpadding="0" style="margin-top:-8px;">
              <tr>
                <td width="35"></td>
                <td height="18" width="45">V1</td>
                <td height="18" width="70">V2</td>
                <td width="70">V3</td>
                <td width="69">V4</td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td height="20">1000</td>
                <td><span class="td-num num-second">3000</span></td>
                <td><span class="td-num num-second">20000</span></td>
              </tr>
              <tr>
                <td><span class="ing-name"><span class="ing-name">积分</span></td>
                <td colspan="4"><div class="score-bg"><span style="width:%"></span>
                  <div class="progress-tip">
                    <p>分</p>
                    <i></i></div>
                </div>
                </td>
              </tr>
              <tr>
                <td height="22"></td>
                <td height="22">&nbsp;</td>
                <td valign="bottom"><span class="td-num num-second">x5</span></td>
                <td valign="bottom"><span class="td-num num-second">x15</span></td>
                <td valign="bottom"><span class="td-num num-second">x30</span></td>
              </tr>
              <tr>
                <td><span class="ing-name">次数</span></td>
                <td colspan="4"><div class="count-bg"><span style="width:%"></span>
                  <div class="progress-tip">
                    <p>次</p>
                    <i></i></div>
                </div>
                </td>
              </tr>
            </table>
            <p class="account-table-btm"></p>
          </div>
        </div>




        <input type="hidden" id="CardTypeName" value="silver" />

      </div>
    </div>
    <div class="inner clearfix">
      <div class="w1000">
        <div class="com-mian">
          <div class="left-bar">



            <div class="left-bar-top">
              <div class="left-bar-mian">


                <dl class="dingdan-bar">
                  <dt class="">订单管理<i></i></dt>

                  <dd  id="HotelOrders"><a  href="/MyAccount/OrderManagement/HotelOrders">酒店订单</a></dd>

                  <dd  id="TravelOrders"><a  href="/MyAccount/OrderManagement/TravelOrders">旅游订单</a></dd>

                  <dd  id="CarRentOrders"><a  href="/MyAccount/OrderManagement/CarRentOrders">租车订单</a></dd>

                  <dd  id="4SOrders"><a  href="/MyAccount/OrderManagement/4SOrders">4S订单</a></dd>

                  <dd  id="OtherOrders"><a  href="/MyAccount/OrderManagement/OtherOrders">其他订单</a></dd>

                </dl>

                <dl class="jifen-bar">
                  <dt class="">积分管理<i></i></dt>

                  <dd  id="MyScores"><a  href="/MyAccount/PointManagement/MyScores">我的积分</a></dd>

                  <dd  id="ScoreCheckIn"><a  href="/MyAccount/PointManagement/ScoreCheckIn">积分补登</a></dd>

                </dl>

                <dl class="youhuijuan-bar">
                  <dt class="">优惠券<i></i></dt>

                  <dd  id="Coupon"><a  href="/MyAccount/MyCoupons/Coupon">优惠券查询</a></dd>

                </dl>

                <dl class="zhanghu-bar">
                  <dt class="on">账户管理<i></i></dt>

                  <dd style="display: block;" id="PersonalInformation"><a  href="/MyAccount/AccountManage/PersonalInformation">个人信息</a></dd>

                  <dd style="display: block;" id="AccountSecurity"><a  href="/MyAccount/AccountManage/AccountSecurity">账户安全</a></dd>

                  <dd style="display: block;" id="Subscription"><a  href="/MyAccount/AccountManage/Subscription">我的订阅</a></dd>

                  <dd style="display: block;" id="Messages"><a  href="/MyAccount/AccountManage/Messages">消息中心</a></dd>

                  <dd style="display: block;" id="CardManage"><a  href="/MyAccount/AccountManage/CardManage">银行卡管理</a></dd>

                  <dd style="display: block;" id="ContactManage"><a  href="/MyAccount/AccountManage/ContactManage">常用联系人</a></dd>

                </dl>

              </div>
            </div>


          </div>
          <div class="right-main">


            <div class="order-waiter">
              <div class="order-waiter-inner">待处理订单： 酒店<a href="/MyAccount/OrderManagement/HotelOrders" target="_blank">(0)</a>  旅游<a href="/MyAccount/OrderManagement/TravelOrders" target="_blank">(0)</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;优惠券<a href="/MyAccount/MyCoupons/Coupon" target="_blank">(0)</a></div>
            </div>


            <div class="account-index">
              <h2>我的会员权益</h2>

              <div class="account-card-area">
                <p class="account-tit">会员通过不同渠道消费基础积分倍数不同</p>
                <table border="0" cellpadding="0" cellspacing="0">
                  <tbody>
                  <tr height="54px">
                    <td width="200px"></td>
                    <td width="135px">
                      <div class="ordinary-card">
                        <p class="card-name">V1 普卡</p>
                      </div>
                    </td>
                    <td width="135px">
                      <div class="silver-card">
                        <p class="card-name">V2 银卡</p>
                      </div>
                    </td>
                    <td width="135px">
                      <div class="gold-card">
                        <p class="card-name">V3 金卡</p>
                      </div>
                    </td>
                    <td width="135px">
                      <div class="platinum-card">
                        <p class="card-name">V4 白金卡</p>
                      </div>
                    </td>
                  </tr>
                  <tr height="120px">
                    <td><i class="client"></i><b>官网/APP/微信/M站</b></td>
                    <td><i class="ordinary-noe"></i><p>倍积分</p></td>
                    <td><i class="silver-noe"></i><p>倍积分</p></td>
                    <td><i class="gold-noe"></i><p>倍积分</p></td>
                    <td><i class="platinum-noe"></i><p>倍积分</p></td>
                  </tr>
                  <tr height="120px">
                    <td><i class="kfzx"></i><b>客服中心</b></td>
                    <td><i class="ordinary-two"></i><p>倍积分</p></td>
                    <td><i class="silver-two"></i><p>倍积分</p></td>
                    <td><i class="gold-two"></i><p>倍积分</p></td>
                    <td><i class="platinum-two"></i><p>倍积分</p></td>
                  </tr>
                  <tr height="120px">
                    <td><i class="lycp"></i><b>锦江旅游产品</b></td>
                    <td><i class="ordinary-three"></i><p>倍积分</p></td>
                    <td><i class="silver-three"></i><p>倍积分</p></td>
                    <td><i class="gold-three"></i><p>倍积分</p></td>
                    <td><i class="platinum-two"></i><p>倍积分</p></td>
                  </tr>
                  </tbody>
                </table>

              </div>
              <div class="h20"></div>
              <div class="h10"></div>
              <h2>我的会员折扣</h2>
              <div class="account-card-area account-sell">
                <table border="0" cellpadding="0" cellspacing="0">
                  <tbody>
                  <tr height="54px">
                    <td style="width: 200px;"></td>
                    <td style="width: 135px;">
                      <div class="ordinary-card">
                        <p class="card-name">V1 普卡</p>
                      </div>
                    </td>
                    <td style="width: 135px;">
                      <div class="silver-card">
                        <p class="card-name">V2 银卡</p>
                      </div>
                    </td>
                    <td style="width: 135px;">
                      <div class="gold-card">
                        <p class="card-name">V3 金卡</p>
                      </div>
                    </td>
                    <td style="width: 135px;">
                      <div class="platinum-card">
                        <p class="card-name">V4 白金卡</p>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>静安昆仑大酒店/虹桥锦江大酒店/新锦江大酒店/锦江饭店</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>9折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>88折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>85折</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>锦江星级酒店</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>9折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>88折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>85折</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>皇家金煦/郁锦香(国内)</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>9折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>88折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>85折</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>锦江都城/锦江之星/百时快捷/金广快捷</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>9折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>88折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>85折</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>麗枫/喆啡/ZMAX潮漫/希岸/非繁城品/窝趣/都漫</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>9折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>88折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>85折</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>7天/全新7天/7天优品/IU/派</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>9折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>9折+0.2折返现</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>9折+0.5折返现</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>希尔顿欢朋</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>92折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>88折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>85折</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>康铂(国内)</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>88折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>85折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>8折</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #59626a;">
                      <p>康铂（海外）</p>
                    </td>
                    <td style="color: #0065b2;">
                      <p>95折</p>
                    </td>
                    <td style="color: #96a0a7;">
                      <p>95折</p>
                    </td>
                    <td style="color: #d4b572;">
                      <p>95折</p>
                    </td>
                    <td style="color: #6f7992;">
                      <p>9折</p>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
              <div class="arrow-line"><div class="arrow-line-mian"></div></div>
              <!-- 备注信息 -->
              <div class="remarks">
                <p>备注信息</p>
                <ul>
                  <li>1.  须通过铂涛旅行/锦江旅行的官网/APP/微信/M站/客服热线等各直销渠道预本人预订入住才可享受以上会员折扣，在前台预订只享受门市价入住；</li>
                  <li>2. 房价折扣以门市价为基础，部分酒店的折扣以网络基准价为基础，具体价格以分店列表显示的为准；  </li>
                  <li>3、需通过铂涛旅行APP/微信预订7天/全新7天/7天优品/IU/派的酒店，才能获得对应等级的返现；</li>
                </ul>
              </div>


              <div class="right_banner">

              </div>
              <div class="h10"></div>
            </div>

          </div>
        </div>
      </div>
    </div>


    <div style="position: absolute; margin: 0px; top: 261px; left: 495px; display: none;" class="com-pup" id="information-box">
      <div class="com-pup-inner">
        <div class="com-pup-close"></div>
        <div class="com-pup-title">您好，您目前还是网站用户，请完善信息 </div>
        <div class="information-tip">完善信息成为锦江礼享会员，为您的消费累积积分，获得更多礼遇！</div>
        <div class="h20"></div>
        <div class="information-form">
          <div class="qrJqForm">
            <div class="form-div clearfix"><label>姓名：</label><input type="text" id="temMenUserName"></div>
            <div class="form-div clearfix" id="cardId">
              <label>证件类型：</label>
              <select name="usercard" >

              </select>
            </div>
            <div class="form-div clearfix"><label>证件号：</label><input type="text" id="temMenUserNo"></div>
          </div>
        </div>


        <div class="wrong-tip"><div class="wrong-tip-mian"><span></span></div></div>
        <div class="com-pup-botton"><input class="com-botton-step3" value="保存信息" type="button"></div>
        <div class="skip">暂不完善，<a href="javascript:;">跳过 &gt;</a></div>
      </div>
    </div>

    <div class="com-pup" id="sure-box">
      <div class="com-pup-inner">
        <div class="com-pup-close"></div>
        <div class="h20"></div>
        <div class="sure-text"><p>恭喜您成为锦江礼享会员！</p></div>
        <div class="sure-btn">
          <a class="see-score" target="_blank" href="/MemberScores">立即赚取礼享积分</a>
          <a class="go-home" href="/" target="_blank">返回会员中心首页</a>
        </div>
      </div>
    </div>

    <div style="height: 1333px; display: none;" class="page-cover"></div>
    <input type="hidden" id="WrongTipName" value="请输入姓名!" />
    <input type="hidden" id="WrongTipCard" value="请输入证件号!" />
    <input type="hidden" id="WrongTip" value="保存失败 !" />
    <input type="hidden" id="WaitingTip" value="正在提交." />

    <div class="footer clearfix">

      <div class="footer">
        <div class="w1200 clearfix">
          <div class="footer-main clearfix">
            <div class="logobar">
              <p class="title_text">| 成员企业</p>
              <ul class="logo-box clearfix">
                <li class="wehotel"></li>
                <li class="jjjd"></li>
                <li class="metropolo"></li>
                <li class="jjzx"></li>
                <li class="jgkj"></li>
                <li class="bskj"></li>
                <li class="jjtravel"></li>
                <li class="jjcar"></li>
                <li class="kbjd"></li>
                <li class="byl"></li>
              </ul>
            </div>
            <div class="app_code_box">
              <div class="title_text mar_l_20">| 掌上锦江，更多优惠随时享</div>
              <div class="two_dimension_code_icons_box">
                <a class="jinjiang_app_code_icon" rel="" title="APP二维码"></a>
                <!--                     <a class="jinjiang_wechat_code_icon mar_l_20" rel="" title="微信二维码"></a>                                
 -->                    <a style="display:none" class="jinjiang_star_icon mar_l_20" rel="" title=""></a>
              </div>
              <div class="app_name_box">
                <div class="app_tag">APP</div>
                <!--                     <div class="mar_l_20">微信</div>
 -->                    <div style="display:none" class="mar_l_20"></div>
              </div>
            </div>
          </div>
          <div class="clearfix pt10">
            <div class="verification_link_box">
              <div class="links_box">
                <a href="http://www.jinjiang.com/map/" title="网站地图">网站地图</a>
                |
                <a href="http://www.jinjiang.com/contactUs/" rel="nofollow" title="联系我们">联系我们</a>
                |
                <a href="http://www.jinjiang.com/service/" rel="nofollow" title="法律声明">法律声明</a>
              </div>
              <p>Copyright©2011Jinjiang.com.all rights reserved</p>
              <p>
                <a style="color:#ccc;text-decoration:none;" href="http://www.miibeian.gov.cn/state/outPortal/loginPortal.action" target="_blank">沪ICP备05048113号</a>
              </p>
            </div>
            <div class="friendly_links_box clearfix">
              <a class="gongshang_icon" rel="nofollow" href="http://www.sgs.gov.cn/lz/licenseLink.do?method=licenceView&amp;entyId=2013071613131331" title="上海工商"></a>
              <a class="net_policeman" rel="nofollow" href="http://sh.cyberpolice.cn/" title="上海网警"></a>
              <a class="collect_credit" rel="nofollow" href="http://www.zx110.org/" title="征信网"></a>
              <a class="verify_success" rel="nofollow" href="http://www.jinjiang.com/#" title="安全验证"></a>
              <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31010102002050" style="display: inline-block; text-decoration: none; height: 20px; line-height: 20px; margin-top: 6px; margin-left: 10px;color:#ccc;"><img src="${pageContext.request.contextPath}/picture/usermainpage/ghs_2.png" style="float:left; margin-right:4px;">沪公网安备 31010102002050号</a>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

  <script src="${pageContext.request.contextPath}/js/usermainpage/jquery-1.8.0.min_2.js" type="text/javascript"></script>
  <script src="${pageContext.request.contextPath}/js/usermainpage/jquery-ui-datepicker_2.js" type="text/javascript"></script>
  <script src="${pageContext.request.contextPath}/js/usermainpage/multilingual-datepicker_2.js" type="text/javascript"></script>
  <script src="${pageContext.request.contextPath}/js/usermainpage/pagercontroller_2.js" type="text/javascript"></script>
  <script src="${pageContext.request.contextPath}/js/usermainpage/md5_2.js" type="text/javascript"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/base_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/o_code_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/renew_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/card_plugins_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/layer_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/modal_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/contactmanage_2.js"></script>
  <script src="${pageContext.request.contextPath}/js/usermainpage/navigation_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/validform_2.js"></script>

  <input id="gotoUrl" type="hidden" value="/MyAccount" />
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainp/stringutil_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/md5_2.js"></script>
  <script type="text/javascript">
    var lang_val = $("html").attr("lang");//获取当前页面语言版本
    $(function () {
      if ($(".tab-mian-change").eq(1).is(":hidden")) {
        //Make DropDownList work in Second Tab
        $(".tab-mian-change").eq(1).show();
        //$('form').jqTransform();
        $('.jqForm').jqTransform();
        $(".tab-mian-change").eq(1).hide();
      }
      else if ($(".tab-mian-change").eq(0).is(":hidden")) {
        //Make DropDownList work in First Tab
        $(".tab-mian-change").eq(0).show();
        //$('form').jqTransform();
        $('.jqForm').jqTransform();
        $(".tab-mian-change").eq(0).hide();
      }
      //*****************************************
      //快速登录
      //*****************************************
      //快速注册用户弹出层
      var iderr = "请输入正确的证件号";
      if (lang_val != "zh-CN") {
        iderr = "Please enter your ID numbers correctly";
      }
      var idonok = true;
      var memberType = $(".HideMemberType").val();
      if (memberType != 'TmpMem') {
        return;
      }

      $("#temMenUserName").blur(function () {
        $(".wrong-tip-mian span").html("");
        var temMenUserName = $("#temMenUserName").val();
        if (temMenUserName == "") {
          $(".wrong-tip-mian span").html($("#WrongTipName").val());
        }
      })

      $("select[name='usercard']").change(function () {
        $(".wrong-tip-mian span").html("");
        if ($("#temMenUserNo").val() != '') {
          $("#temMenUserNo").blur();
        }
      });

      $("#temMenUserNo").blur(function () {
        idonok = true;
        $(".wrong-tip-mian span").html("");
        var temMenUserNo = $("#temMenUserNo").val();
        if (temMenUserNo == "") {
          idonok = false;
          $(".wrong-tip-mian span").html($("#WrongTipCard").val());
        }
        else {
          if ($("select[name='usercard'] option:selected").val() == "ID") {
            var param = {
              ID: $("#temMenUserNo").val()
            };

            $.ajax({
              type: 'POST',
              url: "/services/QueryValidateID",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                if (!result.Success) {
                  idonok = false;
                  $(".wrong-tip-mian span").html(iderr);
                }
                else {
                  idonok = true;
                }
              }
            });
          }
          else {
            var reg = /^[0-9a-zA-Z]*$/;
            if (!reg.test($('input[name="idno"]').val())) {
              $(".wrong-tip-mian span").html(iderr);
              idonok = false;
            }
            else {
              idonok = true;
            }
          }
        }
      })

      $("#information-box .com-pup-close").click(function (event) {
        event.preventDefault;
        $("#information-box").hide();
        $(".page-cover").hide();
        return false;
      });

      $("#sure-box .com-pup-close").click(function (event) {
        event.preventDefault;
        $("#sure-box").hide();
        $(".page-cover").hide();
        location.href = $("#gotoUrl").val();
        return false;
      });

      $(".skip a").click(function (event) {
        event.preventDefault;
        $("#information-box").hide();
        $(".page-cover").hide();
        return false;
      });
      $(".com-pup-botton .com-botton-step3").click(function () {
        if (!idonok) {
          return;
        }

        var temMenUserName = $("#temMenUserName").val();
        var usercardValue = $("select[name='usercard']").val();

        $(".wrong-tip-mian span").html($("#WaitingTip").val());

        var temMenUserNo = $("#temMenUserNo").val();
        var MemberCode = $(".HideMemberCode").val();

        var param = {
          "memberCode": MemberCode,
          "fullName": temMenUserName,
          "identityType": usercardValue,
          "identityNo": temMenUserNo,
          "registerSource": "Website"
        }
        //console.log("param", param);

        $.ajax({
          type: 'POST',
          url: "/services/completeMemberInfo",
          dataType: 'JSON',
          data: param,
          cache: false,
          success: function (data) {
            var result = JSON.parse(data);

            //console.log(result);

            if (result.Success) {

              $("#couponAmount").html(result.totalParValue);
              $("#sure-box").center().show();
              $("#information-box").hide();
              $(".page-cover").hide();
            }
            else {
              $(".wrong-tip-mian span").html($("#WrongTip").val());
            }
          }
        });

      });
      //*****************************************
      //快速登录
      //*****************************************

    });

    var myAccountPage = 'MyAccount';

    if (myAccountPage == 'MyAccount') {
      $(function () {
        //模拟下拉菜单	   
        $('.jqForm').jqTransform();
        //*****************************************
        //我的账号首页
        //*****************************************
        $('.account-card-area li').each(function (index, elemt) {
          var num = index;
          if (num % 3 == 0) {
            $('.account-card-area li').eq(num).css({ 'background-position': '0 -128px' });
            $('.account-card-area li.on').eq(num).css({ 'background-position': '0 0' });
          }
          else if (num % 3 == 1) {
            $('.account-card-area li').eq(num).css({ 'background-position': '-260px -128px' });
            $('.account-card-area li.on').eq(num).css({ 'background-position': '-260px 0' });
          }
          else if (num % 3 == 2) {
            $('.account-card-area li').eq(num).css({ "width": '270px', 'background-position': '-521px -128px' });
            $('.account-card-area li.on').eq(num).css({ "width": '270px', 'background-position': '-521px 0' });
          }

          //    $('.account-card-area li:not(.on)').hover(function () {
          //        num = $(this).index();
          //        if (num % 3 == 0) {
          //            $('.account-card-area li').eq(num).css({ 'background-position': '0 -256px' });

          //        }
          //        else if (num % 3 == 1) {
          //            $('.account-card-area li').eq(num).css({ 'background-position': '-260px -256px' });

          //        }
          //        else if (num % 3 == 2) {
          //            $('.account-card-area li').eq(num).css({ "width": '270px', 'background-position': '-521px -256px' });
          //        }
          //        $(this).find('.discount-card-inner').hide();
          //        $(this).find('.discount-card-replace').show();
          //    }, function () {
          //        num = $(this).index();
          //        if (num % 3 == 0) {
          //            $('.account-card-area li').eq(num).css({ 'background-position': '0 -128px' });
          //            $('.account-card-area li.on').eq(num).css({ 'background-position': '0 0' });
          //        }
          //        else if (num % 3 == 1) {
          //            $('.account-card-area li').eq(num).css({ 'background-position': '-260px -128px' });
          //            $('.account-card-area li.on').eq(num).css({ 'background-position': '-260px 0' });
          //        }
          //        else if (num % 3 == 2) {
          //            $('.account-card-area li').eq(num).css({ "width": '270px', 'background-position': '-521px -128px' });
          //            $('.account-card-area li.on').eq(num).css({ "width": '270px', 'background-position': '-521px 0' });
          //        }
          //        $(this).find('.discount-card-replace').hide();
          //        $(this).find('.discount-card-inner').show();
          //    })

        });

        //头部进度条提示
        $('.score-bg').hover(function () {
          var spanLeft = $(this).find('span').width() - $(this).find('.progress-tip').outerWidth() / 2;
          $(this).find('.progress-tip').css("left", spanLeft);
          $(this).find('.progress-tip').show();
        }, function () {
          $(this).find('.progress-tip').hide();
        });
        $('.count-bg').hover(function () {
          var spanLeft = $(this).find('span').width() - $(this).find('.progress-tip').outerWidth() / 2;
          $(this).find('.progress-tip').css("left", spanLeft);
          $(this).find('.progress-tip').show();
        }, function () {
          $(this).find('.progress-tip').hide();
        });

        var CardTypeName = $("#CardTypeName").val();
        if (CardTypeName == "silver") {
          $(".gold-icon").attr("class", "platinum-icon");
          $(".silver-icon").attr("class", "gold-icon")
        } else if (CardTypeName == "platinum") {
          $(".gold-icon").attr("class", "silver-icon");
          $(".platinum-icon").attr("class", "gold-icon");
        } else if (CardTypeName == "black") {
          $(".account-box-fl").css({ "margin-right": 0 })
        }
        //*****************************************
        //我的账号首页
        //*****************************************

      });
    } else if (myAccountPage == 'HotelOrders') {
      $(function () {
        //*****************************************
        //我的账号-酒店订单
        //*****************************************


        var showReasonEdit = function () {
          if ($("#reasonSelect").val() == "OTHER") {
            $("#reason_input").show();
          } else {
            $("#reason_input").hide();
          }
        };

        $("#HotelOrders").addClass("active");

        $(function () {



          //订单状态取值

          $(".order_style ul").find("li").find("a").click(function () {
            //alert($(this).html());
            var selectedValue = $(this).html();
            $(".order_style .hidOrderStatus").val(selectedValue);
          });

          $(".order_style2 ul").find("li").find("a").click(function () {
            //alert($(this).html());
            var selectedValue = $(this).html();
            $(".order_style2 .hidOrderStatus2").val(selectedValue);
          });

        });

        //BEGIN of 重新预订          
        //弹出框 文本框控制
        var today = new Date();//系统当天时间Date对象
        $("#date_1").datepicker({
          showButtonPanel: false,
          numberOfMonths: 1,
          regional: lang_val,
          changeYear: true,
          minDate: new Date(today.getFullYear(), today.getMonth(), today.getDate()),
          maxDate: new Date(today.getFullYear(), today.getMonth(), today.getDate() + 90),
          //minDate: new Date(new Date().getTime() + (1000 * 60 * 60 * 24)),
          //maxDate: new Date(new Date().getTime() + (1000 * 60 * 60 * 24*90)),
          onClose: function (dateText) {
            //console.log("dateText", dateText);
            var checkinDate = new Date(Date.parse(dateText.replace(/-/g, "/")));

            $('#date_2').datepicker("option", "minDate", new Date(checkinDate.getTime() + (1000 * 60 * 60 * 24)));
            $('#date_2').datepicker("option", "maxDate", new Date(checkinDate.getTime() + (1000 * 60 * 60 * 24 * 14)));
            checkHotelHandler();
          }, beforeShow: function () {
            setTimeout(
                    function () {
                      $('#ui-datepicker-div').css("z-index", 101);
                    }
            );
          }
        });
        $('#date_2').datepicker({
          changeYear: true,
          numberOfMonths: 1,
          showButtonPanel: false,
          regional: lang_val,
          minDate: new Date(new Date().getTime() + (1000 * 60 * 60 * 24 * 2)),
          maxDate: new Date(new Date(new Date(Date.parse($('#date_1').val().replace(/-/g, "/"))).getTime() + (1000 * 60 * 60 * 24 * 14)).getTime()),
          onClose: function (dateText) {
            var checkoutDate = new Date(Date.parse(dateText.replace(/-/g, "/")));
            var checkinDate = $('#date_1').datepicker("getDate");
            checkHotelHandler();
          }, beforeShow: function () {
            setTimeout(
                    function () {
                      $('#ui-datepicker-div').css("z-index", 101);
                    }
            );
          }
        });

        //重新预订
        $(".pay-again").click(function () {

          var hotelName = $(this).attr("hotelName");
          var hotelId = $(this).attr("hotelId");
          var planId = $(this).attr("planId");

          $("#rebookBtn").attr("hotelId", hotelId);
          $("#rebookBtn").attr("planId", planId);

          $(".pop-hotel-title").html("<span>" + hotelName + "</span>");

          var thisPosition = $(this).offset();

          $("#rebookBtn").attr({ onclick: "return false", herf: "" }).css({ "background": "#ccc", "cursor": "default" });

          $("#pop-hotel").hide();
          $("#pop-hotel").css({ "left": thisPosition.left - 307, "top": thisPosition.top - 176 })
          $("#pop-hotel").show();
          $("#pop-hotel .pop-hotel-close").click(function (event) {
            event.preventDefault;
            $("#pop-hotel").hide();
            return false;
          });

          checkHotelHandler();
        });

        //检测酒店房型是否存在
        var checkHotelHandler = function () {
          if ($("#date_1").val() == "" || $("#date_2").val() == "") {
            return;
          } else {

            $("#rebookBtn").attr("targetLink", "").css({ "background": "#ccc", "cursor": "default" });

            var start = $("#date_1").val();
            var end = $("#date_2").val();
            var roomNum = $("#room-num").val();
            var adultNum = $("#people-num").val();

            var param = {
              startDate: $("#date_1").val(),
              endDate: $("#date_2").val(),
              language: $(".HideLanguage").val(),
              planId: $("#rebookBtn").attr("planId"),
              hotelCode: $(this).attr("hotelId"),
              roomNum: $("#room-num").val(),
              adultNum: $("#people-num").val()
            };
            //console.log("hotelRealPrice", param);

            $.ajax({
              type: 'POST',
              url: "/service/hotelRealPrice",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                //console.log(result);

                var count = result.dayPriceAvailableDtos.length;

                if (result.dayPriceAvailableDtos != null || count > 0) {
                  var canBook = true;

                  for (var i = 0; i < count; i++) {
                    var dto = result.dayPriceAvailableDtos[i];
                    if (dto.dayStatus != "AVAILABLE") {
                      canBook = false;
                    }
                  }

                  if (canBook) {
                    var url = $("#hidNewOrderUrl").val();
                    url = url + "?hotelid=" + param.hotelCode + "&plan.id=" + param.planId + "&startDate=" + param.startDate + "&endDate=" + param.endDate + "&roomNum=" + param.roomNum + "&adultNum=" + param.adultNum
                    //console.log(url);
                    $("#rebookBtn").css({ "background": "#d64c4c", "cursor": "pointer" }).attr("targetLink", url);
                  }
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                //console.log("Error:", errorThrown);

              }
            });
          }
        };

        //重新预订按钮点击
        $("#rebookBtn").live("click", function () {
          var url = $(this).attr("targetLink");
          if (url != null && url.length > 0 && url != 'undefined') {
            window.location = url;
          }
        });

        //END of 重新预订


        //取消订单弹出框
        var ducHeight = $(document).height();
        var ducWidth = $(document).width();
        $(".page-cover").css("height", ducHeight);
        $(".page-cover").css("width", ducWidth);
        $(".delete-text").click(function () {

          var inDate = $(this).parentsUntil("tbody").children("td").eq(3).children().html();
          var date1 = new Date(inDate);
          var dateTemp = new Date();
          if (date1 < new Date(dateTemp.getFullYear(), dateTemp.getMonth(), dateTemp.getDate())) {
            alert("入住日期小于当前日期，无法取消");
            return;
          }

          var orderId = $(this).attr("order_id");
          var cancelPos = $(this).attr("cancelPos");
          var orderType = $(this).attr("ordType");
          var status = $(this).attr("status");
          var prePayAmt = $(this).attr("prePayAmt");
          var payAmt = $(this).attr("payAmt");
          var cancelCharge = $(this).attr("cancelCharge");
          var refundMoney = $(this).attr("refundMoney");
          //var ReturnScore = $(this).attr("ReturnScore");
          //var UseScore = $(this).attr("UseScore");
          $("#cancelPos").html(cancelPos);
          if (orderType != 'PAYMENTING' && status == 'PAY_SUCCESS') {
            $("#cancelPre").html("<b>" + prePayAmt + "</b>");
            $("#cancelPay").html("<b>" + payAmt + "</b>");
            $("#cancelChar").html("<b>" + cancelCharge + "</b>");
            $("#cancelRef").html("<b>" + refundMoney + "</b>");
            //$("#ReturnScore").html("<b>" + ReturnScore + "</b>");
            //$("#UseScore").html("<b>" + UseScore + "</b>");

            $("#showAmount").show();
          }
          else {
            $("#showAmount").hide()
          }
          $(".page-cover").show();
          $("#add-volume-one").center().show();
          showReasonEdit();
          $('#cancelOrder').attr('order_id', orderId);
          //$(".info-content").html(cancelPos);
          $('#cancelOrder').click(cancelOrderHandler);

        });
        $("#add-volume-one .add-volume-close").click(function (event) {
          event.preventDefault;
          $("#add-volume-one").hide();
          $(".page-cover").hide();
          return false;
        });
        $('#reasonSelect').change(showReasonEdit);

        //取消订单按钮点击
        function cancelOrderHandler() {
          var reasonSelect = $('#reasonSelect').val();
          var textarea = $('#textarea').val();
          if (reasonSelect == 'OTHER' && $.trim(textarea).length == 0) {
            $('#tip-msg').css('display', 'block');
            $('#tip-msg').html($("#hidCancelReason").val());

            return false;
          }

          if (reasonSelect == 'OTHER' && $.trim(textarea).length > 512) {
            $('#tip-msg').css('display', 'block');
            $('#tip-msg').html($("#hidCancelReasonLength").val());
            return false;
          }
          $('#tip-msg').css('display', 'none');
          $('#tip-msg').html("");
          var orderId = $('#cancelOrder').attr('order_id');

          //   cancelOrderUrl = '/order/hotel/cancelOrder/' + orderId + "/" + reasonSelect;

          $("#tip-msg").html($("#hidCencelling").val());
          $('#tip-msg').css('display', 'block');
          $("#cancelOrder").unbind("click");
          $("#cancelOrder").css("cursor", "wait");

          //$.ajax({
          //    type: "GET",
          //    url: cancelOrderUrl,
          //    dataType: "json",
          //    success: function (data) {
          //        window.location.reload();
          //    }
          //});

          var param = {
            orderId: orderId,
            memberCode: $("#hidMCode").val(),
            memberName: $("#hidMName").val(),
            memberPhone: $("#hidMPhone").val(),
            reason: $("#reasonSelect").val(),
            remark: $("#textarea").val() == "" ? $("#reasonSelect").val() : $("#textarea").val(),
          };

          $.ajax({
            type: 'POST',
            url: "/service/cancelOrder",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (responseData) {
              var result = JSON.parse(responseData);
              if (result.applyCancelMoneyStatus == "FAIL") {
                $("#tip-msg").html("");
                alert($("#hidCencelfailure").val());
              }
              else {
                //console.log("cancelOrder", result);
                window.location.reload();
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Error:", errorThrown);
              alert($("#hidCencelfailure").val());
            }
          });
        }

        //*****************************************
        //我的账号-酒店订单
        //*****************************************
      });
    } else if (myAccountPage == 'TravelOrders') {
      $(function () {
        //*****************************************
        //我的账号-旅游订单
        //*****************************************
        $("#TravelOrders").addClass("active");
        //模拟下拉菜单	   
        $('.jqForm').jqTransform();

        //取消订单弹出框
        var ducHeight = $(document).height();
        var ducWidth = $(document).width();
        $(".page-cover").css("height", ducHeight);
        $(".page-cover").css("width", ducWidth);

        $(".cancelOrder").click(function () {

          $("#add-volume-one").center().show();
          $(".page-cover").show();
          $('#cancelBtn').attr('order_id', $(this).attr('order_id'));
        });
        $("#add-volume-one .add-volume-close").click(function (event) {
          event.preventDefault;
          $("#add-volume-one").hide();
          $(".page-cover").hide();
          return false;
        });
        $('#reasonSelect').change(function () {
          if ($("#reasonSelect").val() == "other") {
            $("#reason_input").show();
          } else {
            $("#reason_input").hide();
          }
        });

        //确定取消按钮点击
        var cancelBtnClick = function () {
          var orderId = $('#cancelBtn').attr('order_id');
          $('#cancelBtn').unbind('click');
          //saveComment(orderId);
          $("#tip-msg").html('取消中...');
          checkCancelable(orderId);
        }
        $('#cancelBtn').bind('click', cancelBtnClick);


        var checkCancelable = function (orderId) {
          saveComment(orderId);
        }

        function saveComment(orderId) {

          var note = $('#reasonSelect').val() == 'other' ? $.trim($('#textarea').val()) : $('#reasonSelect').val();

          if (note.length > 80) {
            $("#tip-msg").html("备注内容不能大于80个字符");
            return;
          }

          var param = {
            orderNo: orderId,
            reson: note,
            mcMemberCode: $("#hidMemberCode").val(),
          };

          $.ajax({
            type: 'POST',
            url: "/services/cancelTravelOrder",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (responseData) {
              var result = JSON.parse(responseData);
              //console.log(result);
              window.location.href = window.location.href.split("?")[0];
              return;
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Error:", errorThrown);
              $("#tip-msg").html("取消失败");
              $('#cancelBtn').bind('click', cancelBtnClick);
            }
          });

          //$.post(
          //"/order/travel/cancel/" + ids,
          //{
          //    'note': $('#reasonSelect').val() == '其它' ? $('#textarea').val() : $('#reasonSelect').val()
          //},
          //function (data) {
          //    var errMsg = '';
          //    if (data == 'OK') {
          //        window.location.reload();
          //        return;
          //    } else if (data == 'checkNoteError') {
          //        errMsg = "备注内容不能大于80个字符";
          //    } else if (data == 'NOT_FOUND') {
          //        errMsg = "待取消的订单未找到";
          //    } else if (data == 'NOT_ACCEPTABLE') {
          //        errMsg = "只有预订中或待支付的订单才能取消";
          //    } else if (data == 'INTERNAL_SERVER_ERROR') {
          //        errMsg = "操作发生异常.无法取消";
          //    } else if (data == 'NOT_AUTHORIZED') {
          //        errMsg = "您无权取消该订单，请重新登录或重试！";
          //    }
          //    $("#tip-msg").html(errMsg);
          //    $('#cancelBtn').bind('click', cancelBtnClick);
          //});
        }

      });
    } else if (myAccountPage == 'CarRentOrders') {

      $(function () {
        //*****************************************
        //我的账号-租车订单
        //*****************************************

        $("#CarRentOrders").addClass("active");
        $(function () {

          //模拟下拉菜单	   
          $('.jqForm').jqTransform();

          //订单状态取值
          $(".order_status ul").find("li").find("a").click(function () {
            //alert($(this).html());
            var selectedValue = $(this).html();
            $(".order_status .hidOrderStatus").val(selectedValue);
          });

          //酒店日历弹框
          $(".pay-again").click(function () {
            var thisPosition = $(this).offset();

            $("#pop-hotel").hide();
            $("#pop-hotel").css({ "left": thisPosition.left - 307, "top": thisPosition.top - 176 })
            $("#pop-hotel").show();
            $("#pop-hotel .pop-hotel-close").click(function (event) {
              event.preventDefault;
              $("#pop-hotel").hide();
              return false;
            });
            $("#pop-hotel .volume-botton-add").click(function (event) {
              event.preventDefault;
              $("#pop-hotel").hide();
              return false;
            });
          });
        });

        $(".startDate,.endDate").datepicker({
          numberOfMonths: 2,
          changeMonth: false,
          regional: lang_val,
          changeYear: false,
          beforeShow: function () {
            setTimeout(
                    function () {
                      $('#ui-datepicker-div').css("z-index", 101);
                    }
            );
          }
        });

        //*****************************************
        //我的账号-租车订单
        //*****************************************
      });
    } else if (myAccountPage == '4SOrders') {
      $(function () {
        //*****************************************
        //我的账号-4S订单
        //*****************************************
        $("#4SOrders").addClass("active");
        $(function () {

          //模拟下拉菜单	   
          $('.jqForm').jqTransform();

          //订单状态下拉框
          $('#order_status ul').find('li').find('a').click(function () {
            var selectedValue = $(this).html();
            $("#order_status .hidOrderStatus").val(selectedValue);
          });

        });

        $(".so_sDate,.so_eDate,.so_bDate").datepicker({
          numberOfMonths: 2,
          changeMonth: false,
          regional: lang_val,
          changeYear: false,
          beforeShow: function () {
            setTimeout(
                    function () {
                      $('#ui-datepicker-div').css("z-index", 101);
                    }
            );
          }
        });
        //*****************************************
        //我的账号-4S订单
        //*****************************************
      });
    } else if (myAccountPage == 'OtherOrders') {
      $(function () {
        //*****************************************
        //我的账号-其他订单
        //*****************************************
        $(".tab-mian-change").eq(0).show();
        $(".tab-mian-change").eq(0).hide();
        $("#OtherOrders").addClass("active");
        $(function () {
          /* <div class="right-tab-head">
           <ul>
           <li id="MyAccountInlineScripts1_tab1" class="on">会员卡订单</li>
           <li id="MyAccountInlineScripts1_tab2" class="">兑换话费订单</li>
           </ul>
           </div>
           有class on 显示对应div`
           */
          if ($(".right-tab-head").find("li").eq(0).hasClass("on")) {
            //Make DropDownList work in Second Tab
            $(".tab-mian-change").eq(0).show();

          }
          else if ($(".right-tab-head").find("li").eq(1).hasClass("on")) {
            $(".tab-mian-change").eq(1).show();
          }
          //模拟下拉菜单	   
          $('.jqForm').jqTransform();

          //订单状态 下拉框 点击
          $(".order_Status ul").find("li").find("a").click(function () {
            //alert($(this).html());
            var selectedValue = $(this).html();
            $(".order_Status .hidOrderStatus").val(selectedValue);
          });

          $(".order_Type ul").find("li").find("a").click(function () {
            //alert($(this).html());
            var selectedValue = $(this).html();
            $(".order_Type .hidOrderType").val(selectedValue);
          });

          $(".order_Status_Charge ul").find("li").find("a").click(function () {
            //alert($(this).html());
            var selectedValue = $(this).html();
            $(".order_Status_Charge .hidchargeStatus").val(selectedValue);
          });

          $(".order_Type_Charge ul").find("li").find("a").click(function () {
            //alert($(this).html());
            var selectedValue = $(this).html();
            $(".order_Type_Charge .hidOrderTypeIntergral").val(selectedValue);
          });

        });

        $(".oo_date_picker1,.oo_date_picker2").datepicker({
          numberOfMonths: 2,
          changeMonth: false,
          regional: lang_val,
          changeYear: false,
          beforeShow: function () {
            setTimeout(
                    function () {
                      $('#ui-datepicker-div').css("z-index", 101);
                    }
            );
          }
        });
        //*****************************************
        //我的账号-其他订单
        //*****************************************
      });
    } else if (myAccountPage == 'MyScores') {
      $(function () {
        //*****************************************
        //我的账号-我的积分
        //*****************************************
        $("#MyScores").addClass("active");

        //模拟下拉菜单	   
        $('.jqForm').jqTransform();

        $('.gay-main-div').hide();
        $('.rule-pop').hide();
        $('.rule-pop2').hide();
        $('.rule-pop3').hide();
        $('.rule-pop4').hide();
        $('.rule-pop5').hide();

        //积分更改
        $('.change-score').click(function () {
          $('.gay-main').slideDown('slow');
          $('.score-style li').click(function () {
            $('.gay-main-div').stop(true, true).hide();
            $("#scoreType").val($(this).attr("data-code"));
            $('.score-style li').attr("class", "");
            $(this).attr("class", "on");

            var showForm = $(this).attr("showForm") == 1;
            if (showForm) {
              var hasRule = $(this).attr("hasRule") == 1;
              var formClass = $(this).data("class")
              var ruleClass = $(this).data("rule");
              $("." + formClass).slideDown('slow');
              if (hasRule) {

                $("." + formClass).find('.see-ruler').mouseover(function () {

                  var pop = $("." + ruleClass);
                  var see = $("." + formClass).find('.see-ruler');
                  var popWidth = pop.width();
                  var popHeight = pop.height();
                  var popLeft = see.offset().left;
                  var popTop = see.offset().top - popHeight - 9;
                  pop.css({ "left": popLeft, "top": popTop });
                  pop.show();
                });
                $("." + ruleClass).mouseover(function () {

                  var pop = $("." + ruleClass);
                  var see = $("." + formClass).find('.see-ruler');

                  var popWidth = pop.width();
                  var popHeight = pop.height();
                  var popLeft = see.offset().left;
                  var popTop = see.offset().top - popHeight - 9;

                  pop.css({ "left": popLeft, "top": popTop });
                  pop.show();
                });
                $("." + formClass).find('.see-ruler').mouseout(function () {
                  $("." + ruleClass).hide();
                });
                $("." + ruleClass).mouseout(function () {
                  $("." + ruleClass).hide();
                });
              }
            }

          });

        });

        //$('.red-btn-S input').click(function () {
        //    $('.gay-main').slideUp('slow');
        //    $('.succes-tip').show();
        //    $('.succes-tip').fadeOut(4000);
        //});

        $("#typeSubmit").click(function () {
          if ($("#scoreType").val() == "") $("#scoreType").val("SCORE");
          var param = {
            mcMemberCode: $(".HideMemberCode").val(),
            partnerCardNo: $(".gay-main").find("input[type='text']:visible").val(),
            partnerCode: $("#scoreType").val(),
            partnerFlag: $("#scoreType").val() == "SCORE" ? "SCORE" : "MILEAGE",
            cardType: $(".score-style ul li[class='on']").data("code")
          };


          if (($(".score-style ul li[class='on']").data("code") == "SCORE" && param.partnerCardNo === undefined) || (param.partnerCardNo != null && param.partnerCardNo != undefined && param.partnerCardNo.trim() != "")) {
            if (param.partnerCardNo === undefined) {
              param.partnerCardNo = "";
            }

            $.ajax({
              type: 'POST',
              url: "/services/partnerCardBind",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                if (!result.Success) {
                  $('.gay-main').slideUp('slow');
                  alert($("#failedMsg").val());
                }
                else if (result.Status == "FAIL") {
                  var lang = $("html").attr("lang");
                  if (lang == "zh-CN") alert("保存失败！");
                  else alert("Save Fail !");
                  $('.gay-main').stop(true, true).slideUp('slow');
                }
                else if (result.Success) {

                  $('.gay-main').slideUp('slow');
                  $('.succes-tip').show();
                  $('.succes-tip').fadeOut(4000);
                  //window.location.reload();


                  var typeName = $(".score-style li[class='on']").attr("typeName");
                  if (typeof (typeName) != "undefined") {
                    $("#spTypeName").html(typeName);
                  }
                }

              },
              error: function (jqXHR, textStatus, errorThrown) {
                //.log("Error:", errorThrown);
                $('.gay-main').slideUp('slow');
                alert($("#failedMsg").val());

              }
            });

            // //console.log("/partnerCardBind", param);
          }
          else {

            $('.gay-main').slideUp('slow');

          }
        });

        //$("#searchHistoryBtn").click(function () {
        //    var start = $("#date_1").val();
        //    var end = $("#date_2").val();

        //    var strStart = start.replace(/-/g, "/");
        //    var dateStart = new Date(strStart);

        //    var strEnd = end.replace(/-/g, "/");
        //    var dateEnd = new Date(strEnd);

        //    if (dateEnd < dateStart) {
        //        alert("开始日期必须小于或等于结束日期");
        //        return;
        //    }

        //    var keyword = $("#scoreKw").val();
        //    window.location.href = "?start=" + start + "&end=" + end + "&kw=" + keyword;
        //});

        $(".reset-order").click(function () {
          $("#date_1").val("");
          $("#date_2").val("");
          $("#scoreKw").val("");
        });

        $("#date_1,#date_2").datepicker({
          numberOfMonths: 2,
          changeMonth: false,
          regional: lang_val,
          changeYear: false,
          beforeShow: function () {
            setTimeout(
                    function () {
                      $('#ui-datepicker-div').css("z-index", 101);
                    }
            );
          }
        });
        //*****************************************
        //我的账号-我的积分
        //*****************************************
      });
    } else if (myAccountPage == 'ScoreCheckIn') {
      $(function () {
        //*****************************************
        //我的账号-积分补登
        //*****************************************
        $("#ScoreCheckIn").addClass("active");
        //模拟下来菜单	   
        $(function () {
          //兼容模拟下拉菜单显示tab选项	   
          var index = $("#type").val();
          $('.board-record').find('.tab-mian-change').eq(index).show();

          //模拟下拉菜单	   
          $('.moni-form').jqTransform();

          //兼容模拟下拉菜单隐藏tab选项	 
          $('.board-record').find('.tab-mian-change').eq(index).hide();

          //酒店补登

          var scoreCheckInUtil = {
            numRegex: /^[0-9]*$/,
            fillupSubmit1: function () {
              var flag = scoreCheckInUtil.validateForm($(".jiudian-check"));
              if (flag) {
                var param = {
                  businessType: $("#selectType").find("option[title='" + $("#headChange").find("span").html() + "']").attr("value"),
                  checkInCity: $("#city").val(),
                  hotelName: $("#hotelname").val(),
                  roomNo: $("#roomNo").val(),
                  checkInTime: $("#date_1").val(),
                  checkOutTime: $("#date_2").val(),
                  amount: $("#amount1").val(),
                  orderNo: $("#orderno1").val(),
                  invoiceNo: $("#invoiceno1").val(),
                  mcMemberCode: $(".HideMemberCode").val(),
                  redeemStatus: "OPEN",
                };
                $.ajax({
                  type: 'POST',
                  url: "/services/scoreFillup",
                  dataType: 'JSON',
                  data: param,
                  cache: false,
                  success: function (responseData) {
                    var result = JSON.parse(responseData);
                    //console.log(result);

                    if (result.returnCode == "1") {
                      var msg = $("#hidReloadMsg").val();
                      $("#scoreBtn1").val(msg);
                      location.reload();
                    }
                  },
                  error: function (jqXHR, textStatus, errorThrown) {
                    //console.log("Error:", errorThrown);
                  }
                });
              }
            },
            validateForm: function (formDiv) {
              var flag = true;
              formDiv.find(".wrong_info").parent().find("input").each(function () {
                if ($.trim($(this).val()) == "") {
                  flag = false;
                  $(this).next("span").html($(this).data("null"));
                } else if ($(this).attr("id").indexOf("amount") >= 0) {
                  if (!scoreCheckInUtil.numRegex.test($(this).val())) {
                    flag = false;
                    $(this).next("span").html($(this).data("num"));
                  } else {
                    $(this).next("span").html("");
                  }
                }
                else {
                  $(this).next("span").html("");
                }
              });
              formDiv.find(".wrong_info").parent().find("input").focus(function () {
                $(this).next("span").html("");
              });
              return flag;
            },
            fillupSubmit2: function () {
              var flag = scoreCheckInUtil.validateForm($(".luyou-check"));
              if (flag) {
                var param = {
                  businessType: $("#selectType").find("option[title='" + $("#headChange").find("span").html() + "']").attr("value"),
                  payTime: $("#date_3").val(),
                  storeName: $("#purchaseStore1").val(),
                  lineName: $("#routeName").val(),
                  groupCode: $("#groupNo").val(),
                  departDate: $("#date_4").val(),
                  returnDate: $("#date_5").val(),
                  amount: $("#amount2").val(),
                  orderNo: $("#orderno2").val(),
                  invoiceNo: $("#invoiceno2").val(),
                  mcMemberCode: $(".HideMemberCode").val(),
                  redeemStatus: "OPEN",
                };
                //console.log(param);
                $.ajax({
                  type: 'POST',
                  url: "/services/scoreFillup",
                  dataType: 'JSON',
                  data: param,
                  cache: false,
                  success: function (responseData) {
                    var result = JSON.parse(responseData);
                    //console.log(result);
                    if (result.returnCode == "1") {
                      var msg = $("#hidReloadMsg").val();
                      $("#scoreBtn1").val(msg);
                      location.reload();
                    }
                  },
                  error: function (jqXHR, textStatus, errorThrown) {
                    //console.log("Error:", errorThrown);
                  }
                });
              }
            },
            fillupSubmit3: function () {
              var flag = scoreCheckInUtil.validateForm($(".zhuche-check"));
              if (flag) {
                var param = {
                  businessType: $("#selectType").find("option[title='" + $("#headChange").find("span").html() + "']").attr("value"),
                  storeName: $("#purchaseStore2").val(),
                  payTime: $("#date_6").val(),
                  carStartTime: $("#date_7").val(),
                  carEndTime: $("#date_8").val(),
                  amount: $("#amount3").val(),
                  orderNo: $("#orderno3").val(),
                  invoiceNo: $("#invoiceno3").val(),
                  mcMemberCode: $(".HideMemberCode").val(),
                  redeemStatus: "OPEN",
                };
                //console.log(param);
                $.ajax({
                  type: 'POST',
                  url: "/services/scoreFillup",
                  dataType: 'JSON',
                  data: param,
                  cache: false,
                  success: function (responseData) {
                    var result = JSON.parse(responseData);
                    //console.log(result);
                    if (result.returnCode == "1") {
                      var msg = $("#hidReloadMsg").val();
                      $("#scoreBtn1").val(msg);
                      location.reload();
                    }
                  },
                  error: function (jqXHR, textStatus, errorThrown) {
                    //console.log("Error:", errorThrown);
                  }
                });
              }
            }
          };
          $("#scoreBtn1").click(function () {
            scoreCheckInUtil.fillupSubmit1();
          });
          $("#scoreBtn2").click(function () {
            scoreCheckInUtil.fillupSubmit2();
          });
          $("#scoreBtn3").click(function () {
            scoreCheckInUtil.fillupSubmit3();
          });

          /*
           //积分更改
           $('.change-score').click(function () {
           $('.gay-main').slideDown('slow');
           $('.score-style li:first').click(function () {
           $('.score-style li').attr("class", "");
           $(this).attr("class", "on");
           $('.gay-main-middle').hide();
           });
           $('.score-style li:gt(0)').click(function () {
           $('.score-style li').attr("class", "");
           $(this).attr("class", "on");
           //console.log($(this).attr("cardNo"));

           $('.gay-main-middle').stop(true,true).slideDown('slow');
           $('.see-ruler, .rule-pop').mouseover(function () {
           alert("ZZZ");
           var popWidth = $('.rule-pop').width();
           var popHeight = $('.rule-pop').height();
           var popLeft = $('.see-ruler').offset().left;
           var popTop = $('.see-ruler').offset().top - popHeight - 9;

           $('.rule-pop').css({ "left": popLeft, "top": popTop });
           $('.rule-pop').show();
           });
           $('.see-ruler, .rule-pop').mouseout(function () {
           $('.rule-pop').hide();
           });


           });
           $('.red-btn-S input').click(function () {
           $('.gay-main').slideUp('slow');
           $('.succes-tip').show();
           $('.succes-tip').fadeOut(4000);
           });
           });
           */

          //select 选择酒店，旅游，租车切换

          $('#headChange').find('li a').click(function () {
            var index = $(this).attr("index");
            if (index == 0) {
              $('.jiudian-check').show();
              $('.luyou-check').hide();
              $('.zhuche-check').hide();
            }
            else if (index == 1) {
              $('.jiudian-check').hide();
              $('.luyou-check').show();
              $('.zhuche-check').hide();
            }
            else if (index == 2) {
              $('.jiudian-check').hide();
              $('.luyou-check').hide();
              $('.zhuche-check').show();
            }
            else {
              return false;
            }
          });
        });
        $("#date_1,#date_2,#date_3,#date_4,#date_5,#date_6,#date_7,#date_8").datepicker({
          numberOfMonths: 2,
          changeMonth: false,
          regional: lang_val,
          changeYear: false,
          beforeShow: function () {
            setTimeout(
                    function () {
                      $('#ui-datepicker-div').css("z-index", 101);
                    }
            );
          }
        });
        //*****************************************
        //我的账号-积分补登
        //*****************************************
      });
    } else if (myAccountPage == 'Coupon') {
      $(function () {
        //*****************************************
        //我的账号-优惠券
        //*****************************************
        $("#Coupon").addClass("active");
        //优惠卷弹框1
        var ducHeight = $(document).height();
        var ducWidth = $(document).width();
        $(".page-cover").css("height", ducHeight);
        $(".page-cover").css("width", ducWidth);
        $(".add-card").click(function () {
          $("#add-volume-one").center().show();
          $(".page-cover").show();
          $("#add-volume-one .add-volume-close").click(function (event) {
            event.preventDefault;
            $("#add-volume-one").hide();
            $(".page-cover").hide();
            return false;
          });
          $("#CouponsAdd").click(function (event) {
            event.preventDefault;
            $("#add-volume-one .wrong-tip-mian").html("");

            var newCouponCode = $("#txtNewCouponCode").val();
            var memberCode = $("#MycouponPageMemberCode").val();
            var wehotelid=$("#WehotelId").val();
            if (newCouponCode != undefined && newCouponCode.length == 0) {
              $("#add-volume-one .wrong-tip-mian").html("请输入优惠券编号！");
              return;
            }
            var param = {
              channel: "JINN",
              mcCode: memberCode,
              exchangeCode: newCouponCode
            };
            var data = {
              code: newCouponCode,
              mebId: wehotelid,
              issueType:3
            }
            $.ajax({
              type: 'POST',
              url: "/services/GainCoupon",
              dataType: 'JSON',
              data: data,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                if (result.status == 0) {
                  $("#add-volume-one").hide();
                  $("#divSuccess").show();
                  $("#divinvalid").hide();
                  $("#divexchangeDate").hide();
                  $("#divUsed").hide();
                  $("#add-volume-two").center().show();
                  $("#add-volume-two .add-bottom-close").click(function (event) {
                    event.preventDefault;
                    $("#add-volume-one").hide();
                    $(".page-cover").hide();
                    location.reload();
                  });
                  $("#add-volume-two .add-volume-close").click(function (event) {
                    event.preventDefault;
                    $("#add-volume-one").hide();
                    $(".page-cover").hide();
                    location.reload();
                  });
                } else {
                  $.ajax({
                    type: 'POST',
                    url: "/services/exchangeCoupon",
                    dataType: 'JSON',
                    data: param,
                    cache: false,
                    success: function (responseData) {
                      var result = JSON.parse(responseData);
                      if (result.rtcode == "success") {
                        $("#add-volume-one").hide();
                        $("#divSuccess").show();
                        $("#divinvalid").hide();
                        $("#divexchangeDate").hide();
                        $("#divUsed").hide();
                        $("#add-volume-two").center().show();
                        $("#add-volume-two .add-bottom-close").click(function (event) {
                          event.preventDefault;
                          $("#add-volume-two").hide();
                          $(".page-cover").hide();
                          location.reload();
                        });
                        $("#add-volume-two .add-volume-close").click(function (event) {
                          event.preventDefault;
                          $("#add-volume-two").hide();
                          $(".page-cover").hide();
                          location.reload();
                        });
                      }
                      else {
                        if (result.errorMsg == "3") {
                          $("#divSuccess").hide();
                          $("#divinvalid").hide();
                          $("#divexchangeDate").hide();
                          $("#divUsed").show();
                          $("#add-volume-one").hide();
                          $("#add-volume-two").center().show();
                          $("#add-volume-two .add-bottom-close").click(function (event) {
                            event.preventDefault;
                            $("#add-volume-two").hide();
                            $(".page-cover").hide();
                            location.reload();
                          });
                          $("#add-volume-two .add-volume-close").click(function (event) {
                            event.preventDefault;
                            $("#add-volume-two").hide();
                            $(".page-cover").hide();
                            location.reload();
                          });
                        }
                        else if (result.errorMsg == "1") {
                          $("#divSuccess").hide();
                          $("#divinvalid").hide();
                          $("#divexchangeDate").hide();
                          $("#divUsed").hide();
                          var AddCouponUtil = {
                            bussinessId: "",
                            newCouponCode: "",
                            memberCode: $("#MycouponPageMemberCode").val(),
                            memberId: $("#MycouponPageMemberId").val(),
                            validCouponCode: function () {
                              AddCouponUtil.newCouponCode = $("#txtNewCouponCode").val();
                              var param = {
                                couponCode: AddCouponUtil.newCouponCode,
                                mcMemberCode: AddCouponUtil.memberCode
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/service/validateCouponForExchange",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                  if (result.canUse == "true") {
                                    AddCouponUtil.bussinessId = result.bussinessId;
                                    AddCouponUtil.couponLock();
                                  }
                                  else {
                                    AddCouponUtil.validateCode();
                                  }
                                }
                              });
                            },
                            couponLock: function () {
                              var param = {
                                conponCodes: AddCouponUtil.newCouponCode,
                                mcMemberCode: AddCouponUtil.memberCode
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/service/batchCouponLock",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                  if (result.Success) {
                                    AddCouponUtil.exchangeIssue();
                                  }
                                  else {
                                    $("#add-volume-one .wrong-tip-mian").html("该优惠券不能锁定！");
                                  }
                                }
                              });
                            },
                            exchangeIssue: function () {
                              var param = {
                                issueEvent: "EXCHANGE",
                                mcMemberCode: AddCouponUtil.memberCode,
                                exchangeChannel: "Website",
                                productId: AddCouponUtil.bussinessId
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/service/exchangeIssue",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                  if (result.responseMessage == "SUCCESS") {
                                    AddCouponUtil.showCouponPanel();
                                    AddCouponUtil.fillCoupons(result.List);
                                    AddCouponUtil.couponUsed();
                                  }
                                  else {
                                    AddCouponUtil.couponUnused();
                                    $("#add-volume-one .wrong-tip-mian").html("您无法使用该优惠券！");
                                  }
                                }
                              });
                            },
                            couponUsed: function () {
                              var param = {
                                conponCodes: AddCouponUtil.newCouponCode,
                                memberId: AddCouponUtil.memberCode
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/service/batchCouponUsed",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                  if (result.Success) {
                                    //Do nothing
                                  }
                                }
                              });
                            },
                            couponUnused: function () {
                              var param = {
                                conponCodes: AddCouponUtil.newCouponCode,
                                memberId: AddCouponUtil.memberId
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/service/batchCouponUnUse",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                }
                              });
                            },
                            fillCoupons: function (list) {
                              $('#newCouponTemplate').tmpl(list).appendTo('#newCouponRows');
                            },
                            getCouponRule: function () {
                              var param = {
                                couponCode: AddCouponUtil.newCouponCode
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/services/getCouponRule",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                  if (result.Success) {
                                    $('#newCodeTemplate').tmpl(result).appendTo('#newCouponRows');
                                  }
                                }
                              });
                            },
                            validateCode: function () {
                              var param = {
                                couponCode: AddCouponUtil.newCouponCode,
                                memberCode: AddCouponUtil.memberCode
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/services/couponValidateForAdd",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                  if (result.canUse) {
                                    AddCouponUtil.updateCoupon();
                                  }
                                  else {
                                    $("#add-volume-one .wrong-tip-mian").html("该优惠券编号不能使用！");
                                  }
                                }
                              });
                            },
                            updateCoupon: function () {
                              var param = {
                                couponCode: AddCouponUtil.newCouponCode,
                                memberCode: AddCouponUtil.memberCode
                              };
                              $.ajax({
                                type: 'POST',
                                url: "/services/couponUpdate",
                                dataType: 'JSON',
                                data: param,
                                cache: false,
                                success: function (responseData) {
                                  var result = JSON.parse(responseData);
                                  if (result.Success) {
                                    AddCouponUtil.showCouponPanel();
                                    AddCouponUtil.getCouponRule();
                                  }
                                }
                              });
                            }, showCouponPanel: function () {
                              $("#add-volume-one").hide();
                              $("#add-volume-two").center().show();
                              $("#add-volume-two .add-volume-close").click(function (event) {
                                event.preventDefault;
                                $("#add-volume-two").hide();
                                $(".page-cover").hide();
                              });
                              $("#add-volume-two .add-bottom-close").click(function (event) {
                                event.preventDefault;
                                $("#add-volume-two").hide();
                                $(".page-cover").hide();
                                location.reload();
                              });
                            }
                          };

                          AddCouponUtil.validCouponCode();
                        }
                        else if (result.errorMsg == "2") {
                          $("#divSuccess").hide();
                          $("#divinvalid").hide();
                          $("#divexchangeDate").show();
                          $("#divUsed").hide();
                          $("#add-volume-one").hide();
                          $("#add-volume-two").center().show();
                        }
                      }
                    }
                  });
                }
              }
            })

            //$("#add-volume-one").hide();
            //$("#add-volume-two").center().show();
            //$("#add-volume-two .add-volume-close").click(function (event) {
            //    event.preventDefault;
            //    $("#add-volume-two").hide();
            //    $(".page-cover").hide();
            //    return false;
            //});
            //$("#add-volume-two .add-bottom-close").click(function (event) {
            //    event.preventDefault;
            //    $("#add-volume-two").hide();
            //    $(".page-cover").hide();
            //    return false;
            //});
            return false;
          });
        });

        $(".com-card").click(function () {
          if ($(this).attr("data-coupon") != undefined) {
            var couponData = $(this).attr("data-coupon").split(',');
            $.cookie("CoupDetailRuleTypeCookieKey", couponData[0]);
            $.cookie("CoupDetailRuleIdCookieKey", couponData[1]);
            window.location.href = window.location.origin + window.location.pathname + "/CouponDetail";

          }
        });

        //*****************************************
        //我的账号-优惠券
        //*****************************************
      });
    } else if (myAccountPage == 'CouponDetail') {
      $(function () {
        //*****************************************
        //我的账号-优惠券-优惠券详情
        //*****************************************
        $("#Coupon").addClass("active");
        $("#main_0_input_keyWord").attr("placeholder", waterMark)
        if ($("#main_0_sfdq_tj").val() != "") {
          $("#pProvince").attr("title", $("#main_0_sfdq_tj").val());
          $("#pProvince").html($("#main_0_sfdq_tj").val());
        }
        if ($("#main_0_csdq_tj").val() != "") {
          $("#pCity").attr("title", $("#main_0_csdq_tj").val());
          $("#pCity").html($("#main_0_csdq_tj").val());
        }
        //为所有selecct_box类模拟下拉框
        var shenfen = "#shenfen";
        var chengshi = "#chengshi";
        var sfp = shenfen + ' p'
        var csp = chengshi + ' p'
        var sfs = shenfen + ' .m_zlxg2'
        var css = chengshi + ' .m_zlxg2'
        var sfli = shenfen + ' ul li'
        var csli = chengshi + ' ul li'
        var This = this;
        var LiminWidth = $(this).find(".m_zlxg").width();
        $('.m_zlxg p').click(function () {
          $(This).find('.m_zlxg2').hide();
          $(this).parent().find('.m_zlxg2').slideDown(200);
        })
        var csgsmr = [{ name: 0, val: "请选择" }];
        var kuandu = new Array();
        if ($(chengshi).find('ul li').length == 0) {
          for (b = 0; b < csgsmr.length; b++) {
            var csmcmr = csgsmr[b];
            var csnrmr = "<li data-name=\"" + csmcmr.name + "\">" + csmcmr.val + "</li>";
            $(chengshi).find('ul').append(csnrmr);
            kuandu[b] = csmcmr.length * 14 + 20;
          }
        }
        Array.max = function (array) {
          return Math.max.apply(Math, array);
        }
        var max_kd = Array.max(kuandu);
        if (max_kd < LiminWidth) {
          $(css).width(LiminWidth);
        } else {
          $(css).width(max_kd);
        }

        $(sfli).click(function () {
          var optionsf = $(this);

          var dqsf = $(this).text();
          $(shenfen).find('p').text(dqsf);
          $(shenfen).find('p').attr('title', dqsf);
          var sfnum = $(this).index();
          var provinceId = $(this).data("name");
          $("#main_0_sfdq_val").val(provinceId);
          $(shenfen).data("name", provinceId);
          $(shenfen).data("text", dqsf);

          var url = "/services/listCityTypes";
          if (provinceId != 0) {
            $.ajax({
              url: url,
              dataType: 'json',
              type: "POST",
              data: encodeURI("name=" + provinceId),
              success: function (result) {
                var csgs = JSON.parse(result).Results;

                $(chengshi).find('ul').text('');
                var csnr = "<li data-name=\"0\">请选择</li>";
                $(chengshi).find('ul').append(csnr);
                var kuandu = new Array();

                for (i = 0; i < csgs.length; i++) {
                  var csmc = csgs[i];
                  var csnr = "<li data-name=\"" + csmc.name + "\">" + csmc.val + "</li>";
                  $(chengshi).find('ul').append(csnr);
                  kuandu[i] = csmc.length * 14 + 20;
                }
                Array.max = function (array) {
                  return Math.max.apply(Math, array);
                }
                var max_kd = Array.max(kuandu);
                if (max_kd < LiminWidth) {
                  $(css).width(LiminWidth);
                } else {
                  $(css).width(max_kd);
                }
                $(csp).text($(chengshi).find('ul li').eq(0).text());
                $(csp).data("name", $(chengshi).find('ul li').eq(0).data("name"));
                $("#main_0_csdq_tj").val("");
                /*------------------*/
                $(csli).click(function () {
                  var option = $(this);
                  var dqcs = $(this).text();
                  var cityId = $(this).data("name");
                  $(chengshi).find('p').text(dqcs);
                  $(chengshi).find('p').attr('title', dqcs);
                  $(chengshi).data('name', cityId);
                  $(chengshi).data('text', dqcs);
                  option.parent().parent().slideUp(200);
                });

                optionsf.parent().parent().slideUp(200);
              }
            });
          } else {
            var csgsmr = [{ name: 0, val: "请选择" }];
            var kuandu = new Array();

            $(chengshi).find('ul').text('');
            for (b = 0; b < csgsmr.length; b++) {
              var csmcmr = csgsmr[b];
              var csnrmr = "<li data-name=\"" + csmcmr.name + "\">" + csmcmr.val + "</li>";
              $(chengshi).find('ul').append(csnrmr);
              kuandu[b] = csmcmr.length * 14 + 20;

            }
            Array.max = function (array) {
              return Math.max.apply(Math, array);
            }
            var max_kd = Array.max(kuandu);
            if (max_kd < LiminWidth) {
              $(css).width(LiminWidth);
            } else {
              $(css).width(max_kd);
            }
            $(csp).text($(chengshi).find('ul li').eq(0).text());
            $(csp).data("name", $(chengshi).find('ul li').eq(0).data("name"));
            optionsf.parent().parent().slideUp(200);
          }
        })

        $(csli).click(function () {
          var option = $(this);
          var dqcs = $(this).text();
          var cityId = $(this).data("name");
          $(chengshi).find('p').text(dqcs);
          $(chengshi).find('p').attr('title', dqcs);
          $(chengshi).data('name', cityId);
          $(chengshi).data('text', dqcs);
          option.parent().parent().slideUp(200);
        });

        $('.m_zlxg').click(function () {
          $(this).parent().parent().find('#main_0_sfdq_tj').val($(sfp).text());
          $(this).parent().parent().find('#main_0_csdq_tj').val($(csp).text());
        })

        $(document).bind("click", function (e) {
          var target = $(e.target);
          if (target.closest(".m_zlxg").length == 0) {
            $(".m_zlxg2").slideUp(200);
          }
        });
        $(".btn-search").click(function () {
          if ($("#main_0_csdq_tj").val() == "" || $("#main_0_csdq_tj").val() == "请选择") {
            var lang = $("html").attr("lang");
            if (lang == "zh-CN") alert("请选择城市");
            else alert("Please choose the city !");

          }
        });
        //$(".btn-search").click(function () {
        //    if ($("#input_keyWord").val() == "" || $("#csdq_tj").val() == "") {
        //        alert("请输入关键字和城市");
        //        return;
        //    }
        //    var param = {
        //        codes: $("#hid_codes").val(),
        //        destination: $("#csdq_tj").val(),
        //        keywords: $("#input_keyWord").val(),
        //        language: $("#hid_language").val(),
        //        page: $("#hid_page").val(),
        //        rows: $("#hid_rows").val()
        //    };
        //    $.ajax({
        //        type: 'POST',
        //        url: "/services/QueryHotelNameByCore",
        //        dataType: 'JSON',
        //        data: param,
        //        cache: false,
        //        success: function (responseData) {
        //            var result = JSON.parse(responseData);
        //            if (result.Success) {
        //                if (result.results.length > 0) {
        //                    var htmlStr = "";
        //                    for (var i = 0; i < result.results.length; i++) {
        //                        htmlStr += "<tr><td><div>" + $("#sfdq_tj").val() + "</div></td><td><div>" + $("#csdq_tj").val() + "</div></td><td><div class=\"hotel-name\">" + result.results[i].hotelName.nameValueZH + "</div></td><td><div> <a href=\"" + $("#hid_url").val() + result.results[i].hotelCode + "\" target=\"_blank\">立即预定</a></div></td></tr>"
        //                    }

        //                    $('#tb_tbody').html(htmlStr)
        //                    $("#span_TotalCount").html(result.results.length);
        //                    $(".volume-ago").css("display", "block");
        //                    $(".fail-search").css("display", "none");
        //                }
        //                else {
        //                    $(".volume-ago").css("display", "none");
        //                    $(".fail-search").css("display", "block");
        //                    $("#span_NoCoupon").html($("#input_keyWord").val());
        //                }
        //            }
        //        }
        //    });
        //})
      });


    }
    else if (myAccountPage == 'PersonalInformation') {

      $("#PersonalInformation").addClass("active");

      function trim(str) {
        return str.replace(/^(\s|\xA0)+|(\s|\xA0)+$/g, '');
      }

      //省市级联动

      function getJsonCitys(object) {
        var provinceId = $(object).val();
        var url = "/services/listCityTypes";
        if ($.trim(provinceId) != "") {
          $.ajax({
            url: url,
            dataType: 'json',
            type: "POST",
            data: encodeURI("name=" + provinceId),
            success: function (result) {
              var dataValue = JSON.parse(result);
              var option = "<option>选择城市</option>";
              $.each(dataValue.Results, function (i, item) {
                option = option + "<option value='" + item.name + "'>" + item.val + "</option>";
              });

              if ($("select[name='useradress2']").parent().hasClass('jqTransformSelectWrapper')) {
                $("select[name='useradress2']").parent().remove();
              }
              else {
                $("select[name='useradress2']").remove();
              }
              if ($("select[name='useradress3']").parent().hasClass('jqTransformSelectWrapper')) {
                $("select[name='useradress3']").parent().remove();
              }
              else {
                $("select[name='useradress3']").remove();
              }

              var $address2 = '<select name="useradress2" onchange="getJsonAreas(this)">' + option + '</select>';
              $('#userAddress2Label').after($address2);

              var $address3 = '<select name="useradress3"><option>选择区县</option></select>';
              $('#userAddress3Label').after($address3);

              $('select').jqTransSelect();
            }
          });
        } else {
          $("#contactInfoError").html("请先选择城市!");
        }
      }

      function getJsonAreas(object) {
        var cityId = $(object).val();
        if ($.trim(cityId) != "") {
          var url = "/services/listTownTypes";
          $.ajax({
            url: url,
            dataType: 'json',
            type: "POST",
            data: encodeURI("name=" + cityId),
            success: function (result) {
              var data = JSON.parse(result);
              var option = "<option>选择区县</option>";
              $.each(data.Results, function (i, item) {
                option = option + "<option value='" + item.name + "'>" + item.val + "</option>";
              });
              if ($("select[name='useradress3']").parent().hasClass('jqTransformSelectWrapper')) {
                $("select[name='useradress3']").parent().remove();
              }
              else {
                $("select[name='useradress3']").remove();
              }
              var $address3 = '<select name="useradress3">' + option + '</select>';
              $('#userAddress3Label').after($address3);
              $('select').jqTransSelect();
            }
          });
        } else {
          $("#contactInfoError").html("请先选择区县!");
        }
      }

      $(function () {
        //*****************************************
        //我的账号-个人信息
        //*****************************************
        var hasAdd = false;
        if ($('#main_0_Lbl_useradress5').html() != undefined && $('#main_0_Lbl_useradress5').html() != "") {
          hasAdd = true;
        }
        else {
          hasAdd = false;
        }
        $(".info-form").Validform({
          tiptype: function (msg, o, cssctl) {
            //msg：提示信息;
            //o:{obj:*,type:*,curform:*}, obj指向的是当前验证的表单元素（或表单对象），type指示提示的状态，值为1、2、3、4， 1：正在检测/提交数据，2：通过验证，3：验证失败，4：提示ignore状态, curform为当前form对象;
            //cssctl:内置的提示信息样式控制函数，该函数需传入两个参数：显示提示信息的对象 和 当前提示的状态（既形参o中的type）;
            if (!o.obj.is(".info-form")) {//验证表单元素时o.obj为该表单元素，全部验证通过提交表单时o.obj为该表单对象;
              var objtip = o.obj.siblings(".Validform_checktip");
              cssctl(objtip, o.type);
              objtip.html(msg);
            }
          }
        });

        //模拟下拉菜单	   
        $('.jqForm').jqTransform();
        var countdown = 60;//倒计时秒数
        var flag = "true";//是否倒计时结束
        $("#check-phone-one .wrong-tip").hide();
        //未验证手机弹出层
        var ducHeight = $(document).height();
        var ducWidth = $(document).width();
        $(".page-cover").css("height", ducHeight);
        $(".page-cover").css("width", ducWidth);
        $(".check-mail a").click(function () {
          $("#check-phone-one").center().show();
          $(".page-cover").show();
          $("#check-phone-one .com-pup-close").click(function (event) {
            event.preventDefault;
            $("#check-phone-one").hide();
            $(".page-cover").hide();
            $("#check-phone-one .wrong-tip").hide();
            return false;
          });
          $("#check-phone-one .check-text").click(function (event) {
            //trim(this);
            $('#check-phone-one .phone-err').hide();
            var reg = /^[1][3,4,5,7,8][0-9]{9}$/;
            if ($("#phoneId").val() != "" && reg.test($("#phoneId").val())) {
              event.preventDefault;
              $('#check-phone-one .gay-second').show();
              $('#check-phone-one .second-tip').show();
              $(this).hide();
              $("#phone").val($("#check-phone-one .com-pup-input").eq(0).find("input").val());//获取手机号
              settime();
              return false;
            }
            else {
              $('#check-phone-one .phone-err').show();
              return false;
            }
          });
        });

        //倒计时60秒
        function settime() {

          if (flag == 'true') {
            $('#check-phone-one .gay-second').show();
            $('#check-phone-one .second-tip').show();
            var phoneNum = $("#phone").val();
            var memberid = $(".HideMemberId").val();
            var param = {
              memberInfoId: memberid,
              phone: phoneNum,
              ipAddress: "172.24.214.118"
            };
            //根据手机号生成验证码ajax开始
            $.ajax({
              type: 'POST',
              url: "/service/validatePhone",
              dataType: 'json',
              data: param,
              cache: false,
              success: function (responseData) {
                var result = JSON.parse(responseData);
                if (result.Success) {
                  $("#check-phone-one .wrong-tip").hide();
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                $("#check-phone-one .wrong-tip").show();
                $("#errorMessage").html($("#Exception").val());
              }

            });
            //根据手机号生成验证码结束
          }

          if (countdown == 0) {
            $('#check-phone-one .gay-second').hide();
            $('#check-phone-one .second-tip').hide();
            $('#check-phone-one .phone-err').hide();
            $("#check-phone-one .check-text").show();
            $("#check-phone-one .check-text").html($("#Resend").val())
            countdown = 60;
            flag = "true";
          } else {
            $("#check-phone-one .gay-second").html(countdown + $("#Seconds").val());
            countdown--;
            setTimeout(function () {
              settime()
            }, 1000);
            flag = "false";
          }

        }

        Date.prototype.Format = function (fmt) { //author: meizz   
          var o = {
            "M+": this.getMonth() + 1,                 //月份   
            "d+": this.getDate(),                    //日   
            "h+": this.getHours(),                   //小时   
            "m+": this.getMinutes(),                 //分   
            "s+": this.getSeconds(),                 //秒   
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度   
            "S": this.getMilliseconds()             //毫秒   
          };
          if (/(y+)/.test(fmt))
            fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
          for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
              fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
          return fmt;
        }

        $("#check-phone-one .com-botton-step1").click(function () {
          var createTime = new Date().Format("yyyy-MM-dd hh:mm:ss.S");
          var date = createTime.toLocaleString();
          $("#code").val($("#check-phone-one .com-pup-input").eq(1).find("input").val());//获取验证码
          var phoneNum = $("#phoneId").val();
          var code = $("#validationCode").val();
          var param = {
            validationCode: code,
            mcCode: $(".HideMemberCode").val(),
            phone: phoneNum,
            ipAddress: "172.24.214.118"
          };
          //根据手机号生成验证码ajax开始
          $.ajax({
            type: 'POST',
            url: "/service/smsRegisterValidation",
            dataType: 'json',
            data: param,
            cache: false,
            success: function (responseData) {
              //var result = JSON.parse(responseData);
              if (responseData == "true") {
                $("#check-phone-one .wrong-tip").hide();
                var updateParam = { "mcMemberCode": $(".HideMemberCode").val(), "lastName": $("#hdnlastName").val(), "title": $("#hdntitle").val(), "email": $("#hdnusermail").val(), "cell": phoneNum, "cdtype": $("#hdncdtype").val(), "cdno": $("#hdncdno").val(), "birthday": $("#hdnbirthday").val(), "edulevl": $("#hdnedulevl").val() }
                $.ajax({
                  type: 'POST',
                  url: "/services/updateBaseInfo",
                  dataType: 'JSON',
                  data: updateParam,
                  cache: false,
                  success: function (data) {
                    var result = JSON.parse(data);
                    if (result.Success) {
                      //$(this).parents('.info-form').hide();
                      window.location.reload();
                    }
                    else {
                      //$("#baseInfoError").html($("#UpdateError").val());
                    }
                  }
                });
              } else {
                $("#check-phone-one .wrong-tip").show();
                $("#errorMessage").html($("#CodeError").val());

              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              $("#check-phone-one .wrong-tip").show();
              $("#errorMessage").html($("#Exception").val());
            }
          });
          //根据手机号生成验证码结束
        });

        //个人账户切换

        $('.info-form').hide();
        $(this).parents(".jqTransformSelectWrapper").find("ul").show();
        $('.editor-click').click(function () {

          $(this).parents('.info-head').nextAll('.info-form').show();
          $(this).parents('.info-head').nextAll('.info-table').hide();
          $(this).hide();
          $("#contactInfoError").html("");
          $("#baseInfoError").html("");
          $("#interestError").html("");
          //传值
          if (this.id == 'editorPersonalInfo') {
            //姓名
            var username = $(".username span").html();
            $("input[name='username']").val(username);
            //性别
            var usersex = $(".usersex span").html();
            if ($(".HideLanguage").val != "en") {
              if (usersex == '女士') {
                $('#women').attr('checked', "");
                $('#women').prevAll('.jqTransformRadio').addClass("jqTransformChecked");
              }
              else {
                $('#man').attr('checked', "");
                $('#man').prevAll('.jqTransformRadio').addClass("jqTransformChecked");
              }
            } else {
              if (usersex == 'Mrs.') {
                $('#women').attr('checked', "");
                $('#women').prevAll('.jqTransformRadio').addClass("jqTransformChecked");
              }
              else {
                $('#man').attr('checked', "");
                $('#man').prevAll('.jqTransformRadio').addClass("jqTransformChecked");
              }
            }
            //身份证
            var usercard = $(".usercard span").html();
            $("select[name='usercard']").find('option').each(function (index, element) {
              if ($(this).html() == usercard) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(usercard);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            //证件号
            var cardnumber = $(".cardnumber span").html();
            $("input[name='cardnumber']").val(cardnumber);
            //手机号
            var userphone = $(".userphone span").html();
            $("input[name='userphone']").val(userphone);
            //邮箱
            var usermail = $(".usermail span").html();
            $("input[name='usermail']").val(usermail);
            //生日 年
            var userbirth1 = $(".userbirth1 span").html();
            $("select[name='userbirth1']").find('option').each(function (index, element) {
              var useryear = $(this).html();
              if (trim(useryear) == trim(userbirth1)) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(userbirth1);

                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            //生日 月
            var userbirth2 = $(".userbirth2 span").html();
            $("select[name='userbirth2']").find('option').each(function (index, element) {
              var usermonth = $(this).html();
              if (trim(usermonth) == trim(userbirth2)) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(userbirth2);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            //生日 日
            var userbirth3 = $(".userbirth3 span").html();
            $("select[name='userbirth3']").find('option').each(function (index, element) {
              var userday = $(this).html();
              if (trim(userday) == trim(userbirth3)) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(userbirth3);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            //教育程度
            //var usereducation = $(".usereducation span").html();
            //$("select[name='usereducation']").find('option').each(function (index, element) {
            //    if ($(this).html() == usereducation) {
            //        $(this).attr("selected", "");

            //        $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
            //        $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
            //        $(this).parents(".jqTransformSelectWrapper").find('span').html(usereducation);
            //        $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
            //        return false;
            //    }
            //})
            var useradress1 = $(".useradress1 span").html();
            //联系地址 省
            $("select[name='useradress1']").find('option').each(function (index, element) {
              if (trim($(this).html()) == trim(useradress1)) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(useradress1);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var useradress2 = $(".useradress2 span").html();
            //联系地址 市
            $("select[name='useradress2']").find('option').each(function (index, element) {
              if (trim($(this).html()) == trim(useradress2)) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(useradress2);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var useradress3 = $(".useradress3 span").html();
            //联系地址 区
            $("select[name='useradress3']").find('option').each(function (index, element) {
              if (trim($(this).html()) == trim(useradress3)) {
                $(this).attr("selected", "");
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(useradress3);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var useradress4 = $(".useradress4 span").html();
            //详细地址
            $("input[name='useradress4']").val(useradress4);

          }
          if (this.id == 'editorcontactInfo') {
            var homephone = $(".homephone span").html();
            //固定电话
            $("input[name='homephone']").val(homephone);
            var userfax = $(".userfax span").html();
            //传真
            $("input[name='userfax']").val(userfax);
            var userqq = $(".userqq span").html();
            //Mns/qq
            $("input[name='userqq']").val(userqq);
            var useranothermail = $(".useranothermail span").html();
            //备用邮箱
            $("input[name='useranothermail']").val(useranothermail);

            var useradress1 = $(".useradress1 span").html();
            //联系地址 省
            $("select[name='useradress1']").find('option').each(function (index, element) {
              if (trim($(this).html()) == trim(useradress1)) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(useradress1);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var useradress2 = $(".useradress2 span").html();
            //联系地址 市
            $("select[name='useradress2']").find('option').each(function (index, element) {
              if (trim($(this).html()) == trim(useradress2)) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(useradress2);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var useradress3 = $(".useradress3 span").html();
            //联系地址 区
            $("select[name='useradress3']").find('option').each(function (index, element) {
              if (trim($(this).html()) == trim(useradress3)) {
                $(this).attr("selected", "");
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(useradress3);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var useradress4 = $(".useradress4 span").html();
            //详细地址
            $("input[name='useradress4']").val(useradress4);

            var userzipcode = $(".userzipcode span").html();
            //邮编
            $("input[name='userzipcode']").val(userzipcode);
          }
          // $('select').jqTransSelect();
          if (this.id == 'editorinterest') {

            var interest = $(".interest span").html();
            //个人兴趣
            var ainterest = "";
            ainterest = interest;
            var strs = new Array();
            strs = ainterest.split(","); //字符分割 
            $("input[name='interest']").each(function (index, element) {
              for (var i = 0; i < strs.length ; i++) {
                if ($(this).val() == strs[i]) {
                  $(this).attr("checked", "");
                  $(this).prevAll('a').addClass('jqTransformChecked');
                }
              }

            });

            var lovestyle1 = $(".lovestyle1 span").html();
            //住宿偏好 楼层
            $("select[name='lovestyle1']").find('option').each(function (index, element) {
              if ($(this).html() == lovestyle1) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(lovestyle1);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })
            var lovestyle2 = $(".lovestyle2 span").html();
            //住宿偏好 环境
            $("select[name='lovestyle2']").find('option').each(function (index, element) {
              if ($(this).html() == lovestyle2) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(lovestyle2);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var lovestyle3 = $(".lovestyle3 span").html();
            //住宿偏好 房间
            $("select[name='lovestyle3']").find('option').each(function (index, element) {
              if ($(this).html() == lovestyle3) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(lovestyle3);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var lovestyle4 = $(".lovestyle4 span").html();
            //住宿偏好 床品选择
            $("select[name='lovestyle4']").find('option').each(function (index, element) {
              if ($(this).html() == lovestyle4) {
                $(this).attr("selected", "");

                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul li a").removeClass('selected');
                $(this).parents(".jqTransformSelectWrapper").find(".jqTransformSelectWrapper ul").find("li").eq(index).children().addClass("selected");
                $(this).parents(".jqTransformSelectWrapper").find('span').html(lovestyle4);
                $(this).parents(".jqTransformSelectWrapper").find("ul").hide();
                return false;
              }
            })

            var trvel = $(".trvel span").html();
            //旅游偏好
            var atrvel = "";
            atrvel = trvel.replace("&amp;", "&");
            var strvel = new Array();
            strvel = atrvel.split(","); //字符分割

            $("input[name='trvel']").each(function (index, element) {
              for (var i = 0; i < strvel.length ; i++) {

                if ($(this).val() == strvel[i]) {
                  $(this).attr("checked", "");
                  $(this).prevAll('a').addClass('jqTransformChecked');
                }
              }

            });

            var lovecar = $(".lovecar span").html();
            //最爱座驾
            var alovecar = "";
            alovecar = lovecar;
            var slovecar = new Array();
            slovecar = alovecar.split(","); //字符分割
            $("input[name='lovecar']").each(function (index, element) {
              for (var i = 0; i < strvel.length ; i++) {
                if ($(this).val() == slovecar[i]) {
                  $(this).attr("checked", "");
                  $(this).prevAll('a').addClass('jqTransformChecked');
                }
              }

            });

          }
        });

        //模拟下拉菜单	   
        $('.jqForm').jqTransform();

        function isPostCode(a) {
          var reg = /^[0-9]{6}$/;
          return (reg.test(a));
        }

        function checkEmail(email) {
          var emailRegExp = new RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?");
          if (!emailRegExp.test(email) || email.indexOf('.') == -1) {
            return false;
          } else {
            return true;
          }
        }

        function isQQ(qq) {
          var filter = /^\s*[.0-9]{5,10}\s*$/;
          if (!filter.test(qq)) {
            return false;
          } else {
            return true;
          }
        }

        function checkPhone(phone) {
          var partten = /^((\(\d{3}\))|(\d{3}\-))?13[0-9]\d{8}|14[0-9]\d{8}|15[0-9]\d{8}|17[0-9]\d{8}|18[0-9]\d{8}$/;
          if (partten.test(phone)) {
            return true;
          } else {
            return false;
          }
        }

        function checkHomePhone(tel) {
          var partten = /^\d{8}|\d{4}-\d{7}$/;
          if (partten.test(tel)) {
            return true;
          } else {
            return false;
          }
        }

        //兴趣爱好保存
        $('#interestInfo').click(function () {
          //$(this).parents('.info-form').prevAll('.info-head').find('.editor-click').show();
          //$(this).parents('.info-form').prevAll('.info-table').show();
          var culture = "N";
          var fashion = "N";
          var music = "N";
          var publi = "N";
          var ptravel = "N";
          var sports = "N";
          var shopping = "N";
          var movie = "N";
          var muslim = "N";
          var vegetarian = "N";
          var game = "N";
          var mag = "N";
          //个人兴趣
          var ainterest = "";
          $("input[name='interest']").prevAll('a.jqTransformChecked').each(function (index, element) {
            var This = this;
            for (var i = 0; i < $(This).length ; i++) {
              ainterest += $(This).next().val() + ",";

              if ($(This).next().val() == '') { culture = "Y"; }
              else if ($(This).next().val() == '') { fashion = "Y"; }
              else if ($(This).next().val() == '') { music = "Y"; }
              else if ($(This).next().val() == '') { publi = "Y"; }
              else if ($(This).next().val() == '') { ptravel = "Y"; }
              else if ($(This).next().val() == '') { sports = "Y"; }
              else if ($(This).next().val() == '') { shopping = "Y"; }
              else if ($(This).next().val() == '') { movie = "Y"; }
              else if ($(This).next().val() == '') { muslim = "Y"; }
              else if ($(This).next().val() == '') { vegetarian = "Y"; }
              else if ($(This).next().val() == '') { game = "Y"; }
              else if ($(This).next().val() == '') { mag = "Y"; }

              //if ($(This).next().val() == "文化") { culture = "Y"; }
              //else if ($(This).next().val() == "时尚") { fashion = "Y"; }
              //else if ($(This).next().val() == "音乐") { music = "Y"; }
              //else if ($(This).next().val() == "大众") { publi = "Y"; }
              //else if ($(This).next().val() == "旅游") { ptravel = "Y"; }
              //else if ($(This).next().val() == "运动") { sports = "Y"; }
              //else if ($(This).next().val() == "购物") { shopping = "Y"; }
              //else if ($(This).next().val() == "电影") { movie = "Y"; }
              //else if ($(This).next().val() == "清真") { muslim = "Y"; }
              //else if ($(This).next().val() == "素食") { vegetarian = "Y"; }
              //else if ($(This).next().val() == "游戏") { game = "Y"; }
              //else if ($(This).next().val() == "报刊杂志") { mag = "Y"; }

              //if ($(This).next().val() == "Culture") { culture = "Y"; }
              //else if ($(This).next().val() == "Fashion") { fashion = "Y"; }
              //else if ($(This).next().val() == "Music") { music = "Y"; }
              //else if ($(This).next().val() == "Public") { publi = "Y"; }
              //else if ($(This).next().val() == "Travelling") { ptravel = "Y"; }
              //else if ($(This).next().val() == "Sports") { sports = "Y"; }
              //else if ($(This).next().val() == "Shopping") { shopping = "Y"; }
              //else if ($(This).next().val() == "Movie") { movie = "Y"; }
              //else if ($(This).next().val() == "Halal") { muslim = "Y"; }
              //else if ($(This).next().val() == "Vegan") { vegetarian = "Y"; }
              //else if ($(This).next().val() == "Games") { game = "Y"; }
              //else if ($(This).next().val() == "Newspaper & Magazines") { mag = "Y"; }
            }
          });
          var interest = $("input[name='interest']").prevAll('a.jqTransformChecked').next().val();
          $(".interest").html(ainterest.substring(0, ainterest.length - 1));

          var hobbyMemberId = $(".HideMemberId").val();
          var data = { "culture": culture, "fashion": fashion, "music": music, "publi": publi, "memberId": hobbyMemberId, "travel": ptravel, "sports": sports, "shopping": shopping, "movie": movie, "muslim": muslim, "vegetarian": vegetarian, "game": game, "mag": mag };
          $.ajax({
            type: 'POST',
            url: "/services/updateMemberHobby",
            dataType: 'JSON',
            data: data,
            cache: false,
            success: function (data) {
              var result = JSON.parse(data);

              if (result.Success) {
                $(this).parents('.info-form').hide();
              }
              else {
                $("#contactInfoError").html($("#UpdateError").val());
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              $("#contactInfoError").html($("#UpdateError").val());
            }
          });

          var lovestyle1 = $("input[name='lovestyle1']").val();
          var lovestyle2 = $("input[name='lovestyle2']").val();
          var lovestyle3 = $("input[name='lovestyle3']").val();
          var lovestyle4 = $("input[name='lovestyle4']").val();
          var trvel = $("input[name='trvel']").val();
          var lovecar = $("input[name='lovecar']").val();

          //住宿偏好 楼层
          var lovestyle1 = "";
          $("select[name='lovestyle1']").find('option').each(function (index, element) {
            if ($(this).attr("selected") == "selected") {
              lovestyle1 = $(this).html();
              if (lovestyle1 == "无偏好") {
                lovestyle1 = "无楼层偏好";
              }
              $(".lovestyle1").html(lovestyle1);
            }
          })

          //住宿偏好 环境
          var lovestyle2 = "";
          $("select[name='lovestyle2']").find('option').each(function (index, element) {
            if ($(this).attr("selected") == "selected") {
              lovestyle2 = $(this).html();
              if (lovestyle2 == "无偏好") {
                lovestyle2 = "无环境偏好";
              }
              $(".lovestyle2").html(lovestyle2);
            }
          })

          //住宿偏好 房间
          var lovestyle3 = "";
          $("select[name='lovestyle3']").find('option').each(function (index, element) {
            if ($(this).attr("selected") == "selected") {
              lovestyle3 = $(this).html();
              if (lovestyle3 == "无偏好") {
                lovestyle3 = "无房间偏好";
              }
              $(".lovestyle3").html(lovestyle3);
            }
          })

          //住宿偏好 床品类型
          var lovestyle4 = "";
          $("select[name='lovestyle4']").find('option').each(function (index, element) {
            if ($(this).attr("selected") == "selected") {
              lovestyle4 = $(this).html();
              if (lovestyle4 == "无偏好") {
                lovestyle4 = "无房型偏好";
              }
              $(".lovestyle4").html(lovestyle4);
            }
          })

          //旅游偏好
          var atrvel = "";
          $("input[name='trvel']").prevAll('a.jqTransformChecked').each(function (index, element) {
            var This = this;
            for (var i = 0; i < $(This).length ; i++) {
              atrvel += $(This).next().val() + ",";
            }
          });
          var trvel = $("input[name='trvel']").prevAll('a.jqTransformChecked').next().val();
          atrvel = atrvel.substring(0, atrvel.length - 1);
          atrvel = atrvel.replace("&", "&amp;");
          $(".trvel").html(atrvel);

          //最爱座驾
          var alovecar = "";
          $("input[name='lovecar']").prevAll('a.jqTransformChecked').each(function (index, element) {
            var This = this;
            for (var i = 0; i < $(This).length ; i++) {
              alovecar += $(This).next().val() + ",";
            }
          });
          var lovecar = $("input[name='lovecar']").prevAll('a.jqTransformChecked').next().val();
          alovecar = alovecar.substring(0, alovecar.length - 1);
          $(".lovecar").html(alovecar);

          var defaultlanguage = $(".languagehide").val();
          var TravelMemberId = $(".HideMemberId").val();
          var TravellPreference = { "memberId": TravelMemberId, "bedType": lovestyle4, "defaultLanguage": defaultlanguage, "dreamDestination": atrvel, "environment": lovestyle2, "favouriteCar": alovecar, "floor": lovestyle1, "room": lovestyle3 };
          $.ajax({
            type: 'POST',
            url: "/services/updateTravellPreference",
            dataType: 'JSON',
            data: TravellPreference,
            cache: false,
            success: function (data) {
              var result = JSON.parse(data);

              if (result.Success) {
                //$(this).parents('.info-form').hide();
                window.location.reload();
              }
              else {
                $("#interestError").html($("#UpdateError").val());
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              $("#interestError").html($("#UpdateError").val());
            }
          });
          // $(this).parents('.info-form').hide();
        });

        //个人信息保存
        $('#PersonalInfo').click(function () {



          $("#baseInfoError").html("");
          var memberId = $(".HideMemberId").val();
          var memberCode = $(".HideMemberCode").val()
          var username = $("input[name='username']").val();
          $(".username").html("<span>" + username + "</span>");
          //性别
          var usersex = $("input[name='usersex']").prevAll('a.jqTransformChecked').next().val();
          $(".usersex").html("<span>" + usersex + "</span>");
          //证件类型
          var usercard = $("select[name='usercard']").prevAll('ul').find('a.selected').html();
          $(".usercard").html(usercard);
          var cardType = "";
          $("select[name='usercard']").find('option').each(function (index, element) {
            if (trim($(this).html()) == trim(usercard)) {
              cardType = $(this).val();
            }
          })
          //证件号
          var cardnumber = $("input[name='cardnumber']").val();
          $(".cardnumber").html(cardnumber);
          //邮箱
          var usermail = $("input[name='usermail']").val();
          $(".usermail").html(usermail);
          //手机
          var userphone = $("input[name='userphone']").val();
          $(".userphone").html(userphone);
          //生日
          //生日 年

          var userbirth1 = $("select[name='userbirth1']").parents(".jqTransformSelectWrapper").find('span').html();
          $(".userbirth1").html(userbirth1);
          //生日 月
          var userbirth2 = $("select[name='userbirth2']").parents(".jqTransformSelectWrapper").find('span').html();

          $(".userbirth2").html(userbirth2);
          //生日 日
          var userbirth3 = $("select[name='userbirth3']").parents(".jqTransformSelectWrapper").find('span').html();
          $(".userbirth3").html(userbirth3);

          //var usereducation = $("select[name='usereducation']").prevAll('div').find('span').html();
          //$(".usereducation").html(usereducation);
          var cation = "";
          //$("select[name='usereducation']").find('option').each(function (index, element) {
          //    if (trim($(this).html()) == trim(usereducation)) {
          //        cation = $(this).val();
          //    }
          //})
          var birthday = userbirth2 + "/" + userbirth3 + "/" + userbirth1;
          if (userbirth1 == "YYYY") {
            $("#baseInfoError").html($("#BirthMsg").val());
            return false;
          }
          if (userbirth2 == "MM") {
            $("#baseInfoError").html($("#BirthMsg").val());
            return false;
          }
          if (userbirth3 == "DD") {

            $("#baseInfoError").html($("#BirthMsg").val());
            return false;
          }
          if ($("input.Validform_error").length == 1) {
            return false;
          }
          //$(this).parents('.info-form').prevAll('.info-head').find('.editor-click').show();
          //$(this).parents('.info-form').prevAll('.info-table').show();
          var title = "";
          if ($('#man').attr('checked') == 'checked') {
            title = "Mr.";
          } else {
            title = "Mrs.";
          }
          var param = { "mcMemberCode": memberCode, "lastName": username, "title": title, "email": usermail, "cell": userphone, "cdtype": cardType, "cdno": cardnumber, "birthday": birthday, "edulevl": cation }
          $.ajax({
            type: 'POST',
            url: "/services/updateBaseInfo",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (data) {
              var result = JSON.parse(data);
              if (result.Success) {
                //$(this).parents('.info-form').hide();
                //window.location.reload();
                //联系地址 省
                var province = $("select[name='useradress1']").prevAll('ul').find('a.selected').html();

                var provi = "";
                $("select[name='useradress1']").find('option').each(function (index, element) {
                  if ($(this).attr("selected") == "selected") {
                    if ($(this).html() != "选择省份") {
                      provi = $(this).val();
                      $(".useradress1").html($(this).html());
                    }
                  }
                })
                //联系地址 市
                var city = $("select[name='useradress2']").prevAll('ul').find('a.selected').html();

                var citys = "";
                $("select[name='useradress2']").find('option').each(function (index, element) {
                  if ($(this).attr("selected") == "selected") {
                    if ($(this).html() != "选择城市") {
                      citys = $(this).val();
                      $(".useradress2").html($(this).html());
                    }
                  }
                })
                //联系地址 区
                var area = $("select[name='useradress3']").prevAll('ul').find('a.selected').html();

                var areas = "";
                $("select[name='useradress3']").find('option').each(function (index, element) {
                  if ($(this).attr("selected") == "selected") {
                    if ($(this).html() != "选择区县") {
                      areas = $(this).val();
                      $(".useradress3").html($(this).html());
                    }
                  }
                })
                var street = $("input[name='useradress4']").val();
                $(".useradress4").html(street);

                var postcode = '';
                if (street == '') {
                  $("#baseInfoError").html($("#AddressMsg").val());
                  return false;
                } else if (street.length < 3) {
                  $("#baseInfoError").html($("#AddressMsg").val());
                  return false;
                }
                if ($("input.Validform_error").length == 1) {
                  return false;
                }
                //$(this).parents('.info-form').prevAll('.info-table').show();
                //$(this).parents('.info-form').prevAll('.info-head').find('.editor-click').show();
                var cityMemberId = $(".HideMemberId").val();
                var addNumber = $('#main_0_Lbl_useradress5').html();
                var citydata = { "mcCode": memberCode, "postcode": postcode, "street": street, "addr_": street, "addrtype": "Home Address", "city": citys, "area": areas, "province": provi, "addrpriflag": "Y", "addrnumber": addNumber }
                if (hasAdd) {
                  $.ajax({
                    type: 'POST',
                    url: "/services/UpdateAddress",
                    dataType: 'JSON',
                    data: citydata,
                    cache: false,
                    success: function (data) {
                      var result = JSON.parse(data);
                      if (result.Success) {
                        //$(this).parents('.info-form').hide();
                        window.location.reload();
                      }
                      else {
                        $("#baseInfoError").html($("#UpdateError").val());
                      }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                      $("#baseInfoError").html($("#UpdateError").val());
                      return false;
                    }
                  });
                }
                else {
                  $.ajax({
                    type: 'POST',
                    url: "/services/saveMemberAddress",
                    dataType: 'JSON',
                    data: citydata,
                    cache: false,
                    success: function (data) {
                      var result = JSON.parse(data);
                      if (result.Success) {
                        //$(this).parents('.info-form').hide();
                        window.location.reload();
                      }
                      else {
                        $("#baseInfoError").html($("#UpdateError").val());
                      }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                      $("#baseInfoError").html($("#UpdateError").val());
                      return false;
                    }
                  });
                }
              }
              else {
                $("#baseInfoError").html($("#UpdateError").val());
              }
            }
          });
          //$(this).parents('.info-form').hide();
        });

        //联系信息保存
        $('#contactInfo').click(function () {
          var memberID = $(".HideMemberId").val();
          if (memberID == "") {
            return false;
          }
          var mcMemberCode = $(".HideMemberCode").val();
          if (mcMemberCode == "") {
            return false;
          }
          var phone = $("input[name='homephone']").val();
          $(".homephone").html(phone);

          var fax = $("input[name='userfax']").val();
          $(".userfax").html(fax);

          var im = $("input[name='userqq']").val();
          $(".userqq").html(im);

          var email = $("input[name='useranothermail']").val();
          $(".useranothermail").html(email);

          if (phone != null && phone != "") {
            if (!checkHomePhone(phone)) {
              $("#contactInfoError").html($("#PhoneMsg").val());
              return false;
            }
          }
          if (email != null && email != "") {
            if (!checkEmail(email)) {
              //$("#contactInfoError").html($("#EmailMsg").val());
              return false;
            }
          }
          if (im != null && im != "") {
            if (!isQQ(im)) {
              $("#contactInfoError").html($("#QQMsg").val());
              return false;
            }
          }
          if (memberID == null && $.trim(memberID) == "") {
            $("#contactInfoError").html($("#UpdateError").val());
            return false;
          }
          var ContactIdata = { "mcCode": mcMemberCode, "phone_": phone, "phoneType": "Phone", "fax_": fax, "faxType": "Fax", "im_": im, "imType": "QQ", "email_": email, "emailType": "Email" };
          $.ajax({
            type: 'POST',
            url: "/services/updateContactInfo",
            dataType: 'JSON',
            data: ContactIdata,
            cache: false,
            success: function (data) {
              var result = JSON.parse(data);
              if (result.Success) {
                $(this).parents('.info-form').hide();
                //window.location.reload();
              }
              else {
                $("#contactInfoError").html($("#UpdateError").val());
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              $("#contactInfoError").html($("#UpdateError").val());
              return false;
            }
          });

          //联系地址 省
          var province = $("select[name='useradress1']").prevAll('ul').find('a.selected').html();

          var provi = "";
          $("select[name='useradress1']").find('option').each(function (index, element) {
            if ($(this).attr("selected") == "selected") {
              if ($(this).html() != "选择省份") {
                provi = $(this).val();
                $(".useradress1").html($(this).html());
              }
            }
          })
          //联系地址 市
          var city = $("select[name='useradress2']").prevAll('ul').find('a.selected').html();

          var citys = "";
          $("select[name='useradress2']").find('option').each(function (index, element) {
            if ($(this).attr("selected") == "selected") {
              if ($(this).html() != "选择城市") {
                citys = $(this).val();
                $(".useradress2").html($(this).html());
              }
            }
          })
          //联系地址 区
          var area = $("select[name='useradress3']").prevAll('ul').find('a.selected').html();

          var areas = "";
          $("select[name='useradress3']").find('option').each(function (index, element) {
            if ($(this).attr("selected") == "selected") {
              if ($(this).html() != "选择区县") {
                areas = $(this).val();
                $(".useradress3").html($(this).html());
              }
            }
          })
          var street = $("input[name='useradress4']").val();
          $(".useradress4").html(street);

          var postcode = $("input[name='userzipcode']").val();
          $(".userzipcode").html(postcode);
          if (postcode != "") {
            var re = /^[1-9][0-9]{5}$/;
            if (!re.test(postcode)) {
              $("#contactInfoError").html($("#PostCodeMsg").val());
              return false;
            }
          }
          if (street == '') {
            $("#contactInfoError").html($("#AddressMsg").val());
            return false;
          } else if (street.length < 3) {
            $("#contactInfoError").html($("#AddressMsg").val());
            return false;
          }
          if ($("input.Validform_error").length == 1) {
            return false;
          }
          //$(this).parents('.info-form').prevAll('.info-table').show();
          //$(this).parents('.info-form').prevAll('.info-head').find('.editor-click').show();
          var cityMemberId = $(".HideMemberId").val();
          var mcMemberCode = $(".HideMemberCode").val()
          var citydata = { "mcCode": mcMemberCode, "postcode": postcode, "street": street, "addr_": street, "addrtype": "Home Address", "city": citys, "area": areas, "province": provi, "addrpriflag": "Y" }
          $.ajax({
            type: 'POST',
            url: "/services/saveMemberAddress",
            dataType: 'JSON',
            data: citydata,
            cache: false,
            success: function (data) {
              var result = JSON.parse(data);
              if (result.Success) {
                //$(this).parents('.info-form').hide();
                window.location.reload();
              }
              else {
                $("#contactInfoError").html($("#UpdateError").val());
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              $("#contactInfoError").html($("#UpdateError").val());
              return false;
            }
          });
          //$(this).parents('.info-form').hide();
        });

        //模拟下拉菜单	   
        $('.jqForm').jqTransform();
        //*****************************************
        //我的账号-个人信息
        //*****************************************
      });

    } else if (myAccountPage == 'AccountSecurity') {
      //*****************************************
      //我的账号-账户安全
      //*****************************************
      $("#AccountSecurity").addClass("active");
      function removeTitle(obj) {
        $(obj).attr('title', '');
      }

      function CheckCurrent() {
        $("#CurrentError").html("");
        var CurrentPassword = $("#CurrentPassword").val();
        var memberName = $(".HideMemberName").val();

        if (CurrentPassword == "") {
          $("#CurrentError").html($("#OldPasswordMsg").val());
        } else {
          var param = { "username": memberName, "password": CurrentPassword }
          $.ajax({
            type: 'POST',
            url: "/services/ssoLogin",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (data) {
              var arr = data.split(',');
              if (arr.length == 2) {
                $("#CurrentError").html("");
              }
              else {
                $("#CurrentError").html($("#OldPasswordError").val());
              }

            }
          });
        }
      }

      function CheckNew() {
        $("#NewError").html("");
        var NewPassword = $("#NewPassword").val();
        if (NewPassword == "") {
          $("#NewError").html($("#NewPasswordMsg").val());
          return;
        } else if (NewPassword.length < 6 || NewPassword.length > 16) {
          $("#NewError").html($("#NewPasswordError").val());
          return;
        }
        var re = new RegExp("^([a-zA-Z0-9]{6,16}$)");
        if (!re.test(NewPassword)) {
          $("#NewError").html($("#NewPasswordError").val());
          return;
        }
      }

      function CheckRe() {
        $("#ReError").html("");
        var RePassword = $("#RePassword").val();
        var password = $("#NewPassword").val();
        if (RePassword == "") {
          $("#ReError").html($("#ConfirmPasswordMsg").val());
          return;
        } else if (RePassword != password) {
          $("#ReError").html($("#ConfirmPasswordError").val());
          return;
        }
      }

      $(function () {
        $('.red-btn-S input').click(function () {
          var CurrentPassword = $("#CurrentPassword").val();
          var memberName = $(".HideMemberName").val();
          var mcMemberCode = $(".HideMemberCode").val();
          var NewPassword = $("#NewPassword").val();
          var RePassword = $("#RePassword").val();

          if (CurrentPassword == "") {
            $("#CurrentError").html($("#OldPasswordMsg").val());
            return;
          }
          if (NewPassword == "") {
            $("#NewError").html($("#NewPasswordMsg").val());
            return;
          } else if (NewPassword.length < 6 || NewPassword.length > 16) {
            $("#NewError").html($("#NewPasswordError").val());
            return;
          }

          var re = new RegExp("^([a-zA-Z0-9]{6,16}$)");
          if (!re.test(NewPassword)) {
            $("#NewError").html($("#NewPasswordError").val());
            return;
          }

          if (RePassword == "") {
            $("#ReError").html($("#ConfirmPasswordMsg").val());
            return;
          } else if (RePassword != NewPassword) {
            $("#ReError").html($("#ConfirmPasswordError").val());
            return;
          }
          if (CurrentPassword != "") {
            var param = { "username": memberName, "password": CurrentPassword };
            $.ajax({
              type: 'POST',
              url: "/services/ssoLogin",
              dataType: 'JSON',
              data: param,
              cache: false,
              success: function (data) {
                var arr = data.split(',');
                if (arr.length == 2) {
                  $("#CurrentError").html("");
                  var param = { "mcMemberCode": mcMemberCode, "password": hex_md5(NewPassword) };
                  $.ajax({
                    type: 'POST',
                    url: "/services/modifyPwd",
                    dataType: 'JSON',
                    data: param,
                    cache: false,
                    success: function (data) {
                      var result = JSON.parse(data);
                      if (result.Success) {
                        $('.gay-main').slideUp('slow');
                        $('.succes-tip').show();
                        $('.succes-tip').fadeOut(4000);
                        $("#CurrentPassword").val("");
                        $("#NewPassword").val("");
                        $("#RePassword").val("");
                      }
                    }
                  });
                }
                else {
                  $("#CurrentError").html($("#OldPasswordError").val());
                }
              }
            });
          }
        });
      });

    }
    else if (myAccountPage == 'Renew') {
      //*****************************************
      //我的账号-我要续会
      //*****************************************
      $("#Renew").addClass("active");
    }
    else if (myAccountPage == 'Subscription') {
      //*****************************************
      //我的账号-我的订阅
      //*****************************************
      $("#Subscription").addClass("active");

      $(function () {

        $(".diableAll").click(function () {
          if ($(this).attr("checked") == "checked") {
            $(".mailCheck:checkbox").attr("checked", false);
          }
        });

        $(".mailCheck").click(function () {
          if ($(this).attr("checked") == "checked") {
            $(".diableAll:checkbox").attr("checked", false);
          }
        });
      });
    }
    else if (myAccountPage == 'Messages') {
      //*****************************************
      //我的账号-消息中心
      //*****************************************
      $("#Messages").addClass("active");
    }
    else if (myAccountPage == 'CardManage') {
      $(function () {
        $(".del").click(function () {
          layer.open({
            content: $('#ContentLab').val(),
            title: $('#TitleLab').val(),
            btn: [$('#SubmitLab').val(), $('#CancelLab').val()],
            btn1: function (index, layero) {
              UniDeleteByMemberID();
              layer.close(index);
            }
            , cancel: function () { //右上角关闭回调
            }
          });
        });

        function UniDeleteByMemberID() {
          var param = {
            "accountName": $(".del").find('input').val(),
            "memberId": $('#MemberId').val()
          }

          $.ajax({
            type: 'POST',
            url: '/services/UniDeleteByMemberID',
            dataType: 'json',
            data: param,
            cache: false,
            success: function (data) {
              data = $.parseJSON(data);
              if (data.Success && data.intValue > 0) {
                $('#divCard').get(0).innerHTML = "";
                $('.nodem').css("display", "block")
              }
            }
            ,
            error: function (data) {

            }
          });
        }
      });
    }


    var showComplete = function () {
      var memberType = $(".HideMemberType").val();
      if (memberType == 'TmpMem') {
        $("#information-box").center().show();
        var ducHeight = $(document).height();
        var ducWidth = $(document).width();
        $(".page-cover").css("height", ducHeight);
        $(".page-cover").css("width", ducWidth);
        $(".page-cover").show();

        $(".jqTransformSelectWrapper").css({ "width": 115 })
        $(".jqTransformSelectWrapper ul").css({ "width": 113, "height": 290 })
      }

    };

    function checkPhone1(phone) {
      var partten = /^[1][3,4,5,7,8][0-9]{9}$/;
      if (partten.test(phone)) {
        var param = {
          registerType: "mobile",
          mobile: phone,
          email: ""
        };
        //$.ajax({
        //    type: 'POST',
        //    url: "/services/ValidateMailOrTel",
        //    dataType: 'JSON',
        //    data: param,
        //    cache: false,
        //    success: function (responseData) {
        //        var result = JSON.parse(responseData);
        //        if (result.code != "0") {
        //            if ($('.HideLanguage').val() == "zh-CN") {
        //                $('.phone-err').val(" 手机号已注册");
        //                $('.phone-err').show();
        //                return false;
        //            }
        //            else {
        //                $('.phone-err').val(" Phone has registered");
        //                $('.phone-err').show();
        //                return false;
        //            }
        //        }
        //        else {
        //            $('.phone-err').hide();
        //            return true;
        //        }
        //    }
        //});
        return true;
      } else {
        if ($('.HideLanguage').val() == "zh-CN") {
          $('.phone-err').val(" 请输入正确的手机号");
          $('.phone-err').show();
          return false;
        }
        else {
          $('.phone-err').val(" Phone format ERROR");
          $('.phone-err').show();
          return false;
        }
      }
    }

    function checkPhone(phone) {
      var partten = /^[1][3,4,5,7,8][0-9]{9}$/;
      if (partten.test(phone)) {
        return true;
      } else {
        return false;
      }
    }


  </script>




  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/jquery.cookie_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/stringutil_2.js"></script>

  <div id="loginStateImage" style="height: 0px;"></div>
  <input type="hidden" id="lang" value="zh-CN" />



  <script type="text/javascript">
    var limit = 0;

    var NameInput = "请输入用户名";
    var PsdInput = "请输入密码";
    var errorMsg = "用户名或密码错误";
    var loginfail = "登陆失败";
    var hasImageUrl = false;
    var loginInterval = null;
    if ($("#lang").val() == "en") {
      NameInput = "Enter your username";
      PsdInput = "Enter your password";
      errorMsg = "Wrong username or password";
      loginfail = "Login fail";
    }

    $(document).ready(function () {
      var newLoginUrl = 'https://www.jinjiang.com/newlogin';
      var authStateDependOnPasser = true;

      var ClubUtil = {

        isLogedIn: function () {
          return $.cookie("memberId") != null;
        },
        setCookie: function (url, value) {
          var head = document.getElementsByTagName('head')[0];
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url + '/handlers/setcookie.aspx?pas=' + value;
          head.appendChild(script);
        }
        ,
        doSignout: function () {
          //remove current auth-cookie
          $.ajax({
            type: 'GET',
            url: "/Handlers/SimpleLogoutHandler.ashx",
            dataType: "jsonp",
            jsonp: "callback",
            // data: "key=.ASPXAUTH",
            cache: false,
            success: function (result) {

              //remove MainSite auth-cookie
              $.ajax({
                type: 'GET',
                url: "http://www.jinjiang.com/Handlers/SimpleLogoutHandler.ashx",
                dataType: "jsonp",
                jsonp: "callback",
                // data: "key=$mainSiteKey$",
                cache: false,
                success: function (result) {
                  $.removeCookie(".ASPXAUTH");
                  $.removeCookie("memberId");

                  if (authStateDependOnPasser)
                    location.href = "http://www.jinjiang.com/passer/logout?go=http://club.jinjiang.com/MyAccount";
                  else
                    location.href = "/";
                },
                error: function (jqXHR, textStatus, errorThrown) {
                  //console.log("Logout Error:", errorThrown);
                }
              });
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Logout Error:", errorThrown);
            }
          });
        },

        isEmpty: function (value) {
          if (typeof (value) == 'undefined')
            return true;

          if (value == null)
            return true;

          if (value.length == 0)
            return true;

          return false;
        },

        homeLoginValidate: function () {
          $("#msg_cord").html("");

          var usr = $.trim($("#userName").val());
          var pwd = $.trim($("#password").val());

          if (ClubUtil.isEmpty(usr)) {
            $("#msg_cord").html(NameInput);
            return false;
          }

          if (ClubUtil.isEmpty(pwd)) {
            $("#msg_cord").html(PsdInput);
            return false;
          }

          return true;
        },

        homeDoLogin: function () {

          var param = {
            username: $.trim($("#userName").val()),
            password: $.trim($("#password").val()),
            oneMonth: $("#rememberMe").attr("checked") === "checked"
          };
          $.cookie("rememberMe", $("#rememberMe").attr("checked") === "checked" ? "1" : "0");

          if (!checkValidateCode("loginForm_validateCode")) {
            if ($("#lang").val() == "en") {
              $("#msg_cord").html("Verification code error");
            }
            else {
              $("#msg_cord").html("验证码错误");
            }
            return;
          }

          var data = "usr=" + param.username + "&pwd=" + StringUtil.base64encode(param.password) + "&oneMonth=" + param.oneMonth + "&callback=?" + "&code=" + $("#loginForm_validateCode").val() + "&isheader=1";

          $.ajax({
            type: 'POST',
            url: "http://www.jinjiang.com/Handlers/SsoLoginHandler.ashx",
            dataType: "jsonp",
            jsonp: "callback",
            data: data,
            cache: false,
            success: function (result) {
              //console.log(result);
              if (result == null) {
                return;
              }

              if (result.Success) {
                if (result.url != null && result.url.length > 0) {
                  $.cookie("imageUrl", result.url);
                }
                //if (result.token != null) {
                //    $.cookie(".ASPXAUTH", result.token, { expires: 1 });
                //}
                if (result.id != null) {
                  $.cookie("memberId", result.id);
                }
                location.reload();
              }
              else {
                if (result.code != null && result.code == "101") {
                  if ($("#lang").val() == "en") {
                    $("#msg_cord").html("Verification code error, please try again");
                  }
                  else {
                    $("#msg_cord").html(result.message);
                  }

                } else if (result.code != null && result.code == "301") {//修改密码 
                  if ($("#login_box").length > 0) {
                    $("#login_username").val("");
                    $("#login_password").val("");
                    $("#login_box .alarm_text").html("");
                    $("#login_box").css("display", "none");
                  }

                  if ($("#userName").val().trim().length > 0 || $("#password").val().trim().length > 0)
                  {
                    $("#userName").val("");
                    $("#password").val("");
                  }
                  ImprovePassword();
                }
                else {
                  $("#msg_cord").html(errorMsg);
                }
                loginFormChangeCodeImg();
                $("#loginForm_validateCode").val("");
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log(errorThrown);
              $("#msg_cord").html(loginfail);
              loginFormChangeCodeImg();
              $("#loginForm_validateCode").val("");
            }
          });

        }
      };




      //logout
      $("#headerSignOutLink").on("click", function () {

        ClubUtil.doSignout();
      });
      $("#headerSignOutLink").live("click", function () {

        ClubUtil.doSignout();
      });


      //Login btn click on HOME
      var ducHeight = $(document).height();
      $(".page-cover").css("height", ducHeight);
      $(".login_b").find(".btn").on("click", function () {
        location.href = newLoginUrl + "?go=" + encodeURIComponent(location.origin);
      });


      $(".glo_btn_1").on("click", function () {

        if (!ClubUtil.homeLoginValidate()) {
          return;
        }

        ClubUtil.homeDoLogin();
      });



    });
    function loginFormChangeCodeImg() {
      var strLoginUrl = ("http://www.jinjiang.com/Handlers/SsoLoginHandler.ashx").replace("SsoLoginHandler.ashx", "CodeImage.aspx");
      $("#loginForm_ImageCheck").attr("src", strLoginUrl + "?TypePara=loginheader&" + rand(10000000));
    }
  </script>



  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/jquery.cookie_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/stringutil_2.js"></script>
  <script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/cros_2.js"></script>
  <div id="loginStateImage" style="height: 0px;"></div>


  <script>
    var limit = 0;
    var loginInterval = null;
    var totalCountForMemberHeader = 0;
    var totalCouponCountForMember = 0;
    var totalLetterCountForMember = 0;
    var hasImageUrl = false;
    var ermFlag = "";
    var ermId = "";
    var clientNumber = "";
    var memberId = "87765794";
    jQuery(document).ready(function () {
      var viewPc = jQuery("#viewPc").val();

      var jjeUtil = (function (parent, $) {
        var my = parent = parent || {};
        my.ermLogout = function () {
          ermId = "clear";
          MeberUtil.setErmCookie("http://www.jinjianginns.com", ermId);
          MeberUtil.setErmCookie("http://jinguanginns.bestwehotel.com", ermId);
          MeberUtil.setErmCookie("http://www.metropolohotels.com", ermId);
          MeberUtil.setErmCookie("http://bestay.bestwehotel.com", ermId);
          MeberUtil.setErmCookie("http://www.jinjiang.com", ermId);
          MeberUtil.setErmCookie("http://hotels.jinjiang.com", ermId);
          MeberUtil.setErmCookie("", ermId);
          clearInterval(loginInterval);

          if (limit++ > 2) clearInterval(loginInterval);
          console.log("remove cookie:ermFlag");
          $.removeCookie("ermFlag");
        };
        my.viewPc = function () {
          if (viewPc=="1") {
            MeberUtil.setMobileCookie("http://www.jinjianginns.com");
            MeberUtil.setMobileCookie("http://jinguanginns.bestwehotel.com");
            MeberUtil.setMobileCookie("http://www.metropolohotels.com");
            MeberUtil.setMobileCookie("http://bestay.bestwehotel.com");
            MeberUtil.setMobileCookie("http://www.jinjiang.com");
            MeberUtil.setMobileCookie("http://hotels.jinjiang.com");
            MeberUtil.setMobileCookie("");
            MeberUtil.setMobileCookie("http://travel.jinjiang.com");
            clearInterval(loginInterval);
          }
          if (limit++ > 2) clearInterval(loginInterval);
        };

        my.ermLogin = function () {
          if (ermId != "" && ermId != undefined) {
            MeberUtil.setErmCookie("http://www.jinjianginns.com", ermId + "|" + clientNumber);
            MeberUtil.setErmCookie("http://jinguanginns.bestwehotel.com", ermId + "|" + clientNumber);
            MeberUtil.setErmCookie("http://www.metropolohotels.com", ermId + "|" + clientNumber);
            MeberUtil.setErmCookie("http://bestay.bestwehotel.com", ermId + "|" + clientNumber);
            MeberUtil.setErmCookie("http://www.jinjiang.com", ermId + "|" + clientNumber);
            MeberUtil.setErmCookie("http://hotels.jinjiang.com", ermId + "|" + clientNumber);
            MeberUtil.setErmCookie("", ermId + "|" + clientNumber);
            clearInterval(loginInterval);
          }
          if (limit++ > 2) clearInterval(loginInterval);
        };
        my.tryLogin = function (url) {
          if (!readCookie('_JJE_PAS_') || hasImageUrl) {
            $.getJSON(url + "?callback=?", function (data) {
              if (data.value != "" && data.value != undefined) {
                createCookie(data.name, data.value);
                var onemonth = $.cookie("rememberMe");
                MeberUtil.setCookie("http://www.jinjianginns.com", data.value + "|" + memberId + "|" + onemonth);
                MeberUtil.setCookie("http://jinguanginns.bestwehotel.com", data.value + "|" + memberId + "|" + onemonth);
                MeberUtil.setCookie("http://www.metropolohotels.com", data.value + "|" + memberId + "|" + onemonth);
                MeberUtil.setCookie("http://bestay.bestwehotel.com", data.value + "|" + memberId + "|" + onemonth);
                MeberUtil.setCookie("http://hotels.jinjiang.com", "|" + memberId + "|" + onemonth);
                MeberUtil.setCookie("", "|" + memberId + "|" + onemonth);
                MeberUtil.setCookie("http://travel.jinjiang.com", data.value + "|" + memberId + "|" + onemonth);
                clearInterval(loginInterval);
              }
            });
          }
          if (limit++ > 2) clearInterval(loginInterval);
        };

        function createCookie(name, value, days) {
          if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            var expires = "; expires=" + date.toGMTString();
          }
          else var expires = "";
          document.cookie = name + "=" + value + expires + "; path=/";
        }

        function readCookie(name) {
          var nameEQ = name + "=";
          var ca = document.cookie.split(';');
          for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
          }
          return null;
        }
        return parent;
      }(jjeUtil || {}, jQuery));
      var mcode = jQuery("#mcode").val();
      var authStateDependOnPasser = true;

      var MeberUtil = {

        emptyUsrMsg: "请输入您的用户名",
        emptyPwdMsg: "请输入您的密码",
        loginFailMsg: "用户名或密码有误",

        isLogedIn: function () {
          return $.cookie("memberId") != null && $.cookie("identity") == null;
        },

        isMemberPanelExisits: function () {
          return $(".head .logined_box") != null;
        },

        setTotalCount: function () {
          if ($("#MemberMessagesTotalCount").length > 0) {

            //console.log("iCount", iCount);
            totalCountForMemberHeader = totalCouponCountForMember + totalLetterCountForMember;

            $("#MemberMessagesTotalCount").html("(" + totalCountForMemberHeader + ")");
            $("#MemberMessagesTotalCount").attr("title", totalCountForMemberHeader);
          }
        },

        showMemberInfo: function () {
          var param = {
            code: $.cookie("memberId")
          }
          $.ajax({
            type: 'POST',
            url: "/service/getMemberInfo",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (responseData) {
              var result = JSON.parse(responseData);
              //console.log(result);
              if (result.Success) {
                //$("#memberLevel").html(result.CardLevelName);
                $("#memberCardNo").html(result.CardNo);
                if ($("#member_name_text").length > 0) {
                  $("#member_name_text").html(result.FullName);
                  $("#member_name_text").attr("title", result.FullName);
                }
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Get MemberInfo Error:", errorThrown);
            }
          });
        },
        setErmCookie: function (url, value) {
          var head = document.getElementsByTagName('head')[0];
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url + '/handlers/setermcookie.aspx?id=' + value;
          head.appendChild(script);
        },
        setMobileCookie: function (url) {
          var head = document.getElementsByTagName('head')[0];
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url + '/handlers/setmobilecookie.aspx';
          head.appendChild(script);
        },
        setCookie: function (url, value) {
          var head = document.getElementsByTagName('head')[0];
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url + '/handlers/setcookie.aspx?pas=' + value;
          head.appendChild(script);
        }
        ,
        showMemberScore: function () {
          var param = {
            code: $.cookie("memberId")
          }
          $.ajax({
            type: 'POST',
            url: "/service/getMemberScore",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (responseData) {
              var result = JSON.parse(responseData);
              //console.log(result);
              if (result.Success) {
                $("#memberScore").html(result.intValue);
                $("#memberScore").attr("title", result.intValue);
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Get MemberScore Error:", errorThrown);
            }
          });
        },

        showCouponCount: function () {
          var param = {
            code: ($.cookie("memberId") == null || $.cookie("memberId") == "") ? mcode : $.cookie("memberId")
          }
          $.ajax({
            type: 'POST',
            url: "/service/getCouponCount",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (responseData) {
              var result = JSON.parse(responseData);
              //console.log(result);
              if (result.Success) {
                var str = "(" + result.unusedCount + ")";
                $("#myCouponCount").html(str);

                totalCouponCountForMember = result.unusedCount;
                MeberUtil.setTotalCount();
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Get CouponCount Error:", errorThrown);
            }
          });
        },

        showInternalLetters: function () {
          var param = {
            memberId: $.cookie("memberId")
          }

          $.ajax({
            type: 'POST',
            url: "/services/unreadInternalLetterCount",
            dataType: 'JSON',
            data: param,
            cache: false,
            success: function (responseData) {
              var result = JSON.parse(responseData);
              //console.log("unread", result);
              if (result.Success) {
                var str = "(" + result.intValue + ")";
                $("#myLettersCount").html(str);

                totalLetterCountForMember = result.intValue;
                MeberUtil.setTotalCount();
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              //console.log("Get CouponCount Error:", errorThrown);
            }
          });

          //setTimeout(MeberUtil.showInternalLetters(), 60000);
        }
      };

      //Rend Image as url from cookie
      if ($.cookie("imageUrl") != null) {
        //console.log("render Image URL");
        $("<img />", { src: $.cookie("imageUrl"), width: 0, height: 0 }).appendTo("#loginStateImage");
        $.removeCookie("imageUrl");
        hasImageUrl = true;

      }
      if ($(".logined").length > 0 && ermFlag != "clear") {
        if (ermFlag == "1") loginInterval = setInterval(function () { jjeUtil.ermLogin(); }, 1000);
        else if (ermId == "") loginInterval = setInterval(function () { jjeUtil.tryLogin("http://www.jinjiang.com/passer/setcookie"); }, 1000);
      }
      if (ermFlag == "clear") loginInterval = setInterval(function () { jjeUtil.ermLogout(); }, 1000);
      if (viewPc == "1") loginInterval = setInterval(function () { jjeUtil.viewPc(); }, 1000);
      //Get Member Info and show in Panel
      if (MeberUtil.isLogedIn() && MeberUtil.isMemberPanelExisits()) {
        MeberUtil.showMemberInfo();
        MeberUtil.showMemberScore();
        //MeberUtil.showCouponCount();

        //MeberUtil.showInternalLetters();
        //setInterval(function () { MeberUtil.showCouponCount(); }, 30000);
        //setInterval(function () { MeberUtil.showInternalLetters(); }, 30000);
      }

      if ($("#header_ImageCheck").length > 0) {
        headChangeCodeImg();
        if ($("#lang").val() == "en" || $("body").hasClass("en")) {
          $("#header_validateCode").attr("data-watermark", "code");
          $("#header_validateCode").attr("value", "code");

          $("#header_aImageCheck").css("color", "#1d7ad9");
          $("#header_ImageCheck").attr("title", "Click Replace verification code image");
        }

      }


      var orderOrigin = $.cookie("orderOrigin");

      //Login State update


      //$("#EnterClub").click(function (event) {
      //    $("#EnterClub").find("a").click();
      //    //location.href = $("#clubUrl").val();
      //});
      //$("#EnterClub1").click(function (event) {
      //    alert($("#EnterClub1").find("a").attr("href"));
      //    $("#EnterClub1").find("a").click();
      //    //window.location.href = $("#clubUrl").val();
      //});

      $(".login_btn").click(function (event) {
        if ($(".login_btn").attr("state") == "login") {
          return;
        }
        else {
          $(".login_btn").css("background", "#a4a4a4");
          $(".login_btn").attr("state", "login")
          if ($("#lang").val() == "en" || $("body").hasClass("en")) {
            $(".login_btn").html("Logining");
          }
          else {
            $(".login_btn").html("登录中");
          }
        }

        event.preventDefault();
        $("#login_box .alarm_text").css("display", "none");

        var param = {};
        param.username = $.trim($("#login_username").val());
        param.password = $.trim($("#login_password").val());
        param.oneMonth = $("#login_box .check_btn").val() === "checked";
        $.cookie("rememberMe", $("#login_box .check_btn").val() === "checked" ? "1" : "0");
        var usrWaterMark = $("#login_username").attr("data-watermark");
        if (param.username.length == 0 || param.username == usrWaterMark) {
          $("#login_box .alarm_text").css("display", "block");
          $("#login_box .alarm_text").html(MeberUtil.emptyUsrMsg);
          $(".login_btn").css("background", "#d1ae76");
          $(".login_btn").attr("state", "")
          if ($("#lang").val() == "en" || $("body").hasClass("en")) {
            $(".login_btn").html("Login");
          }
          else {
            $(".login_btn").html("登录");
          }
          return;
        }

        if (param.password.length == 0) {
          $("#login_box .alarm_text").css("display", "block");
          $("#login_box .alarm_text").html(MeberUtil.emptyPwdMsg);
          $(".login_btn").css("background", "#d1ae76");
          $(".login_btn").attr("state", "")
          if ($("#lang").val() == "en" || $("body").hasClass("en")) {
            $(".login_btn").html("Login");
          }
          else {
            $(".login_btn").html("登录");
          }
          return;
        }
        if (!checkValidateCode("header_validateCode")) {
          $("#login_box .alarm_text").css("display", "block");

          if ($("#lang").val() == "en" || $("body").hasClass("en")) {
            $("#login_box .alarm_text").html("Verification code error");
          }
          else {
            $("#login_box .alarm_text").html("验证码错误");
          }
          $(".login_btn").css("background", "#d1ae76");
          $(".login_btn").attr("state", "")
          if ($("#lang").val() == "en" || $("body").hasClass("en")) {
            $(".login_btn").html("Login");
          }
          else {
            $(".login_btn").html("登录");
          }
          return;
        }
        var data = "usr=" + param.username + "&pwd=" + StringUtil.base64encode(param.password) + "&oneMonth=" + param.oneMonth + "&callback=?" + "&code=" + $("#header_validateCode").val()+"&isheader=1";
        $.ajax({
          type: 'POST',
          url: "http://www.jinjiang.com/Handlers/SsoLoginHandler.ashx",
          dataType: "jsonp",
          jsonp: "callback",
          data: data,
          cache: false,
          async: false,
          success: function (result) {
            if (result == null) {
              return;
            }
            if (result.Success) {

              if (result.url != null && result.url.length > 0) {
                //Save ImageURL to cookie
                $.cookie("imageUrl", result.url);
              }
              //Write Cookie for authed
              if (result.token != null) {
                //console.log("login token", result.token);
                $.cookie(".ASPXAUTH", result.token);
              }
              if (result.id != null) {
                //console.log("login memberId", result.id);
                $.cookie("memberId", result.id);
              }

              location.reload();

            }
            else {
              $("#login_box .alarm_text").css("display", "block");
              if (result.code != null && result.code == "101") {//验证码错误
                if ($("#lang").val() == "en" || $("body").hasClass("en")) {
                  $("#login_box .alarm_text").html("Verification code error, please try again");
                }
                else {
                  $("#login_box .alarm_text").html(result.message);
                }

              }
              else if (result.code != null && result.code == "301") {//修改密码 
                if ($("#login_box").length > 0) {
                  $("#login_username").val("");
                  $("#login_password").val("");
                  $("#login_box .alarm_text").html("");
                  $("#login_box").css("display","none");
                }
                ImprovePassword();
              }
              else {
                $("#login_box .alarm_text").html(MeberUtil.loginFailMsg);
              }
              $('.num_validate_box').css("display", "block");
              headChangeCodeImg();
              $("#header_validateCode").val("");
              $(".login_btn").css("background", "#d1ae76");
              $(".login_btn").attr("state", "")
              if ($("#lang").val() == "en" || $("body").hasClass("en")) {
                $(".login_btn").html("Login");
              }
              else {
                $(".login_btn").html("登录");
              }
            }
          },
          error: function (jqXHR, textStatus, errorThrown) {
            //console.log("Login Error:", errorThrown);
            $("#login_box .alarm_text").css("display", "block");
            $("#login_box .alarm_text").html(MeberUtil.loginFailMsg);
            headChangeCodeImg();
            $("#header_validateCode").val("");
            $(".login_btn").css("background", "#d1ae76");
            $(".login_btn").attr("state", "")
            if ($("#lang").val() == "en" || $("body").hasClass("en")) {
              $(".login_btn").html("Login");
            }
            else {
              $(".login_btn").html("登录");
            }
          }
        });
      });
      $("#logout").click(function () {

        //remove current auth-cookie
        $.ajax({
          type: 'GET',
          url: "/Handlers/SimpleLogoutHandler.ashx",
          dataType: "jsonp",
          jsonp: "callback",
          // data: "key=.ASPXAUTH",
          cache: false,
          success: function (result) {

            // remove mainSite auth-cookie
            $.ajax({
              type: 'GET',
              url: "http://www.jinjiang.com/Handlers/SimpleLogoutHandler.ashx",
              dataType: "jsonp",
              jsonp: "callback",
              // data: "key=orderOrigin",
              cache: false,
              success: function (result) {
                if (authStateDependOnPasser)
                  location.href = "http://www.jinjiang.com/passer/logout?go=http%3a%2f%2fclub.jinjiang.com%2f";
                else
                  location.reload();

              },
              error: function (jqXHR, textStatus, errorThrown) {
                //console.log("Logout Error:", errorThrown);
              }
            });
          },
          error: function (jqXHR, textStatus, errorThrown) {
            //console.log("Logout Error:", errorThrown);

          }
        });

      });


      //$(document).keydown(function (event) {

      //    if (event.keyCode == 13) {
      //        if ($("#login_password").is(":focus") || $("login_username").is(":focus"))
      //        {
      //             $(".login_btn").click();
      //        }

      //    } 
      //});

    });
    function headChangeCodeImg() {
      var strLoginUrl = ("http://www.jinjiang.com/Handlers/SsoLoginHandler.ashx").replace("SsoLoginHandler.ashx", "CodeImage.aspx");
      $("#header_ImageCheck").attr("src", strLoginUrl + "?TypePara=loginheader&" + rand(10000000));
    }
    var cookieUtil = {};

    cookieUtil.setCrossCookie = function (url, key, value, expires) {
      var head = document.getElementsByTagName('head')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      var flag = "";
      if (url == "") flag = "&flag=1"
      script.src = url + '/handlers/crosscookie.aspx?key=' + key + '&value=' + value + '&expires=' + expires + flag;
      head.appendChild(script);
    }
    cookieUtil.setCrossCookies = function (key, value, expires) {
      cookieUtil.setCrossCookie("http://www.jinjianginns.com", key, value, expires);
      cookieUtil.setCrossCookie("http://jinguanginns.bestwehotel.com", key, value, expires);
      cookieUtil.setCrossCookie("http://www.metropolohotels.com", key, value, expires);
      cookieUtil.setCrossCookie("http://bestay.bestwehotel.com", key, value, expires);
      cookieUtil.setCrossCookie("http://www.jinjiang.com", key, value, expires);
      cookieUtil.setCrossCookie("http://hotels.jinjiang.com", key, value, expires);
      cookieUtil.setCrossCookie("", key, value, expires);
      cookieUtil.setCrossCookie("http://travel.jinjiang.com", key, value, expires);
    }


  </script>












  <input type="hidden" id="serverIP" value="BLUE" />
  <input type="hidden" id="sitecommonForgotURL" value="http://club.jinjiang.com/ForgotPassword/ForgotPasswordMode" />
  <input type="hidden" id="sitecommonImageDomain" value="http://Static1.ejinjiang.com" />
  <input type="hidden" id="sitecommonHotelImageDomain" value="http://static.jinjiang.com/opt/static/" />
  <input type="hidden" id="currentItemId" value="{CD82B251-DDA1-4D8F-BEAD-BA54780B3995}"/>
  <style>

    *{padding: 0;margin: 0;}

    #btn{
      display: block;
      width: 100px;
      height: 30px;
      border: 0;
      background: #f00;
      text-align: center;
      line-height: 30px;
      vertical-align: middle;
      color: #fff;
      font-size: 16px;
    }
    .cover{
      width: 100%;
      height: 100%;
      background: #000;
      background:rgba(0,0,0,0.7);
      position: fixed;
      left: 0;
      top: 0;
      z-index: 99;
      display: none;
    }
    .cover_cont{
      width: 428px;
      height: 300px;
      padding: 22px;
      padding-bottom: 10px;
      background: #fff;
      position: fixed;
      left: 50%;
      top: 50%;
      margin-left: -214px;
      margin-top: -150px;
      z-index: 100;
    }
    .cover_cont h3{
      font-weight: normal;
      color: #96a0a7;
      font-size: 14px;
      padding-bottom: 8px;
      border-bottom:1px solid #dedcdc;
    }
    .cover_cont span{
      display: block;
      text-align: center;
      margin: 8px 0 15px 0;
    }
    .cover_cont p{
      color: #59626a;
      line-height: 24px;
      font-size: 14px;
      padding: 0 14px;
    }
    .cover_cont .update{
      text-align: center;
      padding-top: 22px;
    }
    .cover_cont .update a{
      display: inline-block;
      font-size:16px;
      padding: 5px 18px;
      text-decoration: none;
    }
    .cover_cont .update .a1{
      color: #fff;
      background: #d64c4c;
    }
    .cover_cont .update .a2{
      border: 1px solid #b5b5b5;
      color: #59626a;
      margin-left: 26px;
    }

    /*新增数字验证码*/
    .g_num_validate_box{ margin-bottom:12px;position:relative;}
    .g_num_validate_box .g_num_validate_input{ width:110px; height:30px; line-height:30px; border:1px solid #e0e0e0; background:#fff;border-radius: 3px; text-indent:8px; *margin-left:-10px; float:left; color:#aaa;}
    .g_num_validate_box .g_num_validate_pic{ border:1px solid #7496c4; display:block;float:left; cursor:pointer; margin-left:10px;}
    .g_num_validate_box .g_num_validate_icon{ display:block; height:32px; float:left;cursor:pointer;}
  </style>

</form>

<script type='text/javascript'>
  (function (a, b, c, d) {
    a[c] = function () { a[c]['ar'] = a[c]['ar'] || []; a[c]['ar'].push(arguments); };
    var s = b.createElement('script'); s.async = 1; s.src = '//t.agrantsem.com/js/agt.js';
    var r = b.getElementsByTagName('script')[0]; r.parentNode.insertBefore(s, r);
  })(window, document, '_agtjs', 'script');
  _agtjs('init', 'AG_888038_BBVI', 'jinjiang.com');
  _agtjs('trackPv');
</script>
<script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/o_code_2.js"></script>
<input type="hidden" id="jjIp" value="101.68.87.26, 210.14.68.238" />
<input type="hidden" id="SessionId" value="2eqwwmf525cqxpcw1rx5uxti" />
<script type="text/javascript" src="${pageContext.request.contextPath}/js/usermainpage/jjbigdata_2.js"></script>
<input type="hidden" id="viewPc" value="" />

</body>

</html>



